var G={};G.name="JS SDK",G.version="3.1.2",G.owner="GeoHey.com",window.G=G;var cons=window.console;cons&&cons.log&&(cons.log("%c            ","font-size:30px; padding:15px 120px;line-height:60px;background:url('https://dn-static-geohey.qbox.me/site/ee80aafe6918a6d6f012ff0409639b7f73a246f5/img/logo64.png') no-repeat;"),cons.log(G.name,G.version,"©",G.owner)),function(){function e(e,t,r){if(e in s)return void(t&&t());var n=a[e]||(a[e]=[]);t&&n.push(t);var o=document.createElement("script");o.type="text/javascript",o.src=e;var l=function(){if(!(o.readyState&&"loaded"!=o.readyState&&"complete"!=o.readyState||o.success)){o.success=!0,s[e]=!0;var t=a[e];if(t){for(var r=t.length-1;r>=0;--r)t[r]();delete a[e]}}};return"onload"in o?o.onload=l:o.onreadystatechange=l,o.onerror=function(e){r&&r(e)},i.appendChild(o),o}var t=document.getElementsByTagName("script"),r=t[t.length-1],n=r.src,o=n.lastIndexOf("/");G.debug=!(n.toLowerCase().lastIndexOf(".min.js")>0),G.dir=o<0?"":n.substring(0,o+1);var i=document.getElementsByTagName("head")[0],a={},s={};G.loadModule=function(t,r,n){var o=G.dir+"g-"+t+(G.debug?"":".min")+".js";e(o,r,n)},G.loadModules=function(e,t,r){var n,o,i=0,a=!1;for(n in e)o=e[n],G.loadModule(o,function(){i++,a||i===e.length&&t&&t()},function(){a=!0,r&&r()})}}(),G.Util={isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},merge:function(e){var t,r,n,o,i=Array.prototype.slice.call(arguments,1);for(r=0,n=i.length;r<n;r++){o=i[r]||{};for(t in o)o.hasOwnProperty(t)&&(e[t]=o[t])}return e},bind:function(e,t){var r=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return e.apply(t,r||arguments)}},_stampId:0,stamp:function(e){var t="_g_id_";return e[t]=e[t]||this._stampId++,e[t]},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},renderString:function(e,t){return e?e.replace(/\{ *([\w]+) *\}/gi,function(e,r){var n=t[r];return void 0===n?"":n}):""},_requestAnimFrameFunc:function(){for(var e=["webkit","moz","o","ms"],t=window.requestAnimationFrame,r=0,n=e.length;r<n&&!t;r++)t=window[e[r]+"RequestAnimationFrame"];return t}(),requestAnimFrame:function(e,t,r,n){var o=this.bind(e,r),i=this._requestAnimFrameFunc;return i?i.call(window,o,n):t?void o():window.setTimeout(o,16)},_cancelAnimFrameFunc:function(){for(var e=["webkit","moz","o","ms"],t=window.cancelAnimationFrame,r=0,n=e.length;r<n&&!t;r++)t=window[e[r]+"CancelAnimationFrame"]||window[e[r]+"CancelRequestAnimationFrame"];return t}(),cancelAnimFrame:function(e){var t=this._cancelAnimFrameFunc;t?t.call(window,e):window.clearTimeout(e)},setCanvasLineDash:function(e,t){e&&t&&t.length>0&&(e.setLineDash?e.setLineDash(t):void 0!==e.webkitLineDash?e.webkitLineDash=t:void 0!==e.mozDash&&(e.mozDash=t))},ajax:function(url,options){if(url){var ajaxOptions=options||{},context=ajaxOptions.context||this,appendQueryParam=function(e,t,r){return void 0===t||void 0===r?e:(e+=e.match(/\?/)?"&":"?",e+=t+"="+encodeURIComponent(r))},trySuccess=function(e,t){success&&success.call(context,e,t)},tryError=function(e){error&&error.call(context,e)},tryComplete=function(e){complete&&complete.call(context,e)},type="POST"===(ajaxOptions.type||"GET").toUpperCase()?"POST":"GET",contentType=ajaxOptions.contentType,headers=ajaxOptions.headers||{},data=ajaxOptions.data||{},responseType=(ajaxOptions.responseType||"DATA").toUpperCase(),jsonp=ajaxOptions.jsonp||"_g_jsonp_"+this._ajaxSeq++,jsonpCallback=ajaxOptions.jsonpCallback||"callback",success=ajaxOptions.success,error=ajaxOptions.error,complete=ajaxOptions.complete,loadCallback,key,script;if(type="JSONP"===responseType?"GET":type,"GET"===type){for(key in data)url=appendQueryParam(url,key,data[key]);data=null}else{var postData="";for(key in data)postData=appendQueryParam(postData,key,data[key]);"?"===postData[0]&&(postData=postData.slice(1)),data=postData,contentType=contentType||"application/x-www-form-urlencoded; charset=UTF-8"}if("JSONP"===responseType){url=appendQueryParam(url,jsonpCallback,jsonp),script=document.createElement("script"),script.src=url,script._g_jsonp_=jsonp,window[jsonp]=function(e){script._g_jsonp_value_=e,window[jsonp]=null,script.parentNode&&script.parentNode.removeChild(script)},loadCallback=function(){script._g_abort_||script.readyState&&"loaded"!=script.readyState&&"complete"!=script.readyState||script.success||(script.success=!0,trySuccess(script,script._g_jsonp_value_),tryComplete(script))},"onload"in script?script.onload=loadCallback:script.onreadystatechange=loadCallback,script.onerror=function(){tryError(script),tryComplete(script)};var head=document.getElementsByTagName("head")[0];return head.appendChild(script),script}var xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(xhr){loadCallback=function(){if(4==xhr.readyState){if(200==xhr.status||304==xhr.status){var responseData;responseData="TEXT"===responseType?xhr.responseText:"XML"===responseType?xhr.responseXML:"JSON"===responseType?eval("("+xhr.responseText+")"):xhr.response,trySuccess(xhr,responseData)}else tryError(xhr);tryComplete(xhr)}},xhr.onload=loadCallback,xhr.onerror=function(){tryError(xhr),tryComplete(xhr)},xhr.open(type,url,!0),contentType&&xhr.setRequestHeader("Content-Type",contentType);for(key in headers)xhr.setRequestHeader(key,headers[key]);return xhr.send(data),xhr}}},ajaxCancel:function(e){e&&(e.onload=e.onerror=null,e.abort?e.abort():(e._g_abort_=!0,e.parentNode&&e.parentNode.removeChild(e)))},colorHex:function(e,t,r){function n(e){return("0"+parseInt(e).toString(16)).slice(-2)}return"#"+n(e)+n(t)+n(r)},colorRgb:function(e){function t(e,t,r){var n=parseInt(e.substring(t,r),16);return r-t===2?n:256-(16-n)*(16-n)}return e.length<5?[t(e,1,2),t(e,2,3),t(e,3,4)]:[t(e,1,3),t(e,3,5),t(e,5,7)]},_ajaxSeq:0},G.MathUtil={DEGREE_PER_RADIAN:57.29577951308232,calcHypotenuse:function(e,t){return Math.pow(e*e+t*t,.5)},calcTheta:function(e,t){if(!e&&!t)return 0;var r=this.calcHypotenuse(e,t);return Math.acos(e/r)*(t>0?1:-1)},rotateVector:function(e,t){var r=e[0],n=e[1],o=this.calcHypotenuse(r,n),i=this.calcTheta(r,n)+t/this.DEGREE_PER_RADIAN;return[o*Math.cos(i),o*Math.sin(i)]},scaleVector:function(e,t){return this.scaleArray(e,t)},scaleArray:function(e,t){if(e){var r,n=[];for(r in e)n[r]=e[r]*t;return n}},limitRange:function(e,t,r){return Math.min(Math.max(e,t||e),r||e)},calcDistance:function(e,t){return Math.pow((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]),.5)},degToRad:function(e){var t=this;return e/t.DEGREE_PER_RADIAN},radToDeg:function(e){var t=this;return e*t.DEGREE_PER_RADIAN},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}},G.Class=function(){},G.Class.extend=function(e){var t=function(){var e=this;e.init&&e.init.apply(e,arguments)},r=G.Util.merge,n=function(){};n.prototype=this.prototype;var o=new n;o.constructor=t,t.prototype=o;var i,a;for(i in this)this.hasOwnProperty(i)&&"prototype"!==i&&(t[i]=this[i]);var s,l={};if(e.mixins){for(i=0,a=e.mixins.length;i<a;i++)s=e.mixins[i],r(o,s),s.options&&r(l,s.options);delete e.mixins}e.statics&&(r(t,e.statics),delete e.statics);var _=this.prototype.options;return _&&r(l,_),r(l,e.options),e.options=l,r(o,e),t.__super__=this.prototype,t},G.Browser={getDpi:function(){var e,t=this,r=96;if(!t._dpi){if(!document.body)return[r,r];e=document.createElement("div"),e.style.cssText="width:1in;height:1in;position:absolute;visibility:hidden",document.body.appendChild(e),t._dpi=[parseInt(e.offsetWidth)||r,parseInt(e.offsetHeight)||r],e.parentNode.removeChild(e)}return t._dpi},getPxRatio:function(){var e=this;return e._pxRatio||(e._pxRatio=[1,1],screen.deviceXDPI&&screen.logicalXDPI&&(e._pxRatio=[screen.deviceXDPI/screen.logicalXDPI,screen.deviceYDPI/screen.logicalYDPI])),e._pxRatio},getCanvasRatio:function(){var e=this;if(!e._canvasRatio){var t=G.DomUtil.create("canvas",""),r=t.getContext("2d"),n=window.devicePixelRatio&&window.devicePixelRatio>=1?window.devicePixelRatio:1,o=r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1,i=n/o,a=Math.max(screen.width,screen.height);i>2&&a*i>1500&&(i=2),e._canvasRatio=[i,i]}return e._canvasRatio},getImageSrc:function(e){return G.Util.renderString(e,this.retina?{i:"@2x"}:{i:""})}},function(){var e=window,t=document,r=e.navigator,n=r.userAgent.toLowerCase(),o=t.documentElement,i="undefined"!=typeof e.orientation,a=n.search("iphone")>-1,s=n.search("android")>-1,l=n.search("android [23]")>-1,_="ActiveXObject"in window,c=_&&!t.addEventListener,m=n.search("webkit")>-1,d=n.search("chrome")>-1,u=n.search("safari/")>-1&&!d,p=n.search("gecko/")>-1&&!m&&!_,h=n.search("webkit/534")>-1,g=n.search("webkit/533")>-1,f=n.search("mqqbrowser/")>-1,v=f&&n.search("tbs/02")>-1,y=!!e.WebGLRenderingContext,b=!!t.createElementNS&&!!t.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,x=c,w=!!t.createElement("canvas").getContext,D=function(){var e,r=t.createElement("canvas");if(r&&r.getContext)for(var n=["webgl","experimental-webgl"],o=0,i=n.length;o<i&&!e;o++)e=r.getContext(n[o]);return!(!y||!e)}(),M=l||s&&n.search("chrome/30.0.0.0")>-1,E=_&&"transition"in o.style,S="WebKitCSSMatrix"in e&&"m11"in new e.WebKitCSSMatrix&&!l,U="MozPerspective"in o.style,C="OTransition"in o.style,T=E||S||U||C,A=!!e.G_OFF_CSS3D,P=r.msPointerEnabled&&r.msMaxTouchPoints&&!e.PointerEvent,R=e.PointerEvent&&r.pointerEnabled&&r.maxTouchPoints||P,L=R||"ontouchstart"in e||e.DocumentTouch&&document instanceof e.DocumentTouch,O=e.devicePixelRatio,z=O>=1.5||e.matchMedia&&e.matchMedia("(-webkit-min-device-pixel-ratio: 1.5),                      (-moz-min-device-pixel-ratio: 1.5),                      (min-device-pixel-ratio: 1.5),                      (min-resolution: 1.5dppx)").matches;G.Util.merge(G.Browser,{mobile:i,iphone:a,android:s,androidlt3:l,ie:_,ielt9:c,webkit:m,safari:u,chrome:d,gecko:p,webkit533:g,webkit534:h,mqqwebkit:v,svg:b,vml:x,canvas:w,webgl:D,avoidCanvas:M,ie3d:E,webkit3d:S,gecko3d:U,opera3d:C,support3d:T,avoid3d:A,touch:L,retina:z})}(),Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0,r=this.length;t<r;t++)if(this[t]==e)return t;return-1}),G.RTree=G.Class.extend({init:function(e){var t=this;t._tolerance=1e-6,t._fan=e||8,t._fanHalf=Math.floor(t._fan/2),t._t={mbr:[],nodes:[]}},insert:function(e,t){var r=this;if(e&&t){var n=r._getMbrByExtent(e),o={mbr:n,obj:t};return r._insertTo(o,r._t)}},remove:function(e,t){var r=this;if(e&&t){var n=r._getMbrByExtent(e);return r._removeFrom(n,t,r._t)}},clear:function(){var e=this;e._t.mbr=[],e._t.nodes=[]},search:function(e){var t=this,r=t._getMbrByExtent(e);return t._searchSubtree(r,!1,t._t)},count:function(){var e=this;return e._countNode(e._t)},all:function(){var e=this;return e._allInNode(e._t)},_getMbrByExtent:function(e){var t=e[0],r=e[1],n=e[2],o=e[3],i=[t,r,n-t,o-r];return i},_countNode:function(e){var t=0;if("nodes"in e)for(var r=e.nodes.length-1;r>=0;r--)t+=this._countNode(e.nodes[r]);else"obj"in e&&t++;return t},_allInNode:function(e){var t=[];if("nodes"in e)for(var r=e.nodes.length-1;r>=0;r--)t=t.concat(this._allInNode(e.nodes[r]));else"obj"in e&&t.push(e.obj);return t},_insertTo:function(e,t){var r=this;if(0===t.nodes.length)return t.nodes.push(e),void(t.mbr=r._resizeMbrWithNodes(t.mbr,t.nodes));var n,o=r._chooseSubtree(e,t),i=e;do{if(n&&"nodes"in n&&0===n.nodes.length){var a=n;n=o.pop();for(var s=0,l=n.nodes.length;s<l;s++)if(n.nodes[s]===a||0===n.nodes[s].nodes.length){n.nodes.splice(s,1);break}}else n=o.pop();if(i&&("obj"in i||"nodes"in i||G.Util.isArray(i))){if(G.Util.isArray(i)){for(var _=0,c=i.length;_<c;_++)r._expandMbr(n.mbr,i[_].mbr);n.nodes=n.nodes.concat(i)}else r._expandMbr(n.mbr,i.mbr),n.nodes.push(i);n.nodes.length<=r._fan?i=null:(i=r._split(n.nodes),o.length<1&&(n.nodes.push(i[0]),o.push(n),i=i[1]))}}while(o.length>0)},_removeFrom:function(e,t,r){var n=this,o=[],i=[],a=[],s=1;if(!e||!n._mbrOverlap(e,r.mbr))return a;var l={mbr:n._cloneMbr(e),target:t};i.push(r.nodes.length),o.push(r);var _,c,m,d;do{if(_=o.pop(),c=i.pop()-1,"target"in l)for(;c>=0;){if(m=_.nodes[c],n._mbrOverlap(l.mbr,m.mbr)){if(l.target&&"obj"in m&&m.obj===l.target||!l.target&&("obj"in m||n._mbrContain(l.mbr,m.mbr))){"nodes"in m?(_.nodes.splice(c,1),a=n._searchSubtree(m.mbr,!0,m)):a=_.nodes.splice(c,1),_.mbr=n._resizeMbrWithNodes(_.mbr,_.nodes),delete l.target,_.nodes.length<n._fanHalf&&(l.nodes=n._searchSubtree(_.mbr,!0,_));break}"nodes"in m&&(s+=1,i.push(c),o.push(_),_=m,c=m.nodes.length)}c-=1}else if("nodes"in l){for(_.nodes.splice(c+1,1),_.nodes.length>0&&(_.mbr=n._resizeMbrWithNodes(_.mbr,_.nodes)),d=l.nodes.length-1;d>=0;d--)n._insertTo(l.nodes[d],_);l.nodes.length=0,0===o.length&&_.nodes.length<=1?(l.nodes=n._searchSubtree(_.mbr,!0,_),_.nodes.length=0,o.push(_),i.push(1)):o.length>0&&_.nodes.length<n._fanHalf?(l.nodes=n._searchSubtree(_.mbr,!0,_),_.nodes.length=0):delete l.nodes}else _.mbr=n._resizeMbrWithNodes(_.mbr,_.nodes);s-=1}while(o.length>0);return a},_chooseSubtree:function(e,t){var r=-1,n=[];n.push(t);var o,i=t.nodes;do{r!=-1&&(n.push(i[r]),i=i[r].nodes,r=-1);for(var a=i.length-1;a>=0;a--){if(o=i[a],o.obj){r=-1;break}r<0&&(r=a)}}while(r!=-1);return n},_split:function(e){for(var t=this,r=t._linearPickSeeds(e);e.length>0;)t._pickNext(e,r[0],r[1]);return r},_linearPickSeeds:function(e){for(var t,r,n,o=this,i=e.length-1,a=0,s=e.length-1,l=0,_=e.length-2;_>=0;_--)n=e[_],n.mbr[0]>e[a].mbr[0]?a=_:n.mbr[0]+n.mbr[2]<e[i].mbr[0]+e[i].mbr[2]&&(i=_),n.mbr[1]>e[l].mbr[1]?l=_:n.mbr[1]+n.mbr[3]<e[s].mbr[1]+e[s].mbr[3]&&(s=_);var c=Math.abs(e[i].mbr[0]+e[i].mbr[2]-e[a].mbr[0]),m=Math.abs(e[s].mbr[1]+e[s].mbr[3]-e[l].mbr[1]);return c>m?i>a?(t=e.splice(i,1)[0],r=e.splice(a,1)[0]):(r=e.splice(a,1)[0],t=e.splice(i,1)[0]):s>l?(t=e.splice(s,1)[0],r=e.splice(l,1)[0]):(r=e.splice(l,1)[0],t=e.splice(s,1)[0]),[{mbr:o._cloneMbr(t.mbr),nodes:[t]},{mbr:o._cloneMbr(r.mbr),nodes:[r]}]},_pickNext:function(e,t,r){for(var n,o,i,a,s,l,_=this,c=0,m=-1,d=t,u=e.length-1;u>=0;u--)l=e[u],n=_._cloneMbr(t.mbr),_._expandMbr(n,l.mbr),i=n[2]*n[3]-t.mbr[2]*t.mbr[3],o=_._cloneMbr(r.mbr),_._expandMbr(o,l.mbr),a=o[2]*o[3]-r.mbr[2]*r.mbr[3],s=Math.abs(i-a),s>c&&(c=s,m=u,d=i<a?t:r);var p=e.splice(m,1)[0];t.nodes.length+e.length+1<=_._fanHalf?(t.nodes.push(p),_._expandMbr(t.mbr,p.mbr)):r.nodes.length+e.length+1<=_._fanHalf?(r.nodes.push(p),_._expandMbr(r.mbr,p.mbr)):(d.nodes.push(p),_._expandMbr(d.mbr,p.mbr))},_searchSubtree:function(e,t,r){var n=this,o=[];if(!(n._mbrOverlap(e,r.mbr)&&"nodes"in r))return o;for(var i,a,s=[r.nodes];s.length>0;){i=s.pop();for(var l=i.length-1;l>=0;l--)a=i[l],n._mbrOverlap(e,a.mbr)&&("nodes"in a?s.push(a.nodes):"obj"in a&&(t?o.push(a):o.push(a.obj)))}return o},_mbrOverlap:function(e,t){var r=this,n=r._tolerance;if(e&&t&&!r._mbrNoValue(e)&&!r._mbrNoValue(t))return e[0]<=t[0]+t[2]+n&&e[0]+e[2]+n>=t[0]&&e[1]<=t[1]+t[3]+n&&e[1]+e[3]+n>=t[1]},_mbrContain:function(e,r){var n=this;if(e&&r&&!n._mbrNoValue(e)&&!n._mbrNoValue(r))return e[0]+e[2]+t>=r[0]+r[2]&&e[0]<=r[0]+t&&e[1]+e[3]+t>=r[1]+r[3]&&e[1]<=r[1]+t},_cloneMbr:function(e){if(e)return[e[0],e[1],e[2],e[3]]},_mbrNoValue:function(e){return!e||void 0===e[0]||void 0===e[1]||void 0===e[2]||void 0===e[3]},_expandMbr:function(e,t){var r=this;if(!e||r._mbrNoValue(e))e=r._cloneMbr(t);else if(t&&!r._mbrNoValue(t)){var n=Math.min(e[0],t[0]),o=Math.min(e[1],t[1]),i=Math.max(e[0]+e[2],t[0]+t[2])-n,a=Math.max(e[1]+e[3],t[1]+t[3])-o;e[0]=n,e[1]=o,e[2]=i,e[3]=a}return e},_resizeMbrWithNodes:function(e,t){var r=this;if(!(t.length<1)){e&&!r._mbrNoValue(e)||(e=r._cloneMbr(t[0].mbr));for(var n=t.length-1;n>0;n--)r._expandMbr(e,t[n].mbr);return e}}}),G.Browser.ielt9&&(G.RTree=G.RTree.extend({init:function(e){var t=this;t._tolerance=1e-6,t._nodes={}},insert:function(e,t){var r=this;if(e&&t){var n={ext:e,obj:t},o=G.Util.stamp(t);r._nodes[o]||(r._nodes[o]=n)}},remove:function(e,t){var r=this;if(e&&t){var n=G.Util.stamp(t);r._nodes[n]&&delete r._nodes[n]}},clear:function(){var e=this;e._nodes={}},search:function(e){var t,r,n=this,o=[];for(var i in n._nodes)t=n._nodes[i],r=t.ext,n._overlaps(r,e,n._tolerance)&&o.push(n._nodes[i].obj);return o},count:function(){var e=this,t=0;for(var r in e._nodes)t++;return t},all:function(){var e=this,t=[];for(var r in e._nodes)t.push(e._nodes[r].obj);return t},_overlaps:function(e,t,r){if(!e||!t)return!1;var n=e[0],o=e[1],i=e[2],a=e[3],s=t[0],l=t[1],_=t[2],c=t[3],m=r||0;return!(n>_+m||i<s-m||o>c+m||a<l-m)}})),G.Event={eventsKey:"_g_events_",virtualMouse:{DOWN:G.Browser.touch?["touchstart","mousedown"]:["mousedown"],MOVE:{mousedown:"mousemove",touchstart:"touchmove",MSPointerDown:"touchmove"},UP:{mousedown:"mouseup",touchstart:"touchend",MSPointerDown:"touchend"}},addListener:function(e,t,r){var n=this,o={action:t,context:r||n},i=n.eventsKey,a=n[i]=n[i]||{};return a[e]=a[e]||[],a[e].push(o),n._onListenerAdded(e,t,r),n},removeListener:function(e,t,r){var n,o,i,a=this,s=a.eventsKey,l=a[s];if(!l)return a;if(t){if(n=l[e])for(o=n.length-1;o>=0;o--)n[o].action!==t||r&&n[o].context!==r||(i=n.splice(o,1))}else delete l[e];return a._onListenerRemoved(e,t,r),a},clearListeners:function(){var e=this,t=e.eventsKey;return delete e[t],e},hasListeners:function(e){var t=this,r=t.eventsKey,n=t[r];return!!n&&(e in n&&n[e].length>0)},_setListener:function(e,t,r,n,o){var i=this,a=i.eventsKey,s=i[a];if(s)for(var l,_=s[e],c=_.length-1;c>=0;c--)l=_[c],t&&l.action!==t||r&&l.context!==r||(l[n]=o);return i},enableListener:function(e,t,r){return this._setListener(e,t,r,"disabled",!1)},disableListener:function(e,t,r){return this._setListener(e,t,r,"disabled",!0)},fireEvent:function(e,t){var r=this;if(!r.hasListeners(e))return r;var n=r.eventsKey,o=r[n],i=G.Util.merge({},t,{type:e,target:r,cancel:function(){return i._cancel=!0,i}});if(o)for(var a,s,l=o[e],_=l.length-1;_>=0&&(a=l[_],!i._cancel);_--)a.disabled||(s=a.action,s&&s.call(a.context||r,i));return r},_onListenerAdded:function(e,t,r){},_onListenerRemoved:function(e,t,r){}},G.Event.bind=G.Event.addListener,G.Event.unbind=G.Event.removeListener,G.Event.listen=G.Event.enableListener,G.Event.unlisten=G.Event.disableListener,G.Event.fire=G.Event.fireEvent,G.DomUtil={SVG_NS:"http://www.w3.org/2000/svg",XLINK_NS:"http://www.w3.org/1999/xlink",create:function(e,t,r){var n=document.createElement(e);return n.className=t||"",r&&r.appendChild(n),n},append:function(e,t,r){return e.className=r||"",t&&e&&t.appendChild(e),e},remove:function(e,t){t&&e&&t.removeChild(e)},createNS:function(e,t,r,n){if(!document.createElementNS)return this.create(t,r,n);var o=document.createElementNS(e,t);return o.className=r,n&&n.appendChild(o),o},createSVG:function(e,t,r){var n=this;return n.createNS(n.SVG_NS,e,t,r)},_svgImages:{},_svgImageSeq:1,svgImagePattern:function(e,t,r,n){var o,i=this,a=t+"_"+r+"_"+n;o=a in i._svgImages?i._svgImages[a]:i._svgImages[a]=i._svgImageSeq++;var s,l,_="svg_image_"+o;return e.querySelector("#"+_)||(s=i.createSVG("pattern","",e),s.setAttribute("id",_),s.setAttribute("patternUnits","userSpaceOnUse"),s.setAttribute("width",r),s.setAttribute("height",n),l=i.createSVG("image","",s),l.setAttributeNS(i.XLINK_NS,"href",t),l.setAttribute("width",r),l.setAttribute("height",n)),_},_svgGrads:{},_svgGradsSeq:1,svgGradient:function(e,t,r){var n,o=this,i=t+"_"+r;n=i in o._svgGrads?o._svgGrads[i]:o._svgGrads[i]=o._svgGradsSeq++;var a,s,l,_="svg_grad_"+n;return e.querySelector("#"+_)||(a=o.createSVG("radialGradient","",e),a.setAttribute("id",_),a.setAttribute("gradientUnits","objectBoundingBox"),a.setAttribute("cx","50%"),a.setAttribute("cy","50%"),a.setAttribute("r","50%"),s=o.createSVG("stop","",a),s.setAttribute("offset","0%"),s.setAttribute("stop-color",t),s.setAttribute("stop-opacity",1),l=o.createSVG("stop","",a),l.setAttribute("offset","50%"),l.setAttribute("stop-color",t),l.setAttribute("stop-opacity",r)),_},createVML:function(e,t,r){var n=this;n._vml_init||(document.namespaces.add("v","urn:schemas-microsoft-com:vml"),n._vml_init=!0);var o=document.createElement("<v:"+e+">");return o.className=t||"",r&&r.appendChild&&r.appendChild(o),o},strokeVML:function(e,t){var r,n,o=e._stroke,i=["color","dashstyle","endcap","joinstyle","weight","opacity"];if(t){o||(o=e._stroke=this.createVML("stroke","g-vml",e));for(r in i)n=i[r],n in t&&(o[n]=t[n])}else o&&(e.removeChild(o),e._stroke=null)},fillVML:function(e,t){var r,n,o=e._fill,i=["color","color2","opacity","src","focusposition","type"];if(t){o||(o=e._fill=this.createVML("fill","g-vml",e));for(r in i)n=i[r],n in t&&(o[n]=t[n])}else o&&(e.removeChild(o),e._fill=null)},get:function(e){return G.Util.isString(e)?document.getElementById(e):e},getDomEventKey:function(e,t,r){return"_g_dom_event_"+e+"_"+G.Util.stamp(t)+(r?"_"+G.Util.stamp(r):"")},addListener:function(e,t,r,n){var o=this,i=G.DomUtil.getDomEventKey(t,r,n),a=e[i];return a?o:(a=function(t){return r.call(n||e,t)},"addEventListener"in e?e.addEventListener(t,a,!1):"attachEvent"in e&&e.attachEvent("on"+t,a),e[i]=a,o)},removeListener:function(e,t,r,n){var o=this,i=G.DomUtil.getDomEventKey(t,r,n),a=e[i];return a?("removeEventListener"in e?e.removeEventListener(t,a,!1):"detachEvent"in e&&e.detachEvent("on"+t,a),e[i]=null,o):o},getMousePosition:function(e,t){var r=e.touches?e.touches.length>0?e.touches[0]:e.changedTouches[0]:e,n=document.documentElement,o=document.body,i=r.pageX?r.pageX-o.scrollLeft-n.scrollLeft:r.clientX,a=r.pageY?r.pageY-o.scrollTop-n.scrollTop:r.clientY;if(t){var s=t.getBoundingClientRect(),l=s.left-t.clientLeft,_=s.top-t.clientTop;i-=l,a-=_}return[i,a]},getWheelDelta:function(e){var t=0;return e.wheelDelta&&(t=e.wheelDelta/120),e.detail&&(t=-e.detail/3),t},stopPropagation:function(e){return e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this},preventDefault:function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this},getStyle:function(e,t){var r=e.style[t];return"auto"===r?null:r},hasClass:function(e,t){return e.className.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},addClass:function(e,t){this.hasClass(e,t)||(e.className&&(e.className+=" "),e.className+=t)},removeClass:function(e,t){e.className=G.Util.trim((" "+e.className+" ").replace(" "+t+" "," "))},getOffset:function(e){var t=0,r=0,n=this;do t+=e.offsetLeft||0,r+=e.offsetTop||0,t+=parseInt(n.getStyle(e,"borderLeftWidth"))||0,r+=parseInt(n.getStyle(e,"borderTopWidth"))||0,e=e.offsetParent;while(e);return[t,r]},setSize:function(e,t,r){var n=e._size;n&&n[0]===t&&n[1]===r||(e._size=[t,r],t&&(e.style.width=t+"px"),r&&(e.style.height=r+"px"))},getSize:function(e){return e._size},setZIndex:function(e,t){e&&(e.style.zIndex=t||0)},setPosition:function(e,t,r,n){var o=e._pos;o&&o[0]===t&&o[1]===r||(n||(e._pos=[t,r]),G.DomUtil.updateTransform(e))},getPosition:function(e){return e._pos},getPositionNocache:function(e){var t,r,n,o=G.DomUtil,i=o.Transform,a=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle;return i?(t=a[i].match(/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/),t?(r=parseFloat(t[1]),n=parseFloat(t[2])):(r=parseFloat(a.left),n=parseFloat(a.top))):(r=parseFloat(a.left),n=parseFloat(a.top)),[r,n]},getSizeNocache:function(e){var t=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,r=parseFloat(t.width),n=parseFloat(t.height);return[r,n]},updateOpacity:function(e,t){if(e){var r=e._opacity;if(r!==t){var n=this,o=e.style;o[n.Opacity]=t,o.filter="alpha(opacity="+100*t+")"}}},markScaleTransform:function(e,t,r){e._scale=t&&r?[t,r]:null},markPosTransform:function(e,t,r){e._pos=[t,r]},markSizeTransform:function(e,t,r){e._size=[t,r]},markRotateTransform:function(e,t,r,n){e._rotate=[t,r,n]},updateTransform:function(e){var t=e._scale||[1,1],r=e._pos,n=e._size,o=e._rotate,i=this,a=i.Transform,s="";if(a){if(r&&(s+=i.genTranslateStyle(r[0]||0,r[1]||0)),o){var l,_=e._rotateSC;_&&_[0]==o[0]&&_[1]==o[1]&&_[2]==o[2]?l=_[3]:(l=i.genRotateStyle(o[0],o[1],o[2]),e._rotateSC=[],e._rotateSC[0]=o[0],e._rotateSC[1]=o[1],e._rotateSC[2]=o[2],e._rotateSC[3]=l),s+=l}e.style[a]=s}else r&&(e.style.left=r[0]+"px",e.style.top=r[1]+"px");n&&(e.style.width=n[0]*t[0]+"px",e.style.height=n[1]*t[1]+"px")},genTranslateStyle:function(e,t){if(!e&&!t)return"";var r=G.Browser,n=Math.round;return r.support3d&&!r.avoid3d?" translate3d("+n(e)+"px,"+n(t)+"px, 0) ":" translate("+n(e)+"px,"+n(t)+"px) "},genScaleStyle:function(e,t,r,n,o){if(!e||1==e)return"";var i=1-e,a=G.DomUtil.genTranslateStyle(t*i+(n||0),r*i+(o||0));return a+" scale("+e+") "},genRotateStyle:function(e,t,r){if(!e)return"";var n="",o=G.MathUtil.rotateVector([t,r],e),i=t-o[0]||0,a=r-o[1]||0;return(i||a)&&(n+=G.DomUtil.genTranslateStyle(i,a)),n+=" rotate("+e+"deg) "},testStyle:function(e){var t,r,n=document.documentElement.style;for(t=0,r=e.length;t<r;t++)if(e[t]in n)return e[t]},hide:function(e,t,r){if(e){var n=this,o=e.style;if("hidden"!==o.visibility){e._oldOpacity=o[n.Opacity];var i=function(){o[n.Opacity]=0,o.filter="alpha(opacity=0)"};t?(e._g_hide_transition_end=e._g_hide_transition_end||function(){n.removeListener(e,n.TransitionEnd,e._g_hide_transition_end),o.visibility="hidden",r&&r.call(e)},n.Transition?(n.addListener(e,n.TransitionEnd,e._g_hide_transition_end),o[n.Transition]=n.Opacity+" "+t+"s linear",i()):(o.visibility="hidden",i(),r&&r.call(e))):(o.visibility="hidden",i(),r&&r.call(e))}}},show:function(e,t,r){if(e){var n=this,o=e.style;if("hidden"===o.visibility){var i=function(){o.visibility="";var t=e._oldOpacity>0?e._oldOpacity:1;o[n.Opacity]=t,o.filter="alpha(opacity="+100*t+")"};t?(e._g_show_transition_end=e._g_show_transition_end||function(){n.removeListener(e,n.TransitionEnd,e._g_show_transition_end),r&&r.call(e)},n.Transition?(n.addListener(e,n.TransitionEnd,e._g_show_transition_end),o[n.Transition]=n.Opacity+" "+t+"s linear",i()):(i(),r&&r.call(e))):(i(),r&&r.call(e))}}},getImgElement:function(e,t,r,n){var o=this,i=o._imgs=o._imgs||{},a=i[e];return a||(a=i[e]=o.create("img"),n&&(a.crossOrigin=n),a.onload=function(){a._loaded=!0,t&&t()},a.onerror=function(){a._loaded=!1,r&&r()},a.src=e),a},disableTextSelection:function(){var e=this,t=e.UserSelect;if(e.addListener(window,"selectstart",e.preventDefault),t){var r=document.documentElement.style;e._userSelect=r[t],r[t]="none"}},enableTextSelection:function(){var e=this,t=e.UserSelect;if(e.removeListener(window,"selectstart",e.preventDefault),t){var r=document.documentElement.style;r[t]=e._userSelect,delete e._userSelect}},disableImageDrag:function(){var e=this;e.addListener(window,"dragstart",e.preventDefault)},enableImageDrag:function(){var e=this;e.removeListener(window,"dragstart",e.preventDefault)},preventContextmenu:function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1,!1},disableContextmenu:function(){var e=this;e.addListener(document,"contextmenu",e.preventContextmenu)},enableContextmenu:function(){var e=this;e.removeListener(document,"contextmenu",e.preventContextmenu)}},G.DomUtil.Opacity=G.DomUtil.testStyle(["opacity","webkitOpacity","MozOpacity"]),G.DomUtil.UserSelect=G.DomUtil.testStyle(["userSelect","webkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]),G.DomUtil.Transform=G.DomUtil.testStyle(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),G.DomUtil.Transition=G.DomUtil.testStyle(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),G.DomUtil.TransitionEnd="webkitTransition"===G.DomUtil.Transition||"OTransition"===G.DomUtil.Transition?G.DomUtil.Transition+"End":"transitionend",G.DomClickable=G.Class.extend({mixins:[G.Event],options:{doubleDuration:.2},init:function(e,t){var r=this;r._element=e,r.options=G.Util.merge({},r.options,t)},on:function(){var e,t=this,r=G.DomUtil,n=t.virtualMouse;if(!t._enabled){for(e in n.DOWN)r.addListener(t._element,n.DOWN[e],t._onDown,t);for(e in n.UP)r.addListener(t._element,n.UP[e],t._onUp,t);t._enabled=!0}return t},off:function(){var e,t=this,r=G.DomUtil,n=t.virtualMouse;if(t._enabled){for(e in n.DOWN)r.removeListener(t._element,n.DOWN[e],t._onDown,t);for(e in n.UP)r.removeListener(t._element,n.UP[e],t._onUp,t);t._enabled=!1}return t._dragged=!1,t},_onDown:function(e){var t=this;!e||e.touches&&1!==e.touches.length||(t._lastDown=e.touches?e.touches[0]:e,t._lastTime=+new Date)},_onUp:function(e){var t,r,n,o,i=this,a=G.DomUtil,s=Math.abs,l=+new Date,_=i._lastDown,c=i._lastTime,m=e.changedTouches?e.changedTouches[0]:e;_&&(l-c>1e3||(t=a.getMousePosition(_),r=a.getMousePosition(m),n=s(t[0]-r[0]),o=s(t[1]-r[1]),n<3&&o<3&&i._virtualClick(t))),i._lastDown=null},_virtualClick:function(e){var t=this,r=+new Date,n=1e3*t.options.doubleDuration;t._lastClick?r-t._lastClickTime<n?t._realDoubleClick():(t._lastClick=e,t._realClick()):(t._lastClick=e,t._clickTimeout=setTimeout(G.Util.bind(t._realClick,t),n)),t._lastClickTime=r},_realClick:function(){var e=this;clearTimeout(e._clickTimeout);var t=e._lastClick;e._lastClick=null,e._lastClickTime=+new Date,e.fireEvent("click",{x:t[0],y:t[1]})},_realDoubleClick:function(){var e=this;clearTimeout(e._clickTimeout);var t=e._lastClick;e._lastClick=null,e._lastClickTime=+new Date,e.fireEvent("doubleclick",{x:t[0],y:t[1]})}}),G.DomDraggable=G.Class.extend({mixins:[G.Event],init:function(e,t,r,n){var o=this;o._map=e,o._element=t,o._dragStartTarget=r||t,o._dragEdge=n||0},on:function(){var e=this,t=G.DomUtil,r=e.virtualMouse;if(!e._enabled){for(var n in r.DOWN)t.addListener(e._dragStartTarget,r.DOWN[n],e._onDown,e);e._enabled=!0}return e},off:function(){var e=this,t=G.DomUtil,r=e.virtualMouse;if(e._enabled){for(var n in r.DOWN)t.removeListener(e._dragStartTarget,r.DOWN[n],e._onDown,e);e._enabled=!1}return e._dragged=!1,e},_onDown:function(e){if(!e.shiftKey&&(1===e.which||1===e.button||e.touches)){var t=this,r=t._map,n=(G.Browser.getCanvasRatio(),G.DomUtil);if(e.touches&&e.touches.length>1&&!t._dragging)return G.DomPinchable.forbidden=!1,void t._cancelDrag();if(!(G.DomDraggable.forbidden||t._dragging||t._rightDragging||r._panAnim&&r._panAnim._playing)){G.DomPinchable.forbidden=!0;for(var o=e||e.touches[0],i=o.target;i;){if("g-popup"==i.className)return;i=i.parentElement}var a=e.touches?e.touches[0]:e,s=a.clientX,l=a.clientY,_=t._dragStartTarget,c=t._dragEdge,m=n.getMousePosition(e,_),d=m[0],u=m[1],p=n.getSizeNocache(_),h=Number.MAX_VALUE,g=p[0]||h,f=p[1]||h;if(!(d<c||d>g-c||u<c||u>f-c)){if(n.stopPropagation(e),n.preventDefault(e),n.disableImageDrag(),n.disableTextSelection(),t._dragged=!1,t._startClientX=s,t._startClientY=l,"webgl"===r._mode){var v=r._camera;t._startPos=v.position.clone(),t._startTarget=new G.GL.Vector3,t._posOffset=new G.GL.Vector3,t._targetOffset=new G.GL.Vector3;var y=new G.GL.Vector3((-t._startPos.x),0,(-t._startPos.z));0===t._startPos.x&&0===t._startPos.z&&y.set(0,0,-1),t._cameraDirAngle=new G.GL.Vector3(0,0,(-1)).angleTo(y),t._cameraDirAngle=y.x>0?t._cameraDirAngle:-t._cameraDirAngle}var b=[0,0];t._startX=t._newX=b[0],t._startY=t._newY=b[1];var x=t.virtualMouse;n.addListener(document,x.MOVE[e.type],t._onMove,t),n.addListener(document,x.UP[e.type],t._onUp,t)}}}},_onMove:function(e){var t=this,r=t._map,n=G.Util,o=(G.Browser.getCanvasRatio(),G.MathUtil,G.DomUtil);if(3!==e.button&&3!==e.buttons&&!(e.touches&&e.touches.length>1||r._panAnim&&r._panAnim._playing)){var i=e.touches&&1===e.touches.length?e.touches[0]:e,a=i.clientX-t._startClientX,s=i.clientY-t._startClientY;if(a||s){var l,_,c,m;t._dLimit&&4==t._dLimit.length&&(l=Math.min(t._dLimit[0],0),_=Math.max(t._dLimit[1],0),c=Math.max(t._dLimit[2],0),m=Math.min(t._dLimit[3],0),a=Math.min(Math.max(a,l),c),s=Math.min(Math.max(s,m),_)),o.stopPropagation(e),o.preventDefault(e),t._dragged||(t._dragged=!0,t.fireEvent("dragStart"),o.addClass(document.body,"g-dragging"),G.Browser.ie),t._offsetX=a,t._offsetY=s,t._newX=t._startX+a,t._newY=t._startY+s,t._dragging=!0,
n.cancelAnimFrame(t._animRequest),t._animRequest=n.requestAnimFrame(t._updatePosition,!0,t,t._dragStartTarget)}}},_updatePosition:function(){var e=this,t=G.DomUtil,r=G.Browser.getCanvasRatio(),n=e._map,o=e._element;if("webgl"===n._mode){var i=e._map._camera,a=Math.cos,s=Math.sin,l=-e._offsetX*a(e._cameraDirAngle)+e._offsetY*s(e._cameraDirAngle),_=-e._offsetX*s(e._cameraDirAngle)-e._offsetY*a(e._cameraDirAngle);i.position.set(e._startPos.x+l*r[0],e._startPos.y,e._startPos.z+_*r[1]),e._map._requestRender()}else t.markPosTransform(o,e._newX,e._newY),t.updateTransform(o);e.fireEvent("drag")},_onUp:function(e){var t=this,r=G.DomUtil,n=t._map,o=t.virtualMouse;G.DomPinchable.forbidden=!1,r.removeClass(document.body,"g-dragging");for(var i in o.MOVE)r.removeListener(document,o.MOVE[i],t._onMove,t),r.removeListener(document,o.UP[i],t._onUp,t);if(r.enableImageDrag(),r.enableTextSelection(),!n.isRightDragging()){if("webgl"===n._mode){var a=G.Browser.getCanvasRatio();n._centerOffset=[(t._map._camera.position.x-t._startPos.x)*n._res/a[0],-(n._camera.position.z-t._startPos.z)*n._res/a[1]]}t._dragging&&(t._dragging=!1,G.Util.cancelAnimFrame(t._animRequest),t.fireEvent("dragEnd"))}},_cancelDrag:function(){var e=this,t=G.DomUtil,r=e.virtualMouse;for(var n in r.MOVE)t.removeListener(document,r.MOVE[n],e._onMove,e),t.removeListener(document,r.UP[n],e._onUp,e);e._dragging=!1}}),G.DomPinchable=G.Class.extend({mixins:[G.Event],init:function(e,t){this._element=e,this._pinchStartTarget=t||e},on:function(){var e=this,t=G.DomUtil,r=e.virtualMouse;if(!e._enabled){for(var n in r.DOWN)t.addListener(e._pinchStartTarget,r.DOWN[n],e._onDown,e);e._enabled=!0}return e},off:function(){var e=this,t=G.DomUtil,r=e.virtualMouse;if(e._enabled){for(var n in r.DOWN)t.removeListener(e._pinchStartTarget,r.DOWN[n],e._onDown,e);e._enabled=!1}return e},_onDown:function(e){if(e.touches&&2===e.touches.length){var t=this,r=G.DomUtil;if(!G.DomPinchable.forbidden&&!t._pinching){G.DomDraggable.forbidden=!1,r.stopPropagation(e),r.preventDefault(e),r.disableImageDrag(),r.disableTextSelection();var n=t.virtualMouse;r.addListener(document,n.MOVE[e.type],t._onMove,t),r.addListener(document,n.UP[e.type],t._onUp,t),r.addClass(document.body,"g-pinching"),t._pinching=!0;var o=e.touches[0],i=e.touches[1];t.fireEvent("pinchStart",{originTouch1:o,originTouch2:i})}}},_onMove:function(e){if(e.touches&&2===e.touches.length&&this._pinching){var t=this,r=G.DomUtil;r.stopPropagation(e),r.preventDefault(e),t._touches=e.touches,G.Util.cancelAnimFrame(t._animRequest),t._animRequest=G.Util.requestAnimFrame(t._updatePosition,!0,t,t._pinchStartTarget)}},_updatePosition:function(){var e=this,t=e._touches,r=t[0],n=t[1];e.fireEvent("pinch",{originTouch1:r,originTouch2:n})},_onUp:function(e){var t=this,r=G.DomUtil,n=t.virtualMouse;for(var o in n.MOVE)r.removeListener(document,n.MOVE[o],t._onMove,t),r.removeListener(document,n.UP[o],t._onUp,t);r.stopPropagation(e),r.preventDefault(e),r.enableImageDrag(),r.enableTextSelection();var i=e.touches[0],a=e.touches[1];t._pinching&&(G.Util.cancelAnimFrame(t._animRequest),t.fireEvent("pinchEnd",{originTouch1:i,originTouch2:a})),r.removeClass(document.body,"g-pinching"),t._pinching=!1,G.DomDraggable.forbidden=!1}}),G.Control=G.Class.extend({options:{position:"top-left",offset:[0,0]},init:function(e){var t=this;t.options=G.Util.merge({},t.options,e)},addTo:function(e){var t=this,r=G.DomUtil;if(!t._map){t._map=e,t._id=e._controlIdSeq++,e._controls[t._id]=t,t._control=t._generateControl();var n="g-pos-"+t.options.position;return r.append(t._control,e._panelFrame,"g-control "+n),t}},remove:function(){var e=G.DomUtil;return e.remove(self._control,map._panelFrame),self},_generateControl:function(){}}),G.Control.Zoom=G.Control.extend({options:{position:"top-right",offset:[0,0]},_generateControl:function(){var e=this,t=e._map,r=G.DomUtil,n=e.options.offset,o=r.create("div"),i=r.create("div","g-control-zoom",o);r.markPosTransform(i,n[0],n[1]),r.updateTransform(i);var a=r.create("div","g-control-zoom-button",i);r.create("div","g-icon-zoom-in",a);var s=r.create("div","g-control-zoom-button",i);return r.create("div","g-icon-zoom-out",s),r.addListener(a,"click",t.zoomIn,t),r.addListener(a,"touchstart",t.zoomIn,t),r.addListener(s,"click",t.zoomOut,t),r.addListener(s,"touchstart",t.zoomOut,t),o}}),G.Control.Geolocation=G.Control.extend({options:{position:"top-right",offset:[0,0],callback:null},_generateControl:function(){var e=this,t=(e._map,G.DomUtil),r=e.options.offset,n=t.create("div"),o=t.create("div","g-control-geolocation",n);t.markPosTransform(o,r[0],r[1]),t.updateTransform(o);var i=t.create("div","g-control-geolocation-button",o);t.create("div","g-icon-geolocation",i);var a=function(){options.callback&&options.callback()};return t.addListener(i,"click",a),t.addListener(i,"touchstart",a),n}}),G.Control.Timeline=G.Control.extend({mixins:[G.Event],options:{position:"bottom",offset:[0,0],min:1,max:100,tooltip:!0,formatter:null,duration:1},setLayer:function(e){var t=this;t._layer&&(t._layer._timeline=null),e._timeline=t,t._layer=e,t.options.max=e.options.frameCount,t._timeBreaks=e.options.timeBreaks,e.bind("animationStateChange",function(e){var r=e.state;"start"===r?(t._playing=!0,t._playIcon.style.display="none",t._pauseIcon.style.display="block"):"pause"!==r&&"stop"!==r||(t._playing=!1,t._playIcon.style.display="block",t._pauseIcon.style.display="none")},t)},setValue:function(e){var t=this;t._val=e},getValue:function(){var e=this;return e._val},play:function(){var e=this;e._layer&&(e._playing||e._play())},pause:function(){var e=this;e._layer&&e._playing&&e._play()},stop:function(){var e=this;e._layer&&(e._val=e.options.min,e._playing&&e._play(),e._layer.stop(),e._updateControl())},_generateControl:function(){for(var e=this,t=(e._map,G.DomUtil),r=e.virtualMouse,n=[e.options.min,e.options.max],o=0;o<n.length;o++){var i=n[o],a=(""+i).split(".")[1];n[o]=a?a.length:0}e._precision=Math.max.apply(null,n),e._val=e.options.min;var s=e.options.offset,l=t.create("div"),_=t.create("div","g-control-timeline",l);t.markPosTransform(_,s[0],s[1]),t.updateTransform(_);var c=t.create("div","g-control-timeline-play",_);e._playIcon=t.create("div","g-icon-play",c),e._pauseIcon=t.create("div","g-icon-pause",c),e._pauseIcon.style.display="none",t.addListener(c,"click",e._play,e);var m=t.create("div","g-control-timeline-runway",_);e._runway=m,t.addListener(m,"click",e._onSliderClick,e);var d=t.create("div","g-control-timeline-button-wrapper",m);e._button=d;var u=t.create("div","g-control-timeline-button",d),p=t.create("div","g-control-timeline-bar",m);e._bar=p;var h=t.create("div","g-control-timeline-tooltip",d);h.style.display=e.options.tooltip?"block":"none",e._tooltip=t.create("span","",h),e._tooltip.innerHTML=e._val,t.create("div","g-control-timeline-tooltip-arrow",h);var g=t.create("div","g-control-timeline-label",_);e._textLabel=g,e._textLabel.innerHTML=e._val;for(var o in r.DOWN)t.addListener(u,r.DOWN[o],e._onDown,e);return l},_onSliderClick:function(e){var t=this;t._sliderWidth=t._runway.clientWidth;var r=(e.clientX-t._runway.getBoundingClientRect().left)/t._sliderWidth*100,n=100/(t.options.max-t.options.min),o=Math.round(r/n),i=o*n*(t.options.max-t.options.min)*.01;i=parseFloat(i.toFixed(t._precision)),t._val=t._validValue(i),t._layer&&t._layer.setIndex(t._val-t.options.min),t._updateControl(),e.stopPropagation()},_onDown:function(e){var t=this,r=G.DomUtil,n=t.virtualMouse;t._sliderWidth=t._runway.clientWidth,t._startX=e.clientX,t._startVal=t._val,e.stopPropagation(),r.addListener(document,n.MOVE[e.type],t._onMove,t),r.addListener(document,n.UP[e.type],t._onUp,t)},_onMove:function(e){var t=this,r=(e.clientX-t._startX)/t._sliderWidth*100,n=100/(t.options.max-t.options.min),o=Math.round(r/n),i=t._startVal+o*n*(t.options.max-t.options.min)*.01;i=parseFloat(i.toFixed(t._precision)),t._val=t._validValue(i),t._layer&&(console.log(t._val),t._layer.setIndex(t._val-t.options.min)),t._updateControl(),e.stopPropagation()},_onUp:function(e){var t=this,r=G.DomUtil,n=t.virtualMouse;e.stopPropagation();for(var o in n.MOVE)r.removeListener(document,n.MOVE[o],t._onMove,t),r.removeListener(document,n.UP[o],t._onUp,t)},_play:function(){var e=this;return e._playing?(e._layer.pause(),e._playing=!1,e._playIcon.style.display="block",void(e._pauseIcon.style.display="none")):(e._playing=!0,e._playIcon.style.display="none",e._pauseIcon.style.display="block",void e._layer.start())},_nextStep:function(){var e=this;e._val++,e._val=e._val%(e.options.max+1),e._val=e._validValue(e._val),e._updateControl()},_validValue:function(e){var t=this;return Math.min(t.options.max,Math.max(t.options.min,e))},_updateControl:function(){var e=this,t=(e._val-e.options.min)/(e.options.max-e.options.min);e._button.style.left=100*t+"%",e._bar.style.width=100*t+"%",e._tooltip.innerHTML=e._timeBreaks&&e._timeBreaks[e._val-1]?e._timeBreaks[e._val-1]:e._val,e._textLabel.innerHTML=e._val}}),G.Control.Layers=G.Control.extend({options:{position:"top-left",offset:[0,0],exclude:[]},_generateControl:function(){var e=this,t=e._map,r=G.DomUtil,n=e.options.offset,o=r.create("div"),i=r.create("div","g-control-layers",o);return r.markPosTransform(i,n[0],n[1]),r.updateTransform(i),e._layerContainer=r.create("ul","g-control-layers-list",i),e._update(),t.bind("layerAdded",e._update,e),t.bind("layerRemoved",e._update,e),e._layerSet={},o},_update:function(){var e=this,t=e._map,r=G.DomUtil,n=e.options.exclude;e._layerContainer.innerHTML="";var o,i,a,s,l=[];for(o in t._layerOrder)if(i=t._layerOrder[o],a=t._layers[i],a&&!a._ghost){var _,c=n.length;for(_=0;_<c&&a._id!==n[_]._id;_++);_===c&&(s=a.name||"layer - "+i,l.push(e._generateLayerItem(s,a)))}l.reverse();for(var m=0;m<l.length;m++)r.append(l[m],e._layerContainer,"g-control-layers-item")},_addSwitch:function(e,t,r){var n=this,o=G.DomUtil,i=o.create("div","g-switch",e),a=(o.create("div","g-switch-button",i),t.isVisible());i["data-switch-val"]=a?"on":"off",o.addClass(i,"g-switch-"+i["data-switch-val"]),o.addListener(i,"click",function(){var e=i["data-switch-val"],r="on"===e?"off":"on";i["data-switch-val"]=r,o.removeClass(i,"g-switch-"+e),o.addClass(i,"g-switch-"+r),"on"===r?t.show():t.hide()},n),r&&t.bind("visibleChange",function(e){var t=i["data-switch-val"],r=e.visible?"on":"off";t!==r&&(i["data-switch-val"]=r,o.removeClass(i,"g-switch-"+t),o.addClass(i,"g-switch-"+r))},n)},_generateLayerItem:function(e,t){var r=this,n=G.DomUtil;if(!(!t instanceof G.Layer)){var o=n.create("li"),i=!1;r._layerSet[t._id]||(r._layerSet[t._id]=!0,i=!0,t.bind("orderChange",r._update,r),t.bind("nameChange",r._update,r)),r._addSwitch(o,t,i);var a=n.create("span","g-control-layers-name",o);return a.innerHTML=e,o}}}),G.Legend=G.Class.extend({options:{position:"bottom-right",offset:[0,0],exclude:[]},init:function(e){var t=this;t.options=G.Util.merge({},t.options,e)},addTo:function(e){var t=this,r=G.DomUtil;if(!t._map){t._layerSet={},t._map=e,t._legend=t._generateLegend();var n="g-pos-"+t.options.position;return r.append(t._legend,e._panelFrame,"g-legend "+n),t}},remove:function(){var e=G.DomUtil;return e.remove(self._legend,map._panelFrame),self},open:function(){var e=this;return e.toggle(!0),e},close:function(){var e=this;return e.toggle(!1),e},isOpen:function(){var e=this;return"none"===e._legendButton.style.display},toggle:function(e){var t=this;return void 0===e&&(e=!t.isOpen()),t._legendButton.style.display=e?"none":"block",t._legendContainer.style.display=e?"block":"none",t},_generateLegend:function(){var e=this,t=e._map,r=G.DomUtil,n=e.options.offset,o=r.create("div");r.addListener(o,"wheel",function(e){e.stopPropagation()}),r.markPosTransform(o,n[0],n[1]),r.updateTransform(o);var i=r.create("div","g-legend-wrapper",o);return e._wrapper=i,e._legendButton=r.create("div","g-legend-button",i),e._legendButton.innerHTML="图例",e._legendButton.style.display="none",r.addListener(e._legendButton,"click",function(){e.toggle(!0)},e),e._legendContainer=r.create("ul","g-legend-container",i),r.addListener(e._legendContainer,"click",function(){e.toggle(!1)},e),e._update(),t.bind("layerAdded",e._update,e),t.bind("layerRemoved",e._update,e),o},_update:function(){var e=this,t=e._map,r=G.DomUtil,n=e.options.exclude;e._legendContainer.innerHTML="";var o,i,a,s=[];for(o in t._layerOrder)if(i=t._layerOrder[o],a=t._layers[i],e._layerSet[i]||a.bind("legendChange",e._update,e),a&&a._legend&&!a._hidden){var l,_=n.length;for(l=0;l<_&&a._id!==n[l]._id;l++);l===_&&s.push(e._generateLayerLegend(a))}s.reverse();for(var c=0;c<s.length;c++)r.append(s[c],e._legendContainer,"g-legend-layer");0===s.length?e._wrapper.style.display="none":e._wrapper.style.display="block"},_generateLayerLegendList:function(e,t){for(var r=G.DomUtil,n=r.create("ul"),o=0;o<e.length;o++){var i=e[o],a=r.create("li","g-legend-list-item",n),s=r.create("div","g-legend-icon-wrapper "+i.type,a);s.style.width=t+2*i.outlineWidth+"px",s.style.height=i.size+2*i.outlineWidth+"px";var l="g-legend-icon-"+i.type,_=r.create("div","g-legend-icon "+l,s);_.style.width=_.style.height=i.size+"px",_.style.marginTop=-(i.size/2+i.outlineWidth)+"px",_.style.marginLeft=-(i.size/2+i.outlineWidth)+"px",_.style.background=i.color,_.style.opacity=i.opacity,_.style.borderWidth=i.outlineWidth+"px",_.style.borderColor=i.outlineColor;var c=r.create("span","g-legend-name",a);c.innerHTML=i.name}return n},_generateLayerLegend:function(e){var t=this,r=G.DomUtil;if(!(!e instanceof G.Layer)){var n=r.create("li"),o=e._legend,i=o.data,a=o.title||e.name||"layer - "+e._id,s=r.create("h2","g-legend-title",n);s.innerHTML=a;for(var l=[],_=10,c=0;c<i.length;c++){var m=i[c],d=m.type||o.type,u=m.color||o.color||"#fff",p=m.opacity||o.opacity||1,h=m.size||o.size||10,g=m.outlineWidth||o.outlineWidth||0,f=m.outlineColor||o.outlineColor||"#fff",v=m.outlineOpacity||o.outlineOpacity||1,y=m.value||"";_=h>_?h:_,l.push({type:d,color:u,opacity:p,size:h,outlineWidth:g,outlineColor:f,outlineOpacity:v,name:y})}return r.append(t._generateLayerLegendList(l,_),n,"g-legend-list"),t._layerSet[e._id]||(t._layerSet[e._id]=!0,e.bind("orderChange",t._update,t),e.bind("visibleChange",t._update,t)),n}}}),G.ExtentUtil={overlaps:function(e,t,r){if(!e||!t)return!1;var n=e[0],o=e[1],i=e[2],a=e[3],s=t[0],l=t[1],_=t[2],c=t[3],m=r||0;return!(n>_+m||i<s-m||o>c+m||a<l-m)},contains:function(e,t,r){if(!e||!t)return!1;var n=e[0],o=e[1],i=e[2],a=e[3],s=t[0],l=t[1],_=r||0;return!(s-i>_||n-s>_||l-a>_||o-l>_)},intersect:function(e,t){var r=Math.min,n=Math.max;if(e&&t){var o=n(e[0],t[0]),i=n(e[1],t[1]),a=r(e[2],t[2]),s=r(e[3],t[3]);return o>=a||i>=s?void 0:[o,i,a,s]}return e||t?e?e:t:void 0},union:function(e,t){var r=Math.min,n=Math.max;if(e&&t){var o=r(e[0],t[0]),i=r(e[1],t[1]),a=n(e[2],t[2]),s=n(e[3],t[3]);return[o,i,a,s]}return e||t?e?e:t:void 0},equals:function(e,t,r){var n=e[0],o=e[1],i=e[2],a=e[3],s=t[0],l=t[1],_=t[2],c=t[3],m=Math.abs,d=r||0;return m(n-s)<=d&&m(i-_)<=d&&m(o-l)<=d&&m(a-c)<=d}},G.GeodeticUtil={RADIUS:6378137,sphereDistance:function(e,t){var r=Math.cos,n=Math.sin,o=Math.pow,i=G.MathUtil.DEGREE_PER_RADIAN,a=e[0]/i,s=e[1]/i,l=t[0]/i,_=t[1]/i,c=l-a,m=r(c),d=n(c),u=r(s),p=n(s),h=r(_),g=n(_),f=o(h*d,2),v=o(u*g-p*h*m,2),y=Math.sqrt(f+v),b=p*g+u*h*m;return this.RADIUS*Math.atan2(y,b)}},G.GeomUtil={geomType:function(e){var t,r=this,n=G.Util;return n.isArray(e)?r._singleGeomType(e):(t=e.m,t&&n.isArray(t[0])?"Multi"+r._singleGeomType(t[0]):void 0)},centroid:function(e){var t,r,n,o,i,a,s,l,_,c,m,d,u,p=this,h=p.geomType(e),g=0,f=0,v=0;if("Extent"==h)return[(e[0]+e[2])/2,(e[1]+e[3])/2];if("Point"==h||"Circle"==h)return[e[0],e[1]];if("Polyline"==h){for(t=0,r=e.length;t<r-1;t++)n=e[t],o=e[t+1],i=G.MathUtil.calcHypotenuse(n[0]-o[0],n[1]-o[1]),g+=(n[0]+o[0])/2*i,f+=(n[1]+o[1])/2*i,v+=i;return[g/v,f/v]}if("Polygon"==h){for(a=0,s=e.length;a<s;a++)l=e[a],_=p._islandCentroid(l),c=p._islandArea(l)*(0==a?1:-1),g+=_[0]*c,f+=_[1]*c,v+=c;return[g/v,f/v]}if("MultiPoint"==h){for(m=0,d=e.m.length;m<d;m++)n=e.m[m],g+=n[0],f+=n[1],v+=1;return[g/v,f/v]}if("MultiPolyline"==h){for(m=0,d=e.m.length;m<d;m++)for(u=e.m[m],t=0,r=u.length;t<r-1;t++)n=u[t],o=u[t+1],i=G.MathUtil.calcHypotenuse(n[0]-o[0],n[1]-o[1]),g+=(n[0]+o[0])/2*i,f+=(n[1]+o[1])/2*i,v+=i;return[g/v,f/v]}if("MultiPolygon"==h){for(m=0,d=e.m.length;m<d;m++)for(u=e.m[m],a=0,s=u.length;a<s;a++)l=u[a],_=p._islandCentroid(l),c=p._islandArea(l)*(0==a?1:-1),g+=_[0]*c,f+=_[1]*c,v+=c;return[g/v,f/v]}},labelPoint:function(e){var t,r,n,o=this,i=o.geomType(e),a=o.centroid(e),s=0,l=0;if("Extent"==i)return a;if("Point"==i||"Circle"==i)return a;if("Polyline"==i)return o._hitPolyline(a,e)?a:o._nearestOfPolyline(a,e);if("Polygon"==i)return o._hitPolygon(a,e)?a:o._nearestOfPolyline(a,e.length>1?e[1]:e[0]);if("MultiPoint"==i)return o._nearestOfPoints(a,e.m);if("MultiPolyline"==i){for(t=0,r=e.m.length;t<r;t++)mGeom=e.m[t],n=o._polylineLength(mGeom),n>s&&(l=t,s=n);return mGeom=e.m[l],o._hitPolyline(a,mGeom)?a:o._nearestOfPolyline(a,mGeom)}if("MultiPolygon"==i){for(t=0,r=e.m.length;t<r;t++)mGeom=e.m[t],n=o._polygonArea(mGeom),n>s&&(l=t,s=n);return mGeom=e.m[l],o._hitPolygon(a,mGeom)?a:o._nearestOfPolyline(a,mGeom.length>1?mGeom[1]:mGeom[0])}},_singleGeomType:function(e){var t=G.Util;return t.isArray(e[0])?t.isArray(e[0][0])?"Polygon":"Polyline":4==e.length?"Extent":3==e.length?"Circle":2==e.length?"Point":void 0},_middlePoint:function(e,t){var r=(e[0]+t[0])/2,n=(e[1]+t[1])/2;return[r,n]},_closestToPoint:function(e,t,r){var n,o=t[0],i=t[1],a=r[0]-o,s=r[1]-i,l=a*a+s*s;return l>0&&(n=((e[0]-o)*a+(e[1]-i)*s)/l,n>1?(o=r[0],i=r[1]):n>0&&(o+=a*n,i+=s*n)),[o,i]},_nearestOfPoints:function(e,t){for(var r,n,o=this,i=Number.MAX_VALUE,a=0,s=t.length;a<s;a++)r=t[a],sqrDis=o._sqrDist(e,r),sqrDis<i&&(n=r,i=sqrDis);return n||t[0]},_nearestOfPolyline:function(e,t){for(var r,n,o,i=this,a=Number.MAX_VALUE,s=0,l=t.length-1;s<l;s++)r=t[s],n=t[s+1],sqrDis=i._sqrDistToPoint(e,r,n),sqrDis<a&&(o=[r,n],a=sqrDis);return o?i._closestToPoint(e,o[0],o[1]):t[0]},_sqrDist:function(e,t){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n},_sqrDistToPoint:function(e,t,r){var n=this,o=n._closestToPoint(e,t,r);return n._sqrDist(e,o)},_polylineLength:function(e){var t,r,n,o=this,i=e.length,a=0;if(i<2)return 0;for(n=0;n<i-1;n++)t=e[n],r=e[n+1],a+=Math.pow(o._sqrDist(t,r),.5);return a},_polygonArea:function(e){var t,r,n,o=this,i=0;for(t=0,r=e.length;t<r;t++)n=e[t],i+=o._islandArea(n)*(0==t?1:-1);return i},_hitPolyline:function(e,t,r){for(var n,o,i,a=this,s=(r||0)*(r||0),l=0,_=t.length-1;l<_;l++)if(n=t[l],o=t[l+1],i=a._sqrDistToPoint(e,n,o),i<=s)return!0;return!1},_hitPolygon:function(e,t){var r,n,o,i,a,s=!1;for(r=0,iLen=t.length;r<iLen;r++)for(o=t[r],n=0,jLen=o.length;n<jLen;n++){if(i=o[n],i[0]===e[0]&&i[1]===e[1])return!0;a=n===jLen-1?o[0]:o[n+1],i[1]>e[1]!=a[1]>e[1]&&e[0]<(a[0]-i[0])*(e[1]-i[1])/(a[1]-i[1])+i[0]&&(s=!s)}return s},_islandCentroid:function(e){var t,r,n,o=0,i=0,a=0;for(t=0,r=e.length;t<r;t++)n=e[t],o+=n[0],i+=n[1],a++;return[o/a,i/a]},_islandArea:function(e){var t,r,n,o=this,i=e.length,a=0;if(i<3)return 0;for(n=0;n<i-1;n++)t=e[n],r=e[n+1],a+=o._vectorArea(t,r);return a+=o._vectorArea(e[i-1],e[0]),Math.abs(a)},_vectorArea:function(e,t){var r=G.MathUtil,n=r.calcTheta(e[0],e[1])-G.MathUtil.calcTheta(t[0],t[1]),o=r.calcHypotenuse(e[0],e[1]),i=r.calcHypotenuse(t[0],t[1]);return o*i*Math.sin(n)/2}},G.Graphic=G.Class.extend({mixins:[G.Event],options:{clickable:!1,allowPan:!1,vertexSize:16,vertexShape:"circle",vertexColor:"#fff",vertexOutlineWidth:2,vertexDashArray:[6,2],vertexFillColor:"#ff0",lineHighlightColor:"#0ff",lineHighlightWiden:2},addTo:function(e,t,r){var n,o,i=this;if(e instanceof G.Layer.Graphic){if(i._layer)return i._layer===e?e:null;if(i._layer=e,t&&(n=e._graphics[t]))return n;i._id=t?t:e._idSeq++,i._index=e._indexSeq++,i._addAt=+new Date,e._graphics[i._id]=i,e._tree.insert(i.bbox,i),e.addListener("update",i._onUpdate,i),o=e._calcStyle(i),G.Util.merge(i.options,o);var a=e._map;return a&&(a.addListener("viewChanged",i._onViewChanged,i),a.addListener("zoomStart",i._onZoomStart,i),a.addListener("zoomUpdate",i._onZoomUpdate,i),a.addListener("zoomEnd",i._onZoomEnd,i)),i._onAdded(),a&&!r&&a._requestRedraw(),i._isVertex||e.fireEvent("graphicAdded",{graphic:i}),i}},remove:function(e){var t=this,r=t._layer;if(r){t.endEdit(),r.removeListener("update",t._onUpdate,t),r._tree.remove(t.bbox,t),t._onRemoved(),delete r._graphics[t._id],delete t._id,delete t._layer;var n=r._map;return n&&(n.removeListener("viewChanged",t._onViewChanged,t),n.removeListener("zoomStart",t._onZoomStart,t),n.removeListener("zoomUpdate",t._onZoomUpdate,t),n.removeListener("zoomEnd",t._onZoomEnd,t),e||n._requestRedraw()),t._isVertex||r.fireEvent("graphicRemoved",{graphic:t}),t}},id:function(){return this._id},updateOptions:function(e,t){var r,n=this,o=n._layer;return e&&G.Util.merge(n.options,e),n._updateStyles(),o&&(t||(r=o._map,r&&r._requestRedraw()),n._isVertex||o.fireEvent("graphicOptionsUpdated",{graphic:n})),n},updateGeom:function(e,t){var r,n=this,o=n._layer;return o&&o._tree.remove(n.bbox,n),n._updateGeom(e),o&&(o._tree.insert(n.bbox,n),t||(r=o._map,r&&r._requestRedraw()),n._isVertex||o.fireEvent("graphicGeomUpdated",{graphic:n})),n},updateAttrs:function(e,t){var r,n=this,o=n._layer;return e&&G.Util.merge(n.attrs,e),o&&(r=o._calcStyle(n),r&&n.updateOptions(r,t),n._isVertex||o.fireEvent("graphicAttrUpdated",{graphic:n})),n},bringToTop:function(){var e=this,t=e._layer;if(!t)return e;e._index=t._indexSeq++;var r=t._map;if(!r)return e;var n,o,i,a,s=G.Browser;"canvas"==r._mode||"webgl"==r._mode?r._requestRedraw():"svg"!=r._mode||s.ie?"svg"!=r._mode&&"vml"!=r._mode||!s.ie||(a=e._dom,a&&G.DomUtil.setZIndex(a,e._index)):(a=e._dom,a&&(i=a.parentNode,i&&i.appendChild(a)));for(n in e._vertexes)o=e._vertexes[n],o.bringToTop();for(n in e._midvertexes)o=e._midvertexes[n],o.bringToTop();return e._isVertex||t.fireEvent("graphicToTop",{graphic:e}),e},startEdit:function(e){var t=this,r=t._layer;return G.Util.merge(t.options,e),t._editing||t._isVertex||(t._editing=!0,t._onStartEdit(),r&&r.fireEvent("graphicStartEdit",{graphic:t})),t},endEdit:function(){var e=this,t=e._layer;if(e._editing&&!e._isVertex&&(e._onEndEdit(),e._editing=!1,t)){t.fireEvent("graphicEndEdit",{graphic:e});var r=t._map;r&&G.DomUtil.removeClass(r._layersFrame,"g-edit")}return e},isEditing:function(){return!!this._editing},_updateBbox:function(e){var t=this,r=t._layer;r&&(r._tree.remove(t.bbox,t),t.bbox=e,r._tree.insert(t.bbox,t))},_hitPoint:function(e,t,r,n){var o=this,i=o._hitPointNowrap(e,t,r,n);if(i)return!0;var a;if(o._layer&&o._layer._map&&(a=o._layer._map),!i&&a&&a.options.wrap)for(var s=[e[0],e[1]],l=a._calcWrapPointRange(e),_=a.options.maxExtent,c=_[2]-_[0],m=l[0];m<=l[1];m++)if(s[0]=e[0]+m*c,i=o._hitPointNowrap(s,t,r,n))return!0;return!1},_searchVertex:function(e){var t,r=this,n=r._layer._map,o=n._res,i=n.options.touchTol,a=G.Browser.touch?i:0;for(var s in r._vertexes)if(t=r._vertexes[s],t._hitPoint(e,o,n._rotate,a))return t;for(var s in r._midvertexes)if(t=r._midvertexes[s],t._hitPoint(e,o,n._rotate,a))return t},_removeVertexes:function(){var e,t,r=this,n=r._layer._map;for(e in r._vertexes)t=r._vertexes[e],t.remove(!0);r._vertexes={};for(e in r._midvertexes)t=r._midvertexes[e],t.remove(!0);r._midvertexes={},n._requestRedraw()},_onVertexMouseOver:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging&&r.off(),G.DomUtil.addClass(t._layersFrame,"g-edit")},_onVertexMouseOut:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging&&r.on(),G.DomUtil.removeClass(t._layersFrame,"g-edit")},clone:function(){},_draw:function(){},_updateStyles:function(){},_erase:function(){var e=this,t=(G.DomUtil,e._dom);t&&t.parentNode&&t.parentNode.removeChild(t)},_updateGeom:function(e){},_hitPointNowrap:function(e,t,r,n){},_onMouseOver:function(){},_onMouseOut:function(){},_onStartEdit:function(){},_onEndEdit:function(){},_onViewChanged:function(e){},_onUpdate:function(e){},_onAdded:function(){},_onRemoved:function(){},_onGeomUpdated:function(){},_onZoomStart:function(e){},_onZoomUpdate:function(e){},_onZoomEnd:function(e){}}),G.Graphic.Point=G.Graphic.extend({options:{shape:"circle",size:[12,12],offset:[0,0],image:"",imageRotate:0,imageGravity:!0,text:"",textFont:"Arial",textStyle:"normal",textAlign:"center",outline:!1,outlineColor:"#000",outlineDashArray:[],outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#3dc0fd",fillImage:"",fillImageSize:[24,24],fillOpacity:1,gradual:!1},init:function(e,t,r){var n=this;e&&e.length>1&&n._updateGeom(e),n.attrs=t||{},n.options=G.Util.merge({},n.options,r)},clone:function(){var e=this,t=e.geom[0],r=e.geom[1];return new G.Graphic.Point([t,r],G.Util.merge({},e.attrs),G.Util.merge({},e.options))},_updateGeom:function(e){var t,r,n,o,i,a,s=this,l=e||s.geom;t=l[0],r=l[1],n=o=t,i=a=r,s.geom=l,s.bbox=[n,i,o,a],s._onGeomUpdated()},_hitPointNowrap:function(e,t,r,n){var o=this,i=Math.abs,a=o.options,s=a.shape,l=a.size,_=l[0],c=l[1],m=n||0,d=a.offset,u=o._mouseOver?a.outlineWidth+a.lineHighlightWiden:a.outline?a.outlineWidth:0;u+=2*m;var p=u/2,h=a.imageRotate;"image"===s&&h&&(r-=h);var g,f=e[0],v=e[1];o._layer&&o._layer._map&&(g=o._layer._map,"image"!==s||a.imageGravity||(r-=g._rotate));var y=a.textAlign,b=o.geom,x=[f-b[0],v-b[1]];x=G.MathUtil.rotateVector(x,-(r||0));var w=x[0]/t-d[0],D=-x[1]/t-d[1];if("circle"===s){if(G.MathUtil.calcHypotenuse(w,D)<=_/2+p)return!0}else if("rect"===s){if(i(w)<=_/2+p&&i(D)<=c/2+p)return!0}else if("image"===s){if(w>=-m&&w<=_+m&&D>=-m&&D<=c+m)return!0}else if("text"===s){var M,E;if("left"==y?(M=-m,E=(o._textMeasureWidth||_)+m):"right"==y?(M=-(o._textMeasureWidth||_)-m,E=m):(M=-(o._textMeasureWidth||_)/2-m,E=-M),w>=M&&w<=E&&i(D)<=_/2+m)return!0}return!1},_refreshVertexes:function(){var e=this,t=e.geom,r=(t.length,e._layer._map),n=e.options;e._removeVertexes();var o=e._vertexes[0]=new G.Graphic.Point(t,null,{shape:n.vertexShape,size:[n.vertexSize,n.vertexSize],outline:!0,outlineColor:n.vertexColor,outlineDashArray:n.vertexDashArray,outlineWidth:n.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:n.vertexFillColor,fillOpacity:1,clickable:!0});o._isVertex=!0,o._idVertex=0,o._graphic=e,o.addTo(e._layer),r._requestRedraw()},_onVertexDragStart:function(e){var t=this,r=t._layer._map,n=[e.mapX,e.mapY],o=t.virtualMouse,i=G.DomUtil,a=t._searchVertex(n);if(a){var s=r._handlers.Click;s&&s.off();var l=[a.geom[0],a.geom[1]],_=[0,0];if(r.options.wrap){var c=r._calcRealCoords(n);_[0]=c[0]-n[0],_[1]=c[1]-n[1],l=[c[0]+_[0],c[1]+_[1]]}t._drag={vertex:a,wrapOffset:_,startAt:+new Date},i.stopPropagation(e),i.preventDefault(e),r._handlers.Drag.off(),r.addListener(o.MOVE[e.type],t._onVertexDrag,t),r.addListener(o.UP[e.type],t._onVertexDragEnd,t)}},_onVertexDrag:function(e){var t,r,n=this,o=n._layer._map,i=n._drag;if(i&&(t=i.vertex)){wrapOffset=i.wrapOffset||[0,0];var a=o._calcRealCoords([e.mapX,e.mapY]);r=[a[0]+wrapOffset[0],a[1]+wrapOffset[1]],n.geom=t.geom=r,n.updateGeom(),t.updateGeom()}},_onVertexDragEnd:function(e){var t=this,r=t._layer._map,n=t.virtualMouse,o=G.DomUtil,i=r._handlers.Click;i&&i.on();var a,s=t._drag;s&&(o.stopPropagation(e),o.preventDefault(e),r._handlers.Drag.on(),a=s.vertex,a&&a.updateGeom()),r.removeListener(n.MOVE[e.type],t._onVertexDrag,t),r.removeListener(n.UP[e.type],t._onVertexDragEnd,t),t._drag=null}}),G.Graphic.Polyline=G.Graphic.extend({options:{lineColor:"#ff941b",lineDashArray:[],lineCap:"butt",lineJoin:"round",lineWidth:4,lineOpacity:1},init:function(e,t,r){var n=this;e&&e.length>0&&n._updateGeom(e),n.attrs=t||{},n.options=G.Util.merge({},n.options,r)},clone:function(){for(var e=this,t=e.geom,r=[],n=0;n<t.length;n++)pt=t[n],r[n]=[pt[0],pt[1]];return new G.Graphic.Polyline(r,G.Util.merge({},e.attrs),G.Util.merge({},e.options))},_updateGeom:function(e){for(var t,r,n,o,i,a,s,l=this,_=e||l.geom,c=0,m=_.length;c<m;c++)t=_[c],r=t[0],n=t[1],o=void 0===o?r:Math.min(o,r),i=void 0===i?r:Math.max(i,r),a=void 0===a?n:Math.min(a,n),s=void 0===s?n:Math.max(s,n);l.geom=_,l.bbox=[o,a,i,s],l._onGeomUpdated()},_hitPointNowrap:function(e,t,r,n){var o=this,i=o.options,a=o._mouseOver?i.lineWidth+i.lineHighlightWiden:i.lineWidth,s=a/2+(n||0),l=s*t;return G.GeomUtil._hitPolyline(e,o.geom,l)},_refreshVertexes:function(){var e=this,t=e.geom,r=t.length,n=e._layer._map,o=e.options;e._removeVertexes();var i,a,s;for(i=0;i<r;i++)a=e._vertexes[i]=new G.Graphic.Point(t[i],null,{shape:o.vertexShape,size:[o.vertexSize,o.vertexSize],outline:!0,outlineColor:o.vertexColor,outlineDashArray:o.vertexDashArray,outlineWidth:o.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:o.vertexFillColor,fillOpacity:1,clickable:!0}),a._isVertex=!0,a._idVertex=i,a._graphic=e,a.addTo(e._layer),i>0&&(s=G.GeomUtil._middlePoint(t[i-1],t[i]),a=e._midvertexes[i]=new G.Graphic.Point(s,null,{shape:o.vertexShape,size:[o.vertexSize,o.vertexSize],outline:!0,outlineColor:o.vertexColor,outlineDashArray:o.vertexDashArray,outlineWidth:o.vertexOutlineWidth,outlineOpacity:1,fill:!1,clickable:!0}),a._isVertex=!0,a._idVertex=i,a._isMid=!0,a._graphic=e,a.addTo(e._layer));n._requestRedraw()},_onVertexDragStart:function(e){var t=this,r=t._layer._map,n=[e.mapX,e.mapY],o=t.virtualMouse,i=G.DomUtil,a=t._searchVertex(n);if(a){var s=r._handlers.Click;s&&s.off();var l=[a.geom[0],a.geom[1]],_=a._idVertex;if(a._isMid){var c=t.geom.slice(0,_);c=c.concat([l]),c=c.concat(t.geom.slice(_)),t.geom=c,t._refreshVertexes(),a=t._searchVertex(n)}var m=[0,0];if(r.options.wrap){var d=r._calcRealCoords(n);m[0]=d[0]-n[0],m[1]=d[1]-n[1],l=[d[0]+m[0],d[1]+m[1]]}t._drag={vertex:a,wrapOffset:m,startAt:+new Date},i.stopPropagation(e),i.preventDefault(e),r._handlers.Drag.off(),r.addListener(o.MOVE[e.type],t._onVertexDrag,t),r.addListener(o.UP[e.type],t._onVertexDragEnd,t)}},_onVertexDrag:function(e){var t,r,n,o,i,a=this,s=(a._layer._map,a._drag);if(s&&(t=s.vertex))for(r=[e.mapX,e.mapY],n=t._idVertex,a.geom[n]=t.geom=r,a.updateGeom(),t.updateGeom(),i=n;i<=n+1;i++)o=a._midvertexes[i],o&&(o.geom=G.GeomUtil._middlePoint(a.geom[i-1],a.geom[i]),o.updateGeom())},_onVertexDragEnd:function(e){var t=this,r=t._layer._map,n=t.virtualMouse,o=G.DomUtil,i=r._handlers.Click;i&&i.on();var a,s,l,_=t._drag;if(_&&(o.stopPropagation(e),o.preventDefault(e),r._handlers.Drag.on(),a=_.vertex))if(l=a._idVertex,s=+new Date-_.startAt,s<200&&!a._isMid&&t.geom.length>2){var c=t.geom.slice(0,l);c=c.concat(t.geom.slice(l+1)),t.geom=c,t.updateGeom(),t._refreshVertexes()}else a.updateGeom();r.removeListener(n.MOVE[e.type],t._onVertexDrag,t),r.removeListener(n.UP[e.type],t._onVertexDragEnd,t),t._drag=null}}),G.Graphic.Polygon=G.Graphic.extend({options:{outline:!0,outlineColor:"#ff2e6c",outlineDashArray:[],outlineCap:"round",outlineJoin:"round",outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#000",fillImage:"",fillImageSize:[24,24],fillOpacity:.6},init:function(e,t,r){var n=this;e&&e.length>0&&n._updateGeom(e),n.attrs=t||{},n.options=G.Util.merge({},n.options,r)},clone:function(){for(var e=this,t=e.geom,r=[],n=0,o=t.length;n<o;n++){part=t[n],r[n]=r[n]||[];for(var i=0,a=part.length;i<a;i++)pt=part[i],r[n][i]=[pt[0],pt[1]]}return new G.Graphic.Polygon(r,G.Util.merge({},e.attrs),G.Util.merge({},e.options))},_updateGeom:function(e){for(var t,r,n,o,i,a,s,l=this,_=e||l.geom,c=_[0],m=0,d=c.length;m<d;m++)t=c[m],r=t[0],n=t[1],o=void 0===o?r:Math.min(o,r),i=void 0===i?r:Math.max(i,r),a=void 0===a?n:Math.min(a,n),s=void 0===s?n:Math.max(s,n);l.geom=_,l.bbox=[o,a,i,s],l._onGeomUpdated()},_hitPointNowrap:function(e,t,r,n){var o=this,i=o.options,a=e[0],s=e[1],l=[a,s],_=n||0,c=o._mouseOver?i.outlineWidth+i.lineHighlightWiden:i.outline?i.outlineWidth:0;c+=2*_;var m,d=c*t,u=d/2;if(o.bbox&&(m=[o.bbox[0]-u,o.bbox[1]-u,o.bbox[2]+u,o.bbox[3]+u],!G.ExtentUtil.contains(m,l)))return!1;var p,h,g,f,v,y,b=o.geom,x=G.Graphic.Polyline.prototype._hitPointNowrap;if(G.GeomUtil._hitPolygon(l,b))return!0;if(i.outline||o._mouseOver)for(p=0,h=b.length;p<h;p++)if(g=b[p],f=[g[g.length-1],g[0]],v={geom:g,options:{lineWidth:c}},y={geom:f,options:{lineWidth:c}},x.call(v,l,t)||x.call(y,l,t))return!0;return!1;
},_refreshVertexes:function(){var e=this,t=e.geom,r=(t.length,e._layer._map),n=e.options;e._removeVertexes();var o,i,a,s,l,_,c;for(o=0,i=t.length;o<i;o++)for(l=t[o],a=0,s=l.length;a<s;a++)_=e._vertexes[o+","+a]=new G.Graphic.Point(l[a],null,{shape:n.vertexShape,size:[n.vertexSize,n.vertexSize],outline:!0,outlineColor:n.vertexColor,outlineDashArray:n.vertexDashArray,outlineWidth:n.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:n.vertexFillColor,fillOpacity:1,clickable:!0}),_._isVertex=!0,_._idVertex=[o,a],_._graphic=e,_.addTo(e._layer),c=0==a?G.GeomUtil._middlePoint(l[s-1],l[0]):G.GeomUtil._middlePoint(l[a-1],l[a]),_=e._midvertexes[o+","+a]=new G.Graphic.Point(c,null,{shape:n.vertexShape,size:[n.vertexSize,n.vertexSize],outline:!0,outlineColor:n.vertexColor,outlineDashArray:n.vertexDashArray,outlineWidth:n.vertexOutlineWidth,outlineOpacity:1,fill:!1,clickable:!0}),_._isVertex=!0,_._idVertex=[o,a],_._isMid=!0,_._graphic=e,_.addTo(e._layer);r._requestRedraw()},_onVertexDragStart:function(e){var t=this,r=t._layer._map,n=[e.mapX,e.mapY],o=t.virtualMouse,i=G.DomUtil,a=t._searchVertex(n);if(a){var s=r._handlers.Click;s&&s.off();var l=[a.geom[0],a.geom[1]],_=a._idVertex,c=_[0],m=_[1];if(a._isMid){var d=t.geom[c].slice(0,m);d=d.concat([l]),d=d.concat(t.geom[c].slice(m)),t.geom[c]=d,t._refreshVertexes(),a=t._searchVertex(n)}t._drag={vertex:a,startAt:+new Date},i.stopPropagation(e),i.preventDefault(e),r._handlers.Drag.off(),r.addListener(o.MOVE[e.type],t._onVertexDrag,t),r.addListener(o.UP[e.type],t._onVertexDragEnd,t)}},_onVertexDrag:function(e){var t,r,n,o,i,a,s,l,_,c=this,m=(c._layer._map,c._drag);if(m&&(t=m.vertex))for(r=[e.mapX,e.mapY],n=t._idVertex,o=n[0],i=n[1],c.geom[o][i]=t.geom=r,c.updateGeom(),t.updateGeom(),s=i;s<=i+1;s++)l=s>0?s-1:c.geom[o].length-1,_=s>=c.geom[o].length?0:s,a=c._midvertexes[o+","+_],a&&(a.geom=G.GeomUtil._middlePoint(c.geom[o][l],c.geom[o][_]),a.updateGeom())},_onVertexDragEnd:function(e){var t=this,r=t._layer._map,n=t.virtualMouse,o=G.DomUtil,i=r._handlers.Click;i&&i.on();var a,s,l,_,c,m=t._drag;if(m&&(o.stopPropagation(e),o.preventDefault(e),r._handlers.Drag.on(),a=m.vertex))if(l=a._idVertex,_=l[0],c=l[1],s=+new Date-m.startAt,s<200&&!a._isMid&&t.geom[_].length>3){var d;0==c?d=t.geom[_].slice(1,t.geom[_].length):c==t.geom[_].length-1?d=t.geom[_].slice(0,c):(d=t.geom[_].slice(0,c),d=d.concat(t.geom[_].slice(c+1))),t.geom[_]=d,t.updateGeom(),t._refreshVertexes()}else a.updateGeom();r.removeListener(n.MOVE[e.type],t._onVertexDrag,t),r.removeListener(n.UP[e.type],t._onVertexDragEnd,t),t._drag=null}}),G.Graphic.MultiPoint=G.Graphic.extend({options:{shape:"circle",size:[12,12],offset:[0,0],image:"",imageRotate:0,imageGravity:!0,text:"",textFont:"Arial",textStyle:"normal",textAlign:"center",outline:!1,outlineColor:"#000",outlineDashArray:[],outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#3dc0fd",fillImage:"",fillImageSize:[24,24],fillOpacity:1,gradual:!1},init:function(e,t,r){var n=this;e&&e.m&&e.m.length>0&&n._updateGeom(e),n.attrs=t||{},n.options=G.Util.merge({},n.options,r)},clone:function(){var e,t,r=this,n=r.geom,o=n.m,i=o.length,a=[];for(e=0;e<i;e++)t=o[e],a[e]=[t[0],t[1]];return new G.Graphic.MultiPoint({m:a},G.Util.merge({},r.attrs),G.Util.merge({},r.options))},_updateGeom:function(e){for(var t,r,n,o,i,a,s,l=this,_=e||l.geom,c=_.m,m=0,d=c.length;m<d;m++)t=c[m],r=t[0],n=t[1],o=void 0===o?r:Math.min(o,r),i=void 0===i?r:Math.max(i,r),a=void 0===a?n:Math.min(a,n),s=void 0===s?n:Math.max(s,n);l.geom=_,l.bbox=[o,a,i,s],l._onGeomUpdated()},_hitPointNowrap:function(e,t,r,n){var o=this,i=Math.abs,a=o.options,s=a.shape,l=a.size,_=l[0],c=l[1],m=n||0,d=a.offset,u=o._mouseOver?a.outlineWidth+a.lineHighlightWiden:a.outline?a.outlineWidth:0;u+=2*m;var p=u/2,h=a.imageRotate;"image"===s&&h&&(r-=h);var g,f=e[0],v=e[1];o._layer&&o._layer._map&&(g=o._layer._map,"image"!==s||a.imageGravity||(r-=g._rotate));for(var y,b=a.textAlign,x=o.geom,w=x.m,D=0,M=w.length;D<M;D++){y=w[D];var E=[f-y[0],v-y[1]];E=G.MathUtil.rotateVector(E,-(r||0));var S=E[0]/t-d[0],U=-E[1]/t-d[1];if("circle"===s){if(G.MathUtil.calcHypotenuse(S,U)<=_/2+p)return!0}else if("rect"===s){if(i(S)<=_/2+p&&i(U)<=c/2+p)return!0}else if("image"===s){if(S>=-m&&S<=_+m&&U>=-m&&U<=c+m)return!0}else if("text"===s){var C,T;if("left"==b?(C=-m,T=(o._textMeasureWidth||_)+m):"right"==b?(C=-(o._textMeasureWidth||_)-m,T=m):(C=-(o._textMeasureWidth||_)/2-m,T=-C),S>=C&&S<=T&&i(U)<=_/2+m)return!0}}return!1},_refreshVertexes:function(){var e=this,t=e.geom,r=t.m,n=r.length,o=e._layer._map,i=e.options;e._removeVertexes();var a,s;for(a=0;a<n;a++)s=e._vertexes[a]=new G.Graphic.Point(r[a],null,{shape:i.vertexShape,size:[i.vertexSize,i.vertexSize],outline:!0,outlineColor:i.vertexColor,outlineDashArray:i.vertexDashArray,outlineWidth:i.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:i.vertexFillColor,fillOpacity:1,clickable:!0}),s._isVertex=!0,s._idVertex=a,s._graphic=e,s.addTo(e._layer);o._requestRedraw()},_onVertexDragStart:function(e){var t=this,r=t._layer._map,n=[e.mapX,e.mapY],o=t.virtualMouse,i=G.DomUtil,a=t._searchVertex(n);if(a){var s=r._handlers.Click;s&&s.off();var l=[a.geom[0],a.geom[1]],_=[0,0];if(r.options.wrap){var c=r._calcRealCoords(n);_[0]=c[0]-n[0],_[1]=c[1]-n[1],l=[c[0]+_[0],c[1]+_[1]]}t._drag={vertex:a,wrapOffset:_,startAt:+new Date},i.stopPropagation(e),i.preventDefault(e),r._handlers.Drag.off(),r.addListener(o.MOVE[e.type],t._onVertexDrag,t),r.addListener(o.UP[e.type],t._onVertexDragEnd,t)}},_onVertexDrag:function(e){var t,r,n,o=this,i=o._layer._map,a=o._drag;if(a&&(t=a.vertex)){wrapOffset=a.wrapOffset||[0,0];var s=i._calcRealCoords([e.mapX,e.mapY]);r=[s[0]+wrapOffset[0],s[1]+wrapOffset[1]],n=t._idVertex,o.geom.m[n]=t.geom=r,o.updateGeom(),t.updateGeom()}},_onVertexDragEnd:function(e){var t=this,r=t._layer._map,n=t.virtualMouse,o=G.DomUtil,i=r._handlers.Click;i&&i.on();var a,s,l=t._drag;l&&(o.stopPropagation(e),o.preventDefault(e),r._handlers.Drag.on(),a=l.vertex,a&&(s=a._idVertex,a.updateGeom())),r.removeListener(n.MOVE[e.type],t._onVertexDrag,t),r.removeListener(n.UP[e.type],t._onVertexDragEnd,t),t._drag=null}}),G.Graphic.MultiPolyline=G.Graphic.extend({options:{lineColor:"#ff941b",lineDashArray:[],lineCap:"butt",lineJoin:"round",lineWidth:4,lineOpacity:1},init:function(e,t,r){var n=this;e&&e.m&&e.m.length>0&&n._updateGeom(e),n.attrs=t||{},n.options=G.Util.merge({},n.options,r)},clone:function(){var e,t,r,n,o=this,i=o.geom,a=i.m,s=a.length,l=[];for(t=0;t<s;t++)for(r=a[t],l[t]=[],e=0;e<r.length;e++)n=r[e],l[t][e]=[n[0],n[1]];return new G.Graphic.MultiPolyline({m:l},G.Util.merge({},o.attrs),G.Util.merge({},o.options))},_updateGeom:function(e){for(var t,r,n,o,i,a,s,l,_=this,c=e||_.geom,m=c.m,d=0,u=m.length;d<u;d++){t=m[d];for(var p=0,h=t.length;p<h;p++)r=t[p],n=r[0],o=r[1],i=void 0===i?n:Math.min(i,n),a=void 0===a?n:Math.max(a,n),s=void 0===s?o:Math.min(s,o),l=void 0===l?o:Math.max(l,o)}_.geom=c,_.bbox=[i,s,a,l],_._onGeomUpdated()},_hitPointNowrap:function(e,t,r,n){for(var o,i=this,a=i.options,s=i._mouseOver?a.lineWidth+a.lineHighlightWiden:a.lineWidth,l=s/2+(n||0),_=l*t,c=i.geom.m,m=0,d=c.length;m<d;m++)if(o=c[m],G.GeomUtil._hitPolyline(e,o,_))return!0;return!1},_refreshVertexes:function(){var e=this,t=e.geom,r=t.m,n=e._layer._map,o=e.options;e._removeVertexes();var i,a,s,l,_,c,m;for(i=0,a=r.length;i<a;i++)for(_=r[i],s=0,l=_.length;s<l;s++)m=e._vertexes[i+","+s]=new G.Graphic.Point(_[s],null,{shape:o.vertexShape,size:[o.vertexSize,o.vertexSize],outline:!0,outlineColor:o.vertexColor,outlineDashArray:o.vertexDashArray,outlineWidth:o.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:o.vertexFillColor,fillOpacity:1,clickable:!0}),m._isVertex=!0,m._idVertex=[i,s],m._graphic=e,m.addTo(e._layer),s>0&&(c=G.GeomUtil._middlePoint(_[s-1],_[s]),m=e._midvertexes[i+","+s]=new G.Graphic.Point(c,null,{shape:o.vertexShape,size:[o.vertexSize,o.vertexSize],outline:!0,outlineColor:o.vertexColor,outlineDashArray:o.vertexDashArray,outlineWidth:o.vertexOutlineWidth,outlineOpacity:1,fill:!1,clickable:!0}),m._isVertex=!0,m._idVertex=[i,s],m._isMid=!0,m._graphic=e,m.addTo(e._layer));n._requestRedraw()},_onVertexDragStart:function(e){var t=this,r=t._layer._map,n=[e.mapX,e.mapY],o=t.virtualMouse,i=G.DomUtil,a=t._searchVertex(n);if(a){var s=r._handlers.Click;s&&s.off();var l=[a.geom[0],a.geom[1]],_=a._idVertex,c=_[0],m=_[1];if(a._isMid){var d=t.geom.m[c].slice(0,m);d=d.concat([l]),d=d.concat(t.geom.m[c].slice(m)),t.geom.m[c]=d,t._refreshVertexes(),a=t._searchVertex(n)}t._drag={vertex:a,startAt:+new Date},i.stopPropagation(e),i.preventDefault(e),r._handlers.Drag.off(),r.addListener(o.MOVE[e.type],t._onVertexDrag,t),r.addListener(o.UP[e.type],t._onVertexDragEnd,t)}},_onVertexDrag:function(e){var t,r,n,o,i,a,s,l,_,c=this,m=(c._layer._map,c._drag);if(m&&(t=m.vertex))for(r=[e.mapX,e.mapY],n=t._idVertex,o=n[0],i=n[1],c.geom.m[o][i]=t.geom=r,c.updateGeom(),t.updateGeom(),s=i;s<=i+1;s++)l=s>0?s-1:c.geom.m[o].length-1,_=s>=c.geom.m[o].length?0:s,a=c._midvertexes[o+","+_],a&&(a.geom=G.GeomUtil._middlePoint(c.geom.m[o][l],c.geom.m[o][_]),a.updateGeom())},_onVertexDragEnd:function(e){var t=this,r=t._layer._map,n=t.virtualMouse,o=G.DomUtil,i=r._handlers.Click;i&&i.on();var a,s,l,_,c,m=t._drag;if(m&&(o.stopPropagation(e),o.preventDefault(e),r._handlers.Drag.on(),a=m.vertex))if(l=a._idVertex,_=l[0],c=l[1],s=+new Date-m.startAt,s<200&&!a._isMid&&t.geom.m[_].length>2){var d;0==c?d=t.geom.m[_].slice(1,t.geom.m[_].length):c==t.geom.m[_].length-1?d=t.geom.m[_].slice(0,c):(d=t.geom.m[_].slice(0,c),d=d.concat(t.geom.m[_].slice(c+1))),t.geom.m[_]=d,t.updateGeom(),t._refreshVertexes()}else a.updateGeom();r.removeListener(n.MOVE[e.type],t._onVertexDrag,t),r.removeListener(n.UP[e.type],t._onVertexDragEnd,t),t._drag=null}}),G.Graphic.MultiPolygon=G.Graphic.extend({options:{outline:!0,outlineColor:"#ff2e6c",outlineDashArray:[],outlineCap:"round",outlineJoin:"round",outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#000",fillImage:"",fillImageSize:[24,24],fillOpacity:.6},init:function(e,t,r){var n=this;e&&e.m&&e.m.length>0&&n._updateGeom(e),n.attrs=t||{},n.options=G.Util.merge({},n.options,r)},clone:function(){var e,t,r,n,o,i,a=this,s=a.geom,l=s.m,_=l.length,c=[];for(e=0;e<_;e++)for(n=l[e],c[e]=[],t=0;t<n.length;t++)for(i=n[t],c[e][t]=[],r=0;r<i.length;r++)o=i[r],c[e][t][r]=[o[0],o[1]];return new G.Graphic.MultiPolygon({m:c},G.Util.merge({},a.attrs),G.Util.merge({},a.options))},_updateGeom:function(e){for(var t,r,n,o,i,a,s,l,_,c=this,m=e||c.geom,d=m.m,u=0,p=d.length;u<p;u++){t=d[u],r=t[0];for(var h=0,g=r.length;h<g;h++)n=r[h],o=n[0],i=n[1],a=void 0===a?o:Math.min(a,o),s=void 0===s?o:Math.max(s,o),l=void 0===l?i:Math.min(l,i),_=void 0===_?i:Math.max(_,i)}c.geom=m,c.bbox=[a,l,s,_],c._onGeomUpdated()},_hitPointNowrap:function(e,t,r,n){var o=this,i=o.options,a=e[0],s=e[1],l=[a,s],_=n||0,c=o._mouseOver?i.outlineWidth+i.lineHighlightWiden:i.outline?i.outlineWidth:0;c+=2*_;var m,d=c*t,u=d/2;if(o.bbox&&(m=[o.bbox[0]-u,o.bbox[1]-u,o.bbox[2]+u,o.bbox[3]+u],!G.ExtentUtil.contains(m,l)))return!1;var p,h,g,f,v,y,b,x,w,D=o.geom.m,M=G.Graphic.Polyline.prototype._hitPointNowrap;for(h=0,g=D.length;h<g;h++){if(p=D[h],G.GeomUtil._hitPolygon(l,p))return!0;if(i.outline||o._mouseOver)for(f=0,v=p.length;f<v;f++)if(y=p[f],b=[y[y.length-1],y[0]],x={geom:y,options:{lineWidth:c}},w={geom:b,options:{lineWidth:c}},M.call(x,l,t)||M.call(w,l,t))return!0}return!1},_refreshVertexes:function(){var e=this,t=e.geom,r=t.m,n=e._layer._map,o=e.options;e._removeVertexes();var i,a,s,l,_,c,m,d,u,p;for(i=0,a=r.length;i<a;i++)for(m=r[i],s=0,l=m.length;s<l;s++)for(d=m[s],_=0,c=d.length;_<c;_++)u=e._vertexes[i+","+s+","+_]=new G.Graphic.Point(d[_],null,{shape:o.vertexShape,size:[o.vertexSize,o.vertexSize],outline:!0,outlineColor:o.vertexColor,outlineDashArray:o.vertexDashArray,outlineWidth:o.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:o.vertexFillColor,fillOpacity:1,clickable:!0}),u._isVertex=!0,u._idVertex=[i,s,_],u._graphic=e,u.addTo(e._layer),p=0==_?G.GeomUtil._middlePoint(d[c-1],d[0]):G.GeomUtil._middlePoint(d[_-1],d[_]),u=e._midvertexes[i+","+s+","+_]=new G.Graphic.Point(p,null,{shape:o.vertexShape,size:[o.vertexSize,o.vertexSize],outline:!0,outlineColor:o.vertexColor,outlineDashArray:o.vertexDashArray,outlineWidth:o.vertexOutlineWidth,outlineOpacity:1,fill:!1,clickable:!0}),u._isVertex=!0,u._idVertex=[i,s,_],u._isMid=!0,u._graphic=e,u.addTo(e._layer);n._requestRedraw()},_onVertexDragStart:function(e){var t=this,r=t._layer._map,n=[e.mapX,e.mapY],o=t.virtualMouse,i=G.DomUtil,a=t._searchVertex(n);if(a){var s=r._handlers.Click;s&&s.off();var l=[a.geom[0],a.geom[1]],_=a._idVertex,c=_[0],m=_[1],d=_[2];if(a._isMid){var u=t.geom.m[c][m].slice(0,d);u=u.concat([l]),u=u.concat(t.geom.m[c][m].slice(d)),t.geom.m[c][m]=u,t._refreshVertexes(),a=t._searchVertex(n)}t._drag={vertex:a,startAt:+new Date},i.stopPropagation(e),i.preventDefault(e),r._handlers.Drag.off(),r.addListener(o.MOVE[e.type],t._onVertexDrag,t),r.addListener(o.UP[e.type],t._onVertexDragEnd,t)}},_onVertexDrag:function(e){var t,r,n,o,i,a,s,l,_,c,m=this,d=(m._layer._map,m._drag);if(d&&(t=d.vertex))for(r=[e.mapX,e.mapY],n=t._idVertex,o=n[0],i=n[1],a=n[2],m.geom.m[o][i][a]=t.geom=r,m.updateGeom(),t.updateGeom(),l=a;l<=a+1;l++)_=l>0?l-1:m.geom.m[o][i].length-1,c=l>=m.geom.m[o][i].length?0:l,s=m._midvertexes[o+","+i+","+c],s&&(s.geom=G.GeomUtil._middlePoint(m.geom.m[o][i][_],m.geom.m[o][i][c]),s.updateGeom())},_onVertexDragEnd:function(e){var t=this,r=t._layer._map,n=t.virtualMouse,o=G.DomUtil,i=r._handlers.Click;i&&i.on();var a,s,l,_,c,m,d=t._drag;if(d&&(o.stopPropagation(e),o.preventDefault(e),r._handlers.Drag.on(),a=d.vertex))if(l=a._idVertex,_=l[0],c=l[1],m=l[2],s=+new Date-d.startAt,s<200&&!a._isMid&&t.geom.m[_][c].length>3){var u;0==m?u=t.geom.m[_][c].slice(1,t.geom.m[_][c].length):m==t.geom.m[_][c].length-1?u=t.geom.m[_][c].slice(0,m):(u=t.geom.m[_][c].slice(0,m),u=u.concat(t.geom.m[_][c].slice(m+1))),t.geom.m[_][c]=u,t.updateGeom(),t._refreshVertexes()}else a.updateGeom();r.removeListener(n.MOVE[e.type],t._onVertexDrag,t),r.removeListener(n.UP[e.type],t._onVertexDragEnd,t),t._drag=null}}),G.Graphic.Circle=G.Graphic.extend({options:{outline:!0,outlineColor:"#fff",outlineDashArray:[],outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#000",fillImage:"",fillImageSize:[24,24],fillOpacity:.6,gradual:!1},init:function(e,t,r){var n=this;e&&3==e.length&&n._updateGeom(e),n.attrs=t||{},n.options=G.Util.merge({},n.options,r)},clone:function(){var e=this,t=e.geom[0],r=e.geom[1],n=e.geom[2];return new G.Graphic.Circle([t,r,n],G.Util.merge({},e.attrs),G.Util.merge({},e.options))},_updateGeom:function(e){var t,r,n,o,i,a,s,l=this,_=e||l.geom;t=_[0],r=_[1],n=_[2],o=t-n,i=t+n,a=r-n,s=r+n,l.geom=_,l.bbox=[o,a,i,s],l._onGeomUpdated()},_hitPointNowrap:function(e,t,r,n){var o=this,i=o.options,a=(i.outline?i.outlineWidth:0)+(o._mouseOver?i.lineHighlightWiden:0),s=o.geom,l=s[0],_=s[1],c=s[2],m=e[0],d=e[1],u=(m-l)/t,p=-(d-_)/t,h=c/t;return G.MathUtil.calcHypotenuse(u,p)<h+a/2+(n||0)},_refreshVertexes:function(){var e=this,t=e.geom,r=(t.length,e._layer._map),n=e.options;e._removeVertexes();var o,i={shape:n.vertexShape,size:[n.vertexSize,n.vertexSize],outline:!0,outlineColor:n.vertexColor,outlineDashArray:n.vertexDashArray,outlineWidth:n.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:n.vertexFillColor,fillOpacity:1,clickable:!0},a=[t[0],t[1]],s=[t[2],0];s=G.MathUtil.rotateVector(s,r._rotate);var l=[t[0]+s[0],t[1]+s[1]];o=e._vertexes[0]=new G.Graphic.Point(a,null,i),o._isVertex=!0,o._idVertex=0,o._graphic=e,o.addTo(e._layer);var o=e._vertexes[1]=new G.Graphic.Point(l,null,i);o._isVertex=!0,o._idVertex=1,o._graphic=e,o.addTo(e._layer),r._requestRedraw()},_onVertexDragStart:function(e){var t=this,r=t._layer._map,n=[e.mapX,e.mapY],o=t.virtualMouse,i=G.DomUtil,a=t._searchVertex(n);if(a){var s=r._handlers.Click;s&&s.off();var l=[a.geom[0],a.geom[1]],_=[0,0];if(r.options.wrap){var c=r._calcRealCoords(n);_[0]=c[0]-n[0],_[1]=c[1]-n[1],l=[c[0]+_[0],c[1]+_[1]]}t._drag={vertex:a,wrapOffset:_,startAt:+new Date},i.stopPropagation(e),i.preventDefault(e),r._handlers.Drag.off(),r.addListener(o.MOVE[e.type],t._onVertexDrag,t),r.addListener(o.UP[e.type],t._onVertexDragEnd,t)}},_onVertexDrag:function(e){var t,r,n,o,i=this,a=i._layer._map,s=i._drag;if(s&&(t=s.vertex)){wrapOffset=s.wrapOffset||[0,0];var l=a._calcRealCoords([e.mapX,e.mapY]);r=[l[0]+wrapOffset[0],l[1]+wrapOffset[1]],t.updateGeom(r),t._idVertex?(n=i._vertexes[0],i.geom[2]=G.MathUtil.calcDistance(n.geom,r)):(n=i._vertexes[1],o=[i.geom[2],0],o=G.MathUtil.rotateVector(o,a._rotate),n.updateGeom([i.geom[0]+o[0],i.geom[1]+o[1]]),i.geom[0]=r[0],i.geom[1]=r[1]),i.updateGeom()}},_onVertexDragEnd:function(e){var t=this,r=t._layer._map,n=t.virtualMouse,o=G.DomUtil,i=r._handlers.Click;i&&i.on();var a,s=t._drag;s&&(o.stopPropagation(e),o.preventDefault(e),r._handlers.Drag.on(),a=s.vertex,a&&a.updateGeom()),r.removeListener(n.MOVE[e.type],t._onVertexDrag,t),r.removeListener(n.UP[e.type],t._onVertexDragEnd,t),t._drag=null}}),G.Graphic.Arrow=G.Graphic.Polygon.extend({options:{headSize:30,headAngle:30,neckSize:25,neckAngle:15,tailSize:0,tailAngle:60,outline:!0,outlineColor:"#ff2e6c",outlineDashArray:[],outlineCap:"round",outlineJoin:"round",outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#000",fillImage:"",fillImageSize:[24,24],fillOpacity:.6},init:function(e,t,r){var n=this;e&&e.length>0&&n._updateGeom(e),n.attrs=t||{},n.options=G.Util.merge({},n.options,r)},clone:function(){for(var e=this,t=e.geom,r=[],n=0;n<t.length;n++)pt=t[n],r[n]=[pt[0],pt[1]];return new G.Graphic.Arrow(r,G.Util.merge({},e.attrs),G.Util.merge({},e.options))},_updateGeom:function(e){for(var t,r,n,o,i,a,s,l=this,_=e||l.geom,c=0,m=0,d=_.length;m<d;m++)t=_[m],r=t[0],n=t[1],o=void 0===o?r:Math.min(o,r),i=void 0===i?r:Math.max(i,r),a=void 0===a?n:Math.min(a,n),s=void 0===s?n:Math.max(s,n),m>0&&(c+=G.MathUtil.calcDistance(_[m],_[m-1]));l.length=c,l.geom=_,l.bbox=[o,a,i,s],l._onGeomUpdated()},_onGeomUpdated:function(){var e=this,t=e._layer;if(t){var r=t._map;r&&(e._resDraw=null,e._updateGeomDraw(r._res))}},_updateGeomDraw:function(e){var t=this,r=t.options,n=G.MathUtil,o=Math.sin,i=Math.cos,a=Math.max,s=Math.min,l=Math.PI,_=t._layer;if(_&&!(e>0&&t._resDraw==e)){for(var c,m,d,u,p,h,g,f,v,y,b,x,w,D=t.geom,M=D.length,E=n.calcDistance(D[M-1],D[M-2])/e,S=E>2*r.headSize?1:E/r.headSize/2,U=r.headSize*e*S,C=(r.headAngle/n.DEGREE_PER_RADIAN,r.neckSize*e*S),T=r.neckAngle/n.DEGREE_PER_RADIAN,A=r.tailSize*e,P=r.tailAngle/n.DEGREE_PER_RADIAN,R=t.length-C*i(T),L=C*o(T),O=A*o(P),z=[],V=[],k=L-O,I=0,W=0,N=M-1;W<N;W++)p=D[W],h=D[W+1],0==W?(g=n.calcTheta(p[0]-h[0],p[1]-h[1]),f=r.tailAngle/n.DEGREE_PER_RADIAN,b=[A*i(g-f),A*o(g-f)],z.push([p[0]+b[0],p[1]+b[1]]),b=[A*i(g+f),A*o(g+f)],V.push([p[0]+b[0],p[1]+b[1]])):(u=D[W-1],x=O+k*I,v=n.calcTheta(p[0]-u[0],p[1]-u[1]),y=n.calcTheta(h[0]-p[0],h[1]-p[1]),g=(v+y)/2+l/2,f=(v-y)/2,w=i(f),x/=Math.abs(w)<.1?.1*(w>0?1:-1):w,b=[x*i(g),x*o(g)],z.push([p[0]+b[0],p[1]+b[1]]),b=[x*i(g+l),x*o(g+l)],V.push([p[0]+b[0],p[1]+b[1]])),I+=n.calcDistance(p,h)/R;p=D[M-1],u=D[M-2],g=n.calcTheta(u[0]-p[0],u[1]-p[1]),f=r.neckAngle/n.DEGREE_PER_RADIAN,b=[C*i(g-f),C*o(g-f)],z.push([p[0]+b[0],p[1]+b[1]]),b=[C*i(g+f),C*o(g+f)],V.push([p[0]+b[0],p[1]+b[1]]),f=r.headAngle/n.DEGREE_PER_RADIAN,b=[U*i(g-f),U*o(g-f)],z.push([p[0]+b[0],p[1]+b[1]]),b=[U*i(g+f),U*o(g+f)],V.push([p[0]+b[0],p[1]+b[1]]);var F=[];F.push(D[0]),F=F.concat(z),F.push(D[M-1]),F=F.concat(V.reverse());for(var Z,Y,j,B,W=0,H=F.length;W<H;W++)c=F[W],m=c[0],d=c[1],Z=void 0===Z?m:s(Z,m),Y=void 0===Y?m:a(Y,m),j=void 0===j?d:s(j,d),B=void 0===B?d:a(B,d);t._geomDraw=[F],t._resDraw=e,t._updateBbox([Z,j,Y,B])}},_hitPointNowrap:function(e,t,r,n){var o=this,i=o.options;o._updateGeomDraw(t);var a=e[0],s=e[1],l=[a,s],_=n||0,c=o._mouseOver?i.outlineWidth+i.lineHighlightWiden:i.outline?i.outlineWidth:0;c+=2*_;var m,d=c*t,u=d/2;if(o.bbox&&(m=[o.bbox[0]-u,o.bbox[1]-u,o.bbox[2]+u,o.bbox[3]+u],!G.ExtentUtil.contains(m,l)))return!1;var p,h,g,f,v,y,b=o._geomDraw,x=G.Graphic.Polyline.prototype._hitPointNowrap;if(i.outline||o._mouseOver)for(p=0,h=b.length;p<h;p++)if(g=b[p],f=[g[g.length-1],g[0]],v={geom:g,options:{lineWidth:c}},y={geom:f,options:{lineWidth:c}},x.call(v,l,t)||x.call(y,l,t))return!0;return G.GeomUtil._hitPolygon(l,b)},_refreshVertexes:function(){var e=this,t=e.geom,r=t.length,n=e._layer._map,o=e.options;e._removeVertexes();var i,a,s;for(i=0;i<r;i++)a=e._vertexes[i]=new G.Graphic.Point(t[i],null,{shape:o.vertexShape,size:[o.vertexSize,o.vertexSize],outline:!0,outlineColor:o.vertexColor,outlineDashArray:o.vertexDashArray,outlineWidth:o.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:o.vertexFillColor,fillOpacity:1,clickable:!0}),a._isVertex=!0,a._idVertex=i,a._graphic=e,a.addTo(e._layer),i>0&&(s=G.GeomUtil._middlePoint(t[i-1],t[i]),a=e._midvertexes[i]=new G.Graphic.Point(s,null,{shape:o.vertexShape,size:[o.vertexSize,o.vertexSize],outline:!0,outlineColor:o.vertexColor,outlineDashArray:o.vertexDashArray,outlineWidth:o.vertexOutlineWidth,outlineOpacity:1,fill:!1,clickable:!0}),a._isVertex=!0,a._idVertex=i,a._isMid=!0,a._graphic=e,a.addTo(e._layer));n._requestRedraw()},_onVertexDragStart:function(e){var t=this,r=t._layer._map,n=[e.mapX,e.mapY],o=t.virtualMouse,i=G.DomUtil,a=t._searchVertex(n);if(a){var s=r._handlers.Click;s&&s.off();var l=[a.geom[0],a.geom[1]],_=a._idVertex,c=[0,0];if(r.options.wrap){var m=r._calcRealCoords(n);c[0]=m[0]-n[0],c[1]=m[1]-n[1],l=[m[0]+c[0],m[1]+c[1]]}if(a._isMid){var d=t.geom.slice(0,_);d=d.concat([l]),d=d.concat(t.geom.slice(_)),t.geom=d,t._refreshVertexes(),a=t._searchVertex(n)}t._drag={vertex:a,wrapOffset:c,startAt:+new Date},i.stopPropagation(e),i.preventDefault(e),r._handlers.Drag.off(),r.addListener(o.MOVE[e.type],t._onVertexDrag,t),r.addListener(o.UP[e.type],t._onVertexDragEnd,t)}},_onVertexDrag:function(e){var t,r,n,o,i,a=this,s=a._layer._map,l=a._drag;if(l&&(t=l.vertex)){wrapOffset=l.wrapOffset||[0,0];var _=s._calcRealCoords([e.mapX,e.mapY]);for(r=[_[0]+wrapOffset[0],_[1]+wrapOffset[1]],n=t._idVertex,a.geom[n]=t.geom=r,a.updateGeom(),t.updateGeom(),i=n;i<=n+1;i++)o=a._midvertexes[i],o&&(o.geom=G.GeomUtil._middlePoint(a.geom[i-1],a.geom[i]),o.updateGeom())}},_onVertexDragEnd:function(e){var t=this,r=t._layer._map,n=t.virtualMouse,o=G.DomUtil,i=r._handlers.Click;i&&i.on();var a,s,l,_=t._drag;if(_&&(o.stopPropagation(e),o.preventDefault(e),r._handlers.Drag.on(),a=_.vertex))if(l=a._idVertex,s=+new Date-_.startAt,s<200&&!a._isMid&&t.geom.length>2){var c=t.geom.slice(0,l);c=c.concat(t.geom.slice(l+1)),t.geom=c,t.updateGeom(),t._refreshVertexes()}else a.updateGeom();r.removeListener(n.MOVE[e.type],t._onVertexDrag,t),r.removeListener(n.UP[e.type],t._onVertexDragEnd,t),t._drag=null}}),G.Graphic.OD=G.Graphic.Polyline.extend({options:{curvature:.3,curvePosition:.5,direction:"left",shadow:!1,shadowColor:"#fff",symbol:"",symbolSize:6,symbolOnly:!1,lineColor:"#ff941b",lineDashArray:[],lineCap:"butt",lineJoin:"round",lineWidth:4,lineOpacity:1},init:function(e,t,r){var n=this;n.attrs=t||{},n.options=G.Util.merge({},n.options,r),e&&e.length>0&&(n._calcODPoint(e),n._updateGeom(e),n.options.symbol&&n._initSymbol(n.options.symbol))},clone:function(){for(var e=this,t=e.geom,r=[],n=0;n<t.length;n++)pt=t[n],r[n]=[pt[0],pt[1]];return new G.Graphic.Polyline(r,G.Util.merge({},e.attrs),G.Util.merge({},e.options))},_updateGeom:function(e){for(var t,r,n,o,i,a,s,l=this,_=e||l.geom,c=0,m=l._odLines.length;c<m;c++)t=l._odLines[c],r=t[0],n=t[1],o=void 0===o?r:Math.min(o,r),i=void 0===i?r:Math.max(i,r),a=void 0===a?n:Math.min(a,n),s=void 0===s?n:Math.max(s,n);l.geom=_,l.bbox=[o,a,i,s],l._onGeomUpdated()},_calcODPoint:function(e){for(var t,r,n,o,i,a,s,l=this,_=e[0],c=e[1],m=l._calcMidPoint(_,c),d=0,u=[],p=0;p<=100;p+=1)d=.01*p,t=_[0]+(m[0]-_[0])*d,r=_[1]+(m[1]-_[1])*d,n=m[0]+(c[0]-m[0])*d,o=m[1]+(c[1]-m[1])*d,i=t+(n-t)*d,a=r+(o-r)*d,s=[i,a],u.push(s);l._odLines=u},_calcMidPoint:function(e,t){var r,n,o,i,a,s=this,l="right"==s.options.direction?-1:1;return r=G.MathUtil.calcTheta(t[0]-e[0],t[1]-e[1]),n=G.MathUtil.calcDistance(t,e),a=s.options.curvature,a=a>1?1:a<0?0:a,o=[n*s.options.curvePosition,n*a*l],i=G.MathUtil.rotateVector(o,G.MathUtil.DEGREE_PER_RADIAN*r),[i[0]+e[0],i[1]+e[1]]},_hitPointNowrap:function(e,t,r,n){var o=this;if(o._playing)return!1;var i=o.options,a=o._mouseOver?i.lineWidth+i.lineHighlightWiden:i.lineWidth,s=a/2+(n||0),l=s*t;return G.GeomUtil._hitPolyline(e,o._odLines,l)}}),G.Graphic.Group=G.Graphic.extend({options:{},init:function(e,t,r){var n=this;n.options=G.Util.merge({},n.options,r),n.attrs=t||{},n.bbox=null,n._graphics=[];var o,i,a;if(e&&e.length)for(o=0,i=e.length;o<i;o++)a=e[o],a._parentGraphic=n,n._append(a)},clone:function(){var e=this;return new G.Graphic.Group(e._graphics,G.Util.merge({},e.attrs),G.Util.merge({},e.options))},child:function(e){return this._graphics[e]},children:function(){return this._graphics},_onAdded:function(){var e,t,r,n=this,o=n._graphics;if(o&&o.length)for(e=0,t=o.length;e<t;e++)r=o[e],r._layer=n._layer,r._onAdded()},_onRemoved:function(){var e,t,r,n=this,o=n._graphics;if(o&&o.length)for(e=0,t=o.length;e<t;e++)r=o[e],r._onRemoved(),r._layer=null},_append:function(e){var t=this;e instanceof G.Graphic&&(e._layer=t._layer,e.options.clickable=t.options.clickable,e.options.allowPan=t.options.allowPan,t._graphics.push(e),t.bbox=G.ExtentUtil.union(t.bbox,e.bbox))},_draw:function(){var e,t,r,n=this,o=n._graphics;if(o&&o.length)for(e=0,t=o.length;e<t;e++)r=o[e],r._draw&&r._layer&&r._draw()},_erase:function(){var e,t,r,n=this,o=n._graphics;if(o&&o.length)for(e=0,t=o.length;e<t;e++)r=o[e],r._erase&&r._layer&&r._erase()},_hitPointNowrap:function(e,t,r,n){var o,i,a,s=this,l=s._graphics;if(l&&l.length)for(o=0,i=l.length;o<i;o++)if(a=l[o],a._hitPointNowrap&&a._hitPointNowrap(e,t,r,n))return!0;return!1},startEdit:function(e){var t,r,n,o=this,i=o._graphics;if(i&&i.length)for(t=0,r=i.length;t<r;t++)n=i[t],n.startEdit&&n.startEdit(e);o._editing=!0},endEdit:function(){var e,t,r,n=this,o=n._graphics;if(o&&o.length)for(e=0,t=o.length;e<t;e++)r=o[e],r.endEdit&&r.endEdit();n._editing=!1}}),G.Layer=G.Class.extend({mixins:[G.Event],options:{name:null},addTo:function(e){var t,r=this;return r._map&&void 0!==r._id?r._map===e?r:null:(r._map=e,t=r._id=e._layerIdSeq++,e._layers[t]=r,e._layerOrder.push(t),r._zIndex=e._layerOrder.length-1,e.addListener("resize",r._onResize,r),e.addListener("viewChanged",r._onViewChanged,r),e.addListener("zoomStart",r._onZoomStart,r),e.addListener("zoomUpdate",r._onZoomUpdate,r),e.addListener("zoom",r._onZoom,r),e.addListener("zoomEnd",r._onZoomEnd,r),e.addListener("moveStart",r._onMoveStart,r),e.addListener("move",r._onMove,r),e.addListener("moveEnd",r._onMoveEnd,r),e.addListener("rotateStart",r._onRotateStart,r),e.addListener("rotate",r._onRotate,r),e.addListener("rotateEnd",r._onRotateEnd,r),e.addListener("pinchStart",r._onPinchStart,r),e.addListener("pinch",r._onPinch,r),e.addListener("pinchEnd",r._onPinchEnd,r),r._onAdded(),e.fireEvent("layerAdded",{layer:r}),e._requestUpdate(),r)},remove:function(){var e=this;if(e._map&&void 0!==e._id){var t,r,n=e._map,o=n._layerOrder.length;for(t=o-1;t>=0;t--)r=n._layerOrder[t],r==e._id&&n._layerOrder.splice(t,1);return delete n._layers[e._id],delete e._id,n.removeListener("resize",e._onResize,e),n.removeListener("viewChanged",e._onViewChanged,e),n.removeListener("zoomStart",e._onZoomStart,e),n.removeListener("zoomUpdate",e._onZoomUpdate,e),n.removeListener("zoom",e._onZoom,e),n.removeListener("zoomEnd",e._onZoomEnd,e),n.removeListener("moveStart",e._onMoveStart,e),n.removeListener("move",e._onMove,e),n.removeListener("moveEnd",e._onMoveEnd,e),n.removeListener("rotateStart",e._onRotateStart,e),n.removeListener("rotate",e._onRotate,e),n.removeListener("rotateEnd",e._onRotateEnd,e),n.removeListener("pinchStart",e._onPinchStart,e),n.removeListener("pinch",e._onPinch,e),n.removeListener("pinchEnd",e._onPinchEnd,e),e._onRemoved(),n.fireEvent("layerRemoved",{layer:e}),n._requestRedraw(),e}},getOrder:function(){var e,t=this,r=t._map;for(e in r._layerOrder)if(r._layerOrder[e]==t._id)return e;return-1},bringToOrder:function(e){for(var t=this,r=t._map,n=r._layerOrder.length,o=-1,i=0;i<n;i++)if(r._layerOrder[i]==t._id){o=i;break}var a=e||0;return a<0&&(a=0),a>n-1&&(a=n-1),r._layerOrder.splice(i,1),r._layerOrder.splice(a,0,t._id),t._afterReorder(),r._requestRedraw(),t},bringToTop:function(){for(var e=this,t=e._map,r=t._layerOrder.length,n=0;n<r;n++)if(t._layerOrder[n]==e._id){t._layerOrder.splice(n,1);break}return t._layerOrder.push(e._id),e._afterReorder(),t._requestRedraw(),e.fireEvent("orderChange",{order:t._layerOrder.length-1}),e},bringToBottom:function(){for(var e=this,t=e._map,r=t._layerOrder.length,n=0;n<r;n++)if(t._layerOrder[n]==e._id){t._layerOrder.splice(n,1);break}return t._layerOrder=[e._id].concat(t._layerOrder),e._afterReorder(),t._requestRedraw(),e.fireEvent("orderChange",{order:0}),e},bringUp:function(e){for(var t=this,r=t._map,n=r._layerOrder.length,o=-1,i=0;i<n;i++)if(r._layerOrder[i]==t._id){o=i;break}var a=o+(e||1);return a>n-1&&(a=n-1),r._layerOrder.splice(i,1),r._layerOrder.splice(a,0,t._id),t._afterReorder(),r._requestRedraw(),t.fireEvent("orderChange",{order:a}),t},bringDown:function(e){for(var t=this,r=t._map,n=r._layerOrder.length,o=-1,i=0;i<n;i++)if(r._layerOrder[i]==t._id){o=i;break}var a=o-(e||1);return a<0&&(a=0),r._layerOrder.splice(i,1),r._layerOrder.splice(a,0,t._id),t._afterReorder(),r._requestRedraw(),t.fireEvent("orderChange",{order:a}),t},hide:function(){var e=this,t=e._map;return e._hidden?e:(e._hidden=!0,e._erase&&e._erase(),t&&t._requestRedraw(),e.fireEvent("visibleChange",{visible:!1}),e)},show:function(){var e=this,t=e._map;return e._hidden?(e._hidden=!1,t&&(t._requestRedraw(),t._requestUpdate()),e.fireEvent("visibleChange",{visible:!0}),e):e},isVisible:function(){var e=this,t=e._map;if(e._hidden)return!1;if(!t)return!1;var r=e.options,n=r.minRes,o=r.maxRes,i=t._res;return!(o&&o<i)&&!(n&&n>i)},_afterReorder:function(){var e,t,r,n,o=this,i=o._map;for(e in i._layerOrder)t=parseInt(e),r=i._layerOrder[t],n=i._layers[r],n&&(n._zIndex=t)},setLegend:function(e){var t=this;t._legend=e,t.fireEvent("legendChange",{legend:e})},setName:function(e){var t=this;t.name=e,t.fireEvent("nameChange",{name:e})},clear:function(){return this},_onClear:function(){},_update:function(){},_draw:function(){},_erase:function(){},_onResize:function(e){},_onViewChanged:function(e){},_onAdded:function(){},_onRemoved:function(){},_onZoomStart:function(e){},_onZoomUpdate:function(e){},_onZoom:function(e){},_onZoomEnd:function(e){},_onMoveStart:function(e){},_onMove:function(e){},_onMoveEnd:function(e){},_onRotateStart:function(e){},_onRotate:function(e){},_onRotateEnd:function(e){},_onPinchStart:function(e){},_onPinch:function(e){},_onPinchEnd:function(e){}}),G.Layer.Filter={setFilters:function(e,t){var r,n,o,i,a,s=this,l=s._map;if(e&&t&&(r=Math.min(e.length,t.length),r>0)){var _=s._filters={};for(n=0;n<r;n++)i=e[n],a=t[n],o=i+","+a,_[o]=[i,a];s._dirty=!0}return l&&l._requestRedraw(),s},clearFilters:function(){var e=this,t=e._map;return e._filters=null,e._dirty=!0,t&&t._requestRedraw(),e},_calcFilter:function(attrs){var self=this,filters=self._filters;if(!filters||!attrs)return!0;var field,condition,match;for(var key in filters)if(filters[key]&&(field=filters[key][0],condition=filters[key][1],match=eval('"'+attrs[field]+'"'+condition),!match))return!1;return!0}},G.Layer.LOD={options:{originX:-20037508.342784,originY:20037508.342784,minX:-20037508.342784,maxX:20037508.342784,minY:-20037508.342784,maxY:20037508.342784,tileSize:256,zoomReses:[156543.033928,78271.516964,39135.758482,19567.879241,9783.9396205,4891.96981025,2445.984905125,1222.9924525625,611.49622628125,305.748113140625,152.8740565703125,76.43702828515625,38.21851414257813,19.10925707128906,9.55462853564453,4.777314267822266,2.388657133911133,1.194328566955567,.597164283477783,.298582141738892],maxRes:156543.033928,minRes:.298582141738892},_polygonIntersected:function(e,t){
for(var r=this,n=0;n<t.length;n++)if(r._polygonContainsPoint(e,t[n]))return!0;return!1},_polygonContainsPoint:function(e,t){for(var r=t[0],n=t[1],o=!1,i=0,a=e.length-1;i<e.length;a=i++){var s=e[i][0],l=e[i][1],_=e[a][0],c=e[a][1],m=l>n!=c>n&&r<(_-s)*(n-l)/(c-l)+s;m&&(o=!o)}return o},_calcVisTileInfos:function(e){var t,r,n,o=this,i=o._map,a=i.getSize(),s=i.getCenter(),l=o.options,_=i.options,c=i._rotate,m=G.MathUtil.degToRad(c),d=l.tileSize,u=o._calcNearestZoom(e),p=i._res,h=l.zoomReses[u],g=d*h,f=h/i._res,v=d*f,y=Math.abs,b=Math.sin,x=Math.cos,w=(Math.tan,y(a[0]*x(m))+y(a[1]*b(m))),D=y(a[0]*b(m))+y(a[1]*x(m)),M=Math.ceil(w/v/2),E=Math.ceil(w/v/2),S=Math.ceil(D/v/2),U=Math.ceil(D/v/2);"webgl"===i._mode&&(t=i._getViewport(),r=i._getViewportQuad(),n=[[r[0][0]*p+s[0],-r[0][1]*p+s[1]],[r[1][0]*p+s[0],-r[1][1]*p+s[1]],[r[2][0]*p+s[0],-r[2][1]*p+s[1]],[r[3][0]*p+s[0],-r[3][1]*p+s[1]]],M=Math.ceil(t[0]/v),E=Math.ceil(t[1]/v),S=Math.ceil(t[2]/v),U=Math.ceil(t[3]/v));for(var C,T,A,P,R,L=o._calcTileIndex(s[0],s[1],u),O=L[0]-M,z=L[0]+E,V=L[1]-S,k=L[1]+U,I=-Math.max(i.options.tolerance||0,i._res/10),W=void 0!==l.minX&&void 0!==l.minY&&void 0!==l.maxX&&void 0!==l.maxY,N=[],F=[l.minX,l.minY,l.maxX,l.maxY],Z=i.options.maxExtent,Y=G.ExtentUtil.intersect(F,Z),j=(G.ExtentUtil.overlaps,O);j<=z;j++){if(T=l.originX+j*g,A=T+g,C=j,_.wrap){var B=i._calcRealCoords([T,0]);T=B[0],A=T+g,C=Math.round((T-l.originX)/g)}for(var H=V;H<=k;H++)if(!W||(P=l.originY-(H+1)*g,R=l.originY-H*g,G.ExtentUtil.overlaps([T,P,A,R],Y,I))){if("webgl"===i._mode){P=l.originY-(H+1)*g,R=l.originY-H*g;var X=[[T,P],[T,R],[A,R],[A,P]];if(_.wrap)for(var q=0;q<4;q++)for(var Q=i._calcWrapPointRange(X[q])||[0,0],J=i.options.maxExtent,K=J[2]-J[0],$=Q[0];$<=Q[1];$++)X.push([X[q][0]+$*K,X[q][1]]);var ee=o._polygonIntersected(n,X);if(!ee)continue}N.push([C,H,u])}}return N},_sortTileInfos:function(e,t,r){var n,o;e.sort(function(e,i){return n=Math.pow(e[0]-t,2)+Math.pow(e[1]-r,2),o=Math.pow(i[0]-t,2)+Math.pow(i[1]-r,2),Math.abs(n-o)})},_calcNearestZoom:function(e){for(var t,r=this,n=r._map,o=n._res,i=o/100,a=r.options.zoomReses,s=0,l=0,_=a.length;l<_;l++){if(t=a[l],o>t+i)return e?l:s;if(o<=t+i&&o>t-i)return l;s=l}return 0},_calcTileIndex:function(e,t,r){var n=this.options,o=Number(n.zoomReses[r]);if(!o)return[-1,-1];var i=n.tileSize*o,a=e-n.originX,s=n.originY-t,l=Math.floor(a/i),_=Math.floor(s/i);return[l,_]},_calcTileExtent:function(e,t,r){var n=this.options,o=Number(n.zoomReses[r]);if(o){var i=n.tileSize*o,a=i*e,s=i*t,l=a+n.originX,_=n.originY-s;return[l,_-i,l+i,_]}},_getTileName:function(e,t,r){return e+","+t+","+r},_getTileUrl:function(e,t,r,n){var o=this,i=o.url,a=G.Util,s=o.options.cluster;if(i){var l,_=n?n.scale||1:1;l=a.isFunction(i)?i(r,e,t,_):i;var c;if(a.isArray(s)&&s.length>0){var m=Math.abs(e+t)%s.length;c=s[m]}var d=a.renderString(l,G.Util.merge({s:c,z:r,x:e,y:t,i:_>1?"@2x":""},n));return d}},_tileOverlap:function(e,t){var r=this,n=r._calcTileExtent(e[0],e[1],e[2]),o=r._calcTileExtent(t[0],t[1],t[2]);return G.ExtentUtil.overlaps(n,o)}},G.Layer.LOD.calcNearestZoom=G.Layer.LOD._calcNearestZoom,G.Layer.LOD.calcTileIndex=G.Layer.LOD._calcTileIndex,G.Layer.LOD.calcTileExtent=G.Layer.LOD._calcTileExtent,G.Layer.Tile=G.Layer.extend({mixins:[G.Layer.LOD],options:{cluster:[],errorTileUrl:"",opacity:1,tileLiveMs:6e5,tileEnlarge:!0,keepResample:!0,filter:"",retryTimes:3,crossOrigin:"*",extent:null},statics:{EMPTY_TILE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxOWUzZTA0YS1lOWFjLTljNDctODI5ZS0yMjM3YTQ3YzU3MzciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU5MjRFQkZCOTQxMTFFMzlDQjA5NkM1REQ1MEUwODciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU5MjRFQkVCOTQxMTFFMzlDQjA5NkM1REQ1MEUwODciIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmU5MjNlNDE0LWNlOTktMzk0My1hZjRjLTgwZjhiOGY1MjY0NCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxOWUzZTA0YS1lOWFjLTljNDctODI5ZS0yMjM3YTQ3YzU3MzciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz54esASAAAAEElEQVR42mL4//8/A0CAAQAI/AL+26JNFgAAAABJRU5ErkJggg=="},init:function(e,t){var r=this;r.url=e,r.options=G.Util.merge({},r.options,t),r._tiles={},r._idleTiles=[]},setUrl:function(e){var t=this;return t.url=e,t.clear(),t},clear:function(){for(var e,t=this,r=t._map,n=t._tiles,o=0,i=n.length;o<i;o++)e=n[o],t._stopLoadingTile(e);return t._tiles={},t._idleTiles=[],t._onClear(),r&&r._requestUpdate(),t},_tileInfoExist:function(e,t){for(var r,n=0,o=t.length;n<o;n++)if(r=t[n],r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return!0;return!1},_onAdded:function(){var e=this,t=e._map;e._container||e._initContainer(),t._zoomReses=e.options.zoomReses},_onRemoved:function(){var e=this,t=e._map;e._container&&e._destroyContainer();for(var r,n,o=0,i=t._layers.length;o<i;o++)if(n=t._layers[o],n instanceof G.Layer.Tile){r=n;break}r||delete t._zoomReses},_stopLoadingTiles:function(e){for(var t,r=e.getElementsByTagName("img"),n=0,o=r.length;n<o;n++)t=r[n],this._stopLoadingTile(t)},_stopLoadingTile:function(e){if(e&&!e.complete){var t=G.Browser;t.android||(e.onload=null,e.onerror=null,e.src="");var r=e.parentNode;r&&r.removeChild(e)}},_removeTile:function(e){var t=this,r=t._tiles[e];if(r){if(t._stopLoadingTile(r),r._wraps){for(var n in r._wraps){var o=r._wraps[n];o&&o.parentNode&&o.parentNode.removeChild(o)}r._wraps={}}var i=r.parentNode;i&&i.removeChild(r),t._onTileRemoved(r),G.DomUtil.removeClass(r,"g-tile-loaded"),t._idleTiles.push(r),delete t._tiles[e]}},_resetTile:function(e){e._loaded=!1,e._responseTime=null,e._retried=0,e.src=""},_getIdleTile:function(){var e=this;if(e._idleTiles.length>0){var t=e._idleTiles.pop();return e._resetTile(t),t}return e._createTile()},_createTile:function(){var e=this.options,t=G.DomUtil.create("img","g-tile"),r=e.tileSize,n=G.Browser.getPxRatio();return G.DomUtil.setSize(t,r/n[0],r/n[1]),t._retried=0,e.crossOrigin&&(t.crossOrigin=e.crossOrigin),t},_placeTile:function(e,t,r,n,o){var i=this,a=G.Browser.getPxRatio(),s=a[0],l=a[1],_=i._map,c=_._rotate,m=_.getSize(),d=_.getCenter(),u=_._res,p=i.options,h=_.options,g=p.tileSize,f=p.zoomReses[n],v=g*f,y=p.tileEnlarge&&(!!(c%90)||G.Browser.gecko||G.Browser.safari),b=Math.ceil(v/u)+(y?2:0),x=(p.originX+t*v-d[0])/u/s+m[0]/2,w=-(p.originY-r*v-d[1])/u/l+m[1]/2,D=G.DomUtil;if(D.markScaleTransform(e,1/s,1/l),D.markPosTransform(e,x,w),D.markSizeTransform(e,b,b),D.updateTransform(e),D.updateOpacity(e,p.opacity),void 0===o){var M=p.zoomReses.length,E=i._calcNearestZoom(!0);o=n==E?M+1:n}D.setZIndex(e,o);var S;if(h.wrap&&!e._isWrap){var U=0,C=0,T=h.maxExtent,A=i._redrawExtent;if(A&&T){var P=T[2]-T[0];C=Math.floor((A[0]-p.minX)/P)-1,U=Math.ceil((A[2]-p.maxX)/P)+1}e._wraps=e._wraps||{};for(var R in e._wraps)(R>U||R<C)&&(S=e._wraps[R],S&&S.parentNode&&(S.parentNode.removeChild(S),delete e._wraps[R]));for(var L=C;L<=U;L++)0!==L&&(S=e._wraps[L],S||(S=e._wraps[L]=G.DomUtil.create("img","g-tile"),S._isWrap=!0,D.addClass(S,"g-tile-wrap"),S.crossOrigin=e.crossOrigin,S.src=e.src,S._info=e._info,S._loaded=!0,D.addClass(S,"g-tile-loaded"),i._onNewWrapTile(e,L)),x=(p.originX+t*v-d[0]+L*P)/u/s+m[0]/2,D.markScaleTransform(S,1/s,1/l),D.markPosTransform(S,x,w),D.markSizeTransform(S,b,b),D.updateTransform(S),D.updateOpacity(S,p.opacity),D.setZIndex(S,o))}},_checkAllHandled:function(){var e=this;if(e._numLoad==e._numLoadSuccess+e._numLoadError){var t,r,n,o=4,i=1/8;for(var a in e._tiles)t=e._tiles[a],r=G.DomUtil.getSize(t),n=r[0]/e.options.tileSize,(n>o||n<i)&&e._removeTile(a);e._clearBgBuffer(),e.fireEvent("allLoaded")}},_loadTile:function(e,t,r,n,o){var i=this;e._layer=i,e._info=[t,r,n],e._loaded=!1,e.onload=function(){i._onTileLoad(e)},e.onerror=i._onTileError,e._canvas=null,o||(e._retried=0,i.fireEvent("tileStart",{tile:e,url:e.src}));var a=i._getTileUrl(t,r,n,{scale:G.Browser.retina?2:1});a&&(e.src=i._getTileUrl(t,r,n,{scale:G.Browser.retina?2:1}))},_onTileLoad:function(e){var t=e._layer;e._responseTime=+new Date;var r,n,o,i,a=t.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE;if(e.src!==a){if("naturalWidth"in e&&!e.naturalWidth){var s=e.src;e.src=a,t._numLoadError++,t.fireEvent("tileError",{tile:e,url:s})}else G.DomUtil.addClass(e,"g-tile-loaded"),e._loaded=!0,r=e._info,n=parseInt(r[0]),o=parseInt(r[1]),i=parseInt(r[2]),t._placeTile(e,n,o,i),t._numLoadSuccess++,t.fireEvent("tileSuccess",{tile:e,url:e.src});t._checkAllHandled()}},_onTileError:function(){var e=this,t=e._layer;e._responseTime=+new Date;var r,n,o,i,a=t.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE,s=e.src;e.src!==a&&(e._retried++<t.options.retryTimes?(r=e._info,n=parseInt(r[0]),o=parseInt(r[1]),i=parseInt(r[2]),t._loadTile(e,n,o,i,!0)):(e.src=a,t._numLoadError++,t.fireEvent("tileError",{tile:e,url:s}),t._checkAllHandled()))},_onTileRemoved:function(e){},_onNewWrapTile:function(e,t){}}),G.Layer.Graphic=G.Layer.extend({options:{clickable:!0},init:function(e){var t=this;t.options=G.Util.merge({},t.options,e),t._idSeq=0,t._indexSeq=0,t._graphics={},t._styles={},t._tree=new G.RTree},add:function(e,t,r){var n=this;if(e instanceof G.Graphic)return e.addTo(n,t,r),e._id},get:function(e){return this._graphics[e]},all:function(){var e,t,r=this,n=r._tree.all(),o=[];for(e in n)t=n[e],t._isVertex||o.push(t);return o},query:function(e){var t,r,n,o=this,i=o._tree.search(e),a=[];for(t in i)r=i[t],n=r.bbox,G.ExtentUtil.overlaps(n,e)&&!r._isVertex&&a.push(r);return a},count:function(){var e,t,r=this,n=r._tree.all(),o=0;for(e in n)t=n[e],t._isVertex||o++;return o},clear:function(){var e=this,t=e._map,r=G.DomUtil;for(var n in e._graphics)e._graphics[n].endEdit(!0);return e._graphics={},e._tree.clear(),t&&(r.removeClass(t._layersFrame,"g-clickable"),r.removeClass(t._layersFrame,"g-edit")),e._onClear(),t&&t._requestRedraw(),e},setStyle:function(e,t,r){var n,o,i,a,s,l,_,c=this,m=c._map,d=c._styles,u=c._graphics,p=[];if(e&&t){for(l=Math.min(e.length,t.length),n=0;n<l;n++)a=e[n],s=t[n],_=a+","+s,p.push(_);d[p.join(";")]=r}else d[""]=r;for(n in u)o=u[n],i=c._calcStyle(o),o.updateOptions(i,!0);return m&&m._requestRedraw(),c},clearStyles:function(e){var t=this,r=t._map,n=t._graphics;t._styles={};for(i in n)g=n[i],g.updateOptions(e,!0);return r&&r._requestRedraw(),t},calcDataExtent:function(e){var t,r,n,o,i,a,s,l,_=this._graphics;for(a in _)s=_[a],l=s.bbox,t?(t[0]=l[0]<t[0]?l[0]:t[0],t[1]=l[1]<t[1]?l[1]:t[1],t[2]=l[2]>t[2]?l[2]:t[2],t[3]=l[3]>t[3]?l[3]:t[3]):t=[l[0],l[1],l[2],l[3]];return t&&e&&(r=(t[0]+t[2])/2,n=(t[1]+t[3])/2,o=(t[2]-t[0])/2*e,i=(t[3]-t[1])/2*e,t[0]=r-o,t[1]=n-i,t[2]=r+o,t[3]=n+i),t},_calcStyle:function(graphic){var self=this,styles=self._styles,attrs=graphic.attrs,options=styles[""];if(!attrs)return options;var key,strs,str,i,idx,field,condition,match;for(key in styles)if(key){strs=key.split(";");for(i in strs)if(str=strs[i],str&&str.indexOf&&str.substring&&(idx=str.indexOf(","),field=str.substring(0,idx),condition=str.substring(idx+1),match=eval('"'+attrs[field]+'"'+condition),!match))break;if(match){options=styles[key];break}}return options},_initContainer:function(){},_destroyContainer:function(){var e=this;e._container.parentNode.removeChild(e._container),delete e._container},_onAdded:function(){var e=this;e._container||e._initContainer();var t=e._map;t.addListener("mousemove",e._onMouseMove,e),t.addListener("mouseleave",e._onMouseLeave,e),t.addListener("click",e._onClick,e)},_onRemoved:function(){var e=this;e._container&&e._destroyContainer();var t=e._map;t.removeListener("mousemove",e._onMouseMove,e),t.removeListener("mouseleave",e._onMouseLeave,e),t.removeListener("click",e._onClick,e)},_onListenerAdded:function(e,t,r){var n=this,o=n._map;o&&"graphicClicked"==e&&(o.removeListener("click",n._onClick,n),o.addListener("click",n._onClick,n))},_onClear:function(){},_onZoomStart:function(){},_onZoomUpdate:function(){},_onZoomEnd:function(){},_vacuum:function(){var e=this,t=e._map;if(t){var r,n,o=t.getCenter(),i=t._res,a=t.getDrawSize(),s=a[0],l=a[1],_=o[0]-s*i/2,c=o[0]+s*i/2,m=o[1]-l*i/2,d=o[1]+l*i/2,u=[_,m,c,d],p=u,h=e._tree.search(p),g={},f=e._graphics;for(r in f)g[r]=!0;for(r in h)n=h[r],delete g[n._id];for(r in g)n=f[r],n.remove();return g.length}},_sortIndex:function(e,t){return e&&t?e._index-t._index||0:0},_onMouseMove:function(e){var t=this,r=t._map,n=t._focusGraphic;if(t.options.clickable){if(n&&!n._layer)return n._mouseOver=!1,void(t._focusGraphic=null);var o=r._handlers.Drag;if((!o||!o._dragging)&&t.isVisible()){var i,a,s,l,_,c=r.getRedrawExtent(),m=t._tree.search(c).sort(t._sortIndex).reverse(),d=[e.mapX,e.mapY];for(i=0,a=m.length;i<a;i++)if(s=m[i],l=s.options,s._layer&&l.clickable){if(_=s._hitPoint(d,r._res,r._rotate),_&&s._mouseOver)break;if(_&&!s._mouseOver){n&&(n._mouseOver=!1,n._onMouseOut&&n._onMouseOut(),n._isVertex?n._graphic._onVertexMouseOut():t.fireEvent("graphicOut",{graphic:n})),s._mouseOver=!0,t._focusGraphic=s,s._onMouseOver&&s._onMouseOver(),s._isVertex?s._graphic._onVertexMouseOver():t.fireEvent("graphicOver",{graphic:s});break}!_&&s._mouseOver&&(s._mouseOver=!1,s._onMouseOut&&s._onMouseOut(),s._isVertex?s._graphic._onVertexMouseOut():t.fireEvent("graphicOut",{graphic:n}),n=t._focusGraphic=null)}r._focusGraphic?o&&!o._dragging&&!r._focusGraphic.options.allowPan:o&&!o._dragging,G.Browser.ielt9&&(G.DomUtil.hasClass(r._layersFrame,"g-clickable")||G.DomUtil.hasClass(r._layersFrame,"g-edit")?r._layersFrame.style.cursor="":r._layersFrame.style.cursor="default")}}},_onMouseLeave:function(){var e=this,t=e._map,r=e._focusGraphic;if(e.options.clickable){if(r&&!r._layer)return r._mouseOver=!1,void(e._focusGraphic=null);var n=t._handlers.Drag;if((!n||!n._dragging)&&e.isVisible()){var o,i,a,s,l=t.getRedrawExtent(),_=e._tree.search(l).sort(e._sortIndex).reverse();for(o=0,a=_.length;o<a;o++)i=_[o],s=i.options,i._layer&&s.clickable&&i._mouseOver&&(i._mouseOver=!1,i._onMouseOut&&i._onMouseOut(),i._isVertex?i._graphic._onVertexMouseOut():e.fireEvent("graphicOut",{graphic:r}),r=e._focusGraphic=null)}}},_onClick:function(e){var t=this,r=t._map;G.DomUtil;if(t.isVisible()&&t.options.clickable){var n,o,i,a=r.getRedrawExtent(),s=t._tree.search(a).sort(t._sortIndex).reverse(),l=[e.mapX,e.mapY],_=r.options.touchTol,c=G.Browser.touch?_:0;for(o=0;o<s.length;o++)if(n=s[o],i=n.options,n._layer&&i.clickable&&n._hitPoint(l,r._res,r._rotate,c)&&!n._isVertex){e.cancel(),t.fireEvent("graphicClicked",{graphic:n});break}}}}),G.Layer.Html=G.Layer.extend({init:function(e,t){var r=this;r.options=G.Util.merge({},r.options,t),r._idSeq=0,r._htmls={}},addHtml:function(e,t,r){var n=this,o=n._map,i=G.DomUtil.create("div","g-html",n._container);return i.innerHTML=e,i._id=n._idSeq++,i._addAt=+new Date,n._htmls[i._id]=i,i.geom=[t,r],i.bbox=[t,r,t,r],o&&o._requestRedraw(),i._id},getHtml:function(e){return this._htmls[e]},removeHtml:function(e){var t=this,r=t._htmls[e];if(r){var n=r.parentNode;return n&&n.removeChild(r),delete t._htmls[e],t}},clear:function(){var e,t,r,n=this,o=n._map;for(e in n._htmls)t=n._htmls[e],r=t.parentNode,r&&r.removeChild(t);return n._htmls={},n._onClear(),o&&o._requestRedraw(),n},_initContainer:function(){var e=this,t=e._map,r=G.DomUtil,n=e._container=r.create("div","g-layer g-html-container");t._layersFrame.appendChild(e._container),r.setZIndex(n,e._zIndex)},_destroyContainer:function(){var e=this;e._container.parentNode.removeChild(e._container),delete e._container},_onAdded:function(){var e=this;e._map;e._container||e._initContainer()},_onRemoved:function(){var e=this;e._map;e._container&&e._destroyContainer()},_update:function(){var e=this;e.isVisible()?e._draw():e._erase()},_draw:function(){var e=this,t=G.DomUtil;t.show(e._container),t.setZIndex(e._container,e._zIndex);var r,n,o=e._htmls;for(r in o)n=o[r],e._placeHtml(n)},_erase:function(){var e=this,t=G.DomUtil;t.hide(e._container)},_placeHtml:function(e){var t=this,r=t._map,n=G.Browser.getPxRatio(),o=n[0],i=n[1],r=t._map,a=r.getSize(),s=r._rotate,l=r.getCenter(),_=r._res,c=G.DomUtil,m=e.geom,d=m[0],u=m[1],p=(d-l[0])/_/o+a[0]/2,h=-(u-l[1])/_/i+a[1]/2;c.markPosTransform(e,p,h),c.markRotateTransform(e,-s),c.updateTransform(e)},_onZoomStart:function(e){var t=this,r=t._map,n=r._mapFrame,o=r.getSize(),i=(r._rotate,G.DomUtil),a=i.Transition;t._zooming||(t._zooming=!0);var s=[o[0]/2,o[1]/2],l=e.aroundScreen||s,_=s[0]-l[0],c=s[1]-l[1];t._aroundScreen=l,t._scale=e.scale,t._zoomStartRes=r._res,t._zoomStartScale=e.scale;var m,d,u,p,h,g=r._zoomAnim&&r._zoomAnim._params.ignoreAnim,f=1/e.scale-1,v=t._htmls;for(m in v)d=v[m],u=d._zoomStartPos=i.getPosition(d),u&&(p=u[0],h=u[1],_=(p-l[0])*f,c=(h-l[1])*f,i.markPosTransform(d,p+_,h+c),i.updateTransform(d),g||(d.style[a]=n.style[a]))},_onZoomUpdate:function(e){var t=this,r=t._map,n=(r._rotate,G.DomUtil);if(t._zooming){t._tempScale=e.scale;var o,i,a,s,l,_=t._aroundScreen,c=1/e.scale-1/t._scale,m=t._htmls;for(o in m)i=m[o],a=i._zoomStartPos,a&&(s=a[0],l=a[1],dx=(s-_[0])*c,dy=(l-_[1])*c,n.markPosTransform(i,s+dx,l+dy),n.updateTransform(i))}},_onZoomEnd:function(){var e=this,t=G.DomUtil,r=t.Transition;e._scale=1;var n,o,i=e._htmls;for(n in i)o=i[n],o.style[r]="";e._zooming=!1}}),G.Layer.Image=G.Layer.extend({options:{errorImageUrl:"",opacity:1,retryTimes:3,crossOrigin:"*"},statics:{EMPTY_TILE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxOWUzZTA0YS1lOWFjLTljNDctODI5ZS0yMjM3YTQ3YzU3MzciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU5MjRFQkZCOTQxMTFFMzlDQjA5NkM1REQ1MEUwODciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU5MjRFQkVCOTQxMTFFMzlDQjA5NkM1REQ1MEUwODciIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmU5MjNlNDE0LWNlOTktMzk0My1hZjRjLTgwZjhiOGY1MjY0NCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxOWUzZTA0YS1lOWFjLTljNDctODI5ZS0yMjM3YTQ3YzU3MzciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz54esASAAAAEElEQVR42mL4//8/A0CAAQAI/AL+26JNFgAAAABJRU5ErkJggg=="},init:function(e,t){var r=this;G.Util.isString(e)?r.options=G.Util.merge({},r.options,t):r.options=G.Util.merge({},r.options,e),r._idSeq=0,r._images={}},addImage:function(e,t,r,n,o){var i=this,a=i._map,s=G.DomUtil.create("img","g-image",i._container),l=G.Browser.getPxRatio(),_=a._res,c=(n-t)/_,m=(o-r)/_;return G.DomUtil.setSize(s,c/l[0],m/l[1]),s._id=i._idSeq++,s._addAt=+new Date,i._images[s._id]=s,s.geom=s.bbox=[t,r,n,o],s._src=e,i._loadImage(s),a&&a._requestRedraw(),s._id},getImage:function(e){return this._images[e]},removeImage:function(e){var t=this,r=t._images[e];if(r){var n=r.parentNode;return n&&n.removeChild(r),delete t._images[e],map&&map._requestRedraw(),t}},clear:function(){for(var e,t=this,r=t._map,n=t._images,o=0,i=n.length;o<i;o++)e=n[o],t._stopLoadingImage(e);return t._images={},t._onClear(),r&&r._requestUpdate(),t},_initContainer:function(){var e=this,t=e._map,r=G.DomUtil,n=e._container=r.create("div","g-layer g-image-container");t._layersFrame.appendChild(e._container),r.setZIndex(n,e._zIndex)},_destroyContainer:function(){var e=this;e._container.parentNode.removeChild(e._container),delete e._container},_onAdded:function(){var e=this;e._map;e._container||e._initContainer()},_onRemoved:function(){var e=this;e._map;e._container&&e._destroyContainer()},_update:function(){var e=this;e.isVisible()?e._draw():e._erase()},_draw:function(){var e=this,t=G.DomUtil;t.show(e._container),t.setZIndex(e._container,e._zIndex);var r,n,o=e._images;for(r in o)n=o[r],e._placeImage(n)},_erase:function(){var e=this,t=G.DomUtil;t.hide(e._container)},_placeImage:function(e){var t=this,r=G.DomUtil,n=(G.MathUtil,G.Browser.getPxRatio()),o=n[0],i=n[1],a=t._map,s=a._res,l=(a._rotate,e.bbox),_=l[0],c=l[1],m=t._zoomScale||t._scale,d=t._aroundScreen,u=(l[2]-l[0])/s,p=(l[3]-l[1])/s;m&&1!==m&&(u/=m,p/=m);var h=a.toScreen([_,c],d,m),g=h[0],f=h[1]-p;r.markScaleTransform(e,1/o,1/i),r.markPosTransform(e,g,f),r.markSizeTransform(e,u,p),r.updateTransform(e),r.updateOpacity(e,t.options.opacity)},_stopLoadingImages:function(e){for(var t,r=e.getElementsByTagName("img"),n=0,o=r.length;n<o;n++)t=r[n],this._stopLoadingImage(t)},_stopLoadingImage:function(e){if(e&&!e.complete){var t=G.Browser;t.android||(e.onload=null,e.onerror=null,e.src="");var r=e.parentNode;r&&r.removeChild(e)}},_loadImage:function(e,t){var r=this;e._layer=r,e._loaded=!1,e.onload=r._onImageLoad,e.onerror=r._onImageError,t||(e._retried=0,r.fireEvent("imageStart",{image:e,url:e.src})),e.src=e._src},_onImageLoad:function(){var e=this,t=e._layer;e._responseTime=+new Date;var r=t.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE;if(e.src!==r)if("naturalWidth"in e&&!e.naturalWidth){var n=e.src;e.src=r,t.fireEvent("imageError",{image:e,url:n})}else G.DomUtil.addClass(e,"g-image-loaded"),e._loaded=!0,t._placeImage(e),t.fireEvent("imageSuccess",{image:e,url:e.src})},_onImageError:function(){var e=this,t=e._layer;e._responseTime=+new Date;var r=t.options.errorImageUrl||G.Layer.Image.EMPTY_TILE,n=e.src;e.src!==r&&(e._retried++<t.options.retryTimes?t._loadImage(e,!0):(e.src=r,t.fireEvent("imageError",{image:e,url:n})))},_onImageRemoved:function(e){},_onNewWrapImage:function(e,t){},_onZoomStart:function(e){var t=this,r=t._map,n=r._mapFrame,o=r.getSize(),i=r._rotate,a=G.DomUtil,s=a.Transition;t._zooming||(t._zooming=!0);var l=[o[0]/2,o[1]/2],_=e.aroundScreen||l,c=l[0]-_[0],m=l[1]-_[1];if(i&&c&&m){var d=G.MathUtil.rotateVector([c,m],-i);_=[l[0]-d[0],l[1]-d[1]]}t._aroundScreen=_,t._scale=e.scale;var u,p,h,g,f,v=r._zoomAnim&&r._zoomAnim._params.ignoreAnim,y=1/e.scale-1,b=t._images;for(g in b)f=b[g],u=f._zoomStartPos=a.getPosition(f),f._zoomStartSize=a.getSize(f),p=u[0],h=u[1],c=(p-_[0])*y,m=(h-_[1])*y,a.markPosTransform(f,p+c,h+m),a.updateTransform(f),v||(f.style[s]=n.style[s])},_onZoomUpdate:function(e){var t=this,r=G.DomUtil;if(t._zooming){var n,o,i,a,s,l=t._aroundScreen,_=t._scale=e.scale,c=1/e.scale-1,m=t._images;for(a in m)s=m[a],n=s._zoomStartPos,n&&(o=n[0],i=n[1],dx=(o-l[0])*c,dy=(i-l[1])*c,size=s._zoomStartSize,r.markSizeTransform(s,size[0]/_,size[1]/_),r.markPosTransform(s,o+dx,i+dy),r.updateTransform(s))}},_onZoomEnd:function(){var e=this;e._scale=1;var t,r,n=e._images;for(t in n)r=n[t],e._placeImage(r);e._zooming=!1}}),G.Layer.Timed=G.Layer.extend({options:{frameCount:100,tipType:!1,timeAccumulate:!1,timeBreaks:null,duration:1e3},play:function(){},pause:function(){},stop:function(){}}),G.Anim=G.Class.extend({mixins:[G.Event],init:function(e){var t=this;return t._map=e,t._playing=!1,t},start:function(){},update:function(){},stop:function(){}}),G.Anim.Pan=G.Anim.extend({start:function(e){var t=this,r=t._map,n=r._mapFrame,o=G.DomUtil;if(!t._playing&&e&&e.duration&&e.ease){G.DomDraggable.forbidden=G.DomPinchable.forbidden=!0,t._playing=!0,t._params=e,o.addClass(n,"g-pan-anim");var i=o.getPosition(n);t._srcX=i[0],t._srcY=i[1],t._destX=t._srcX+e.offsetX,t._destY=t._srcY-e.offsetY,clearTimeout(t._timer),t._timer=setTimeout(G.Util.bind(t._onTimer,t),1e3*e.duration),o.Transition&&(o.addListener(n,o.TransitionEnd,t._onTransitionEnd,t),n.style[o.Transition]="all "+e.duration+"s cubic-bezier(0,0,"+e.ease+",1)"),o.markPosTransform(n,t._destX,t._destY),o.updateTransform(n),r.fireEvent("moveStart"),G.Util.cancelAnimFrame(t._animFrame),t._animFrame=G.Util.requestAnimFrame(t._onStep,!1,t)}},_onStep:function(){var e=this,t=e._map;t.fireEvent("move"),e._animFrame=G.Util.requestAnimFrame(e._onStep,!1,e)},_onTimer:function(){this._final()},_final:function(){var e=this,t=e._map,r=t._mapFrame,n=G.DomUtil;e._playing&&(e._playing=!1,clearTimeout(e._timer),G.Util.cancelAnimFrame(e._animFrame),r.style[n.Transition]="",n.removeClass(r,"g-pan-anim"),t._mergeFramePos(),t._updateUrl(),t.fireEvent("moveEnd"),t._checkView(),t._requestUpdate(),G.DomDraggable.forbidden=G.DomPinchable.forbidden=!1)},_onTransitionEnd:function(){var e=this,t=e._map,r=t._mapFrame,n=G.DomUtil;n.removeListener(r,n.TransitionEnd,e._onTransitionEnd,e),e._final()}}),G.Anim.Rotate=G.Anim.extend({start:function(e){var t=this,r=t._map,n=r._mapFrame,o=r._compass,i=G.DomUtil,a=G.Util;t._playing||e&&e.duration&&(G.DomDraggable.forbidden=G.DomPinchable.forbidden=!0,t._playing=!0,t._params=e,r.fireEvent("rotateStart"),i.addClass(n,"g-rotate-anim"),i.Transition&&(i.addListener(o,i.TransitionEnd,t._onTransitionEnd,t),o.style[i.Transition]="all "+e.duration+"s linear"),r._isCanvasRelMode()?(a.cancelAnimFrame(t._animFrame),t._animFrame=a.requestAnimFrame(t._onStep,!0,t)):i.Transition?(i.addListener(n,i.TransitionEnd,t._onTransitionEnd,t),n.style[i.Transition]="all "+e.duration+"s linear",r._rawRotateTo(e.to)):t._final(),t._startAt=+new Date,t._startRotate=r._rotate)},_onStep:function(){var e,t=this,r=t._map,n=t._startRotate,o=t._params,i=+new Date-t._startAt,a=1e3*o.duration;i<a?(e=n+(o.to-n)*i/a,r._rawRotateTo(e),r._requestRedraw(),r.fireEvent("rotate"),t._animFrame=G.Util.requestAnimFrame(t._onStep,!0,t)):t._final()},_final:function(){var e=this,t=e._map,r=t._mapFrame,n=e._params,o=G.DomUtil;e._playing&&(e._playing=!1,o.removeClass(r,"g-rotate-anim"),t._rawRotateTo(n.to),t._updateUrl(),t.fireEvent("rotateEnd"),G.DomDraggable.forbidden=G.DomPinchable.forbidden=!1,t._checkView(),t._requestUpdate())},_onTransitionEnd:function(){var e=this,t=e._map,r=t._mapFrame,n=t._compass,o=G.DomUtil;o.removeListener(r,o.TransitionEnd,e._onTransitionEnd,e),o.removeListener(n,o.TransitionEnd,e._onTransitionEnd,e),r.style[o.Transition]="",n.style[o.Transition]="",e._final()}}),G.Anim.Zoom=G.Anim.extend({start:function(e){var t=this,r=t._map,n=r._mapFrame,o=G.DomUtil,i=G.Util;if(!t._playing&&e&&e.center&&e.width&&e.height){G.DomDraggable.forbidden=G.DomPinchable.forbidden=!0,t._playing=!0,t._params=e;var a=e.center,s=e.width,l=e.height,_=r.getSize(),c=r._res,m=r._calcResByViewport(a,s,l),d=m/c,u=r.getCenter(),p=a[0],h=a[1],g=(m*u[0]-c*p)/(m-c),f=(m*u[1]-c*h)/(m-c),v=[g,f],y=r.toScreen(v);o.addClass(n,"g-zoom-anim"),e.ignoreAnim||(clearTimeout(t._timer),t._timer=setTimeout(G.Util.bind(t._onTimer,t),1e3*e.duration),r._isCanvasRelMode()?(i.cancelAnimFrame(t._animFrame),t._animFrame=i.requestAnimFrame(t._onStep,!0,t)):o.Transition?(o.addListener(n,o.TransitionEnd,t._onTransitionEnd,t),n.style[o.Transition]="all "+e.duration+"s linear"):t._final()),t._startAt=+new Date,t._startCenter=r.getCenter(),t._startMapSize=[_[0]*c,_[1]*c],t._startRes=c,r.fireEvent("zoomStart",{aroundMap:v,aroundScreen:y,scale:d}),e.ignoreAnim&&e.fireEnd&&t._final(!e.fireEnd)}},update:function(e){var t=this,r=t._map,n=r._mapFrame,o=G.DomUtil,i=G.Util;if(t._playing){t._params=e;var a=e.center,s=e.width,l=e.height,_=t._startRes,c=r._calcResByViewport(a,s,l),m=c/_,d=r.getCenter(),u=a[0],p=a[1],h=c===_?u:(c*d[0]-_*u)/(c-_),g=c===_?p:(c*d[1]-_*p)/(c-_),f=[h,g],v=r.toScreen(f);e.ignoreAnim?r._isCanvasRelMode()&&(r._rawZoomTo(e.center,e.width,e.height),r._requestRedraw()):(clearTimeout(t._timer),t._timer=setTimeout(G.Util.bind(t._onTimer,t),1e3*e.duration),r._isCanvasRelMode()?(i.cancelAnimFrame(t._animFrame),t._animFrame=i.requestAnimFrame(t._onStep,!0,t)):o.Transition?n.style[o.Transition]="all "+e.duration+"s linear":t._final()),r.fireEvent("zoomUpdate",{aroundMap:f,aroundScreen:v,scale:m}),r.fireEvent("zoom"),e.ignoreAnim&&t._final()}},_onTimer:function(){this._final()},_onStep:function(){var e,t,r,n,o,i=this,a=i._map,s=i._startCenter,l=i._startMapSize,_=i._params,c=+new Date-i._startAt,m=1e3*_.duration;c<m?(e=c/m,t=s[0]+(_.center[0]-s[0])*e,r=s[1]+(_.center[1]-s[1])*e,n=l[0]+(_.width-l[0])*e,o=l[1]+(_.height-l[1])*e,a._rawZoomTo([t,r],n,o),a._requestRedraw(),a.fireEvent("zoom"),i._animFrame=G.Util.requestAnimFrame(i._onStep,!0,i)):i._final()},_final:function(e){var t=this,r=t._map,n=r._mapFrame,o=t._params,i=G.DomUtil;if(o.fireEnd){if(!t._playing)return;t._playing=!1,i.removeClass(n,"g-zoom-anim"),r._rawZoomTo(o.center,o.width,o.height),r._updateUrl(),e||r.fireEvent("zoomEnd"),r._checkView(),r._requestUpdate()}G.DomDraggable.forbidden=G.DomPinchable.forbidden=!1},_onTransitionEnd:function(){var e=this,t=e._map,r=t._mapFrame,n=G.DomUtil;n.removeListener(r,n.TransitionEnd,e._onTransitionEnd,e),r.style[n.Transition]="",e._final()}}),G.Handler=G.Class.extend({init:function(e){var t=this;return t._map=e,t._enabled=!1,t},on:function(e){var t=this;return t._forbidden&&!e?t:(t._enabled||(t._enabled=!0,t.afterOn()),t)},off:function(){var e=this;return e._enabled&&(e._enabled=!1,e.afterOff()),e},afterOn:function(){},afterOff:function(){}}),G.Handler.Click=G.Handler.extend({afterOn:function(){var e,t=this,r=t._map,n=G.DomUtil,o=G.Event.virtualMouse;for(e in o.DOWN)n.addListener(r._mapFrame,o.DOWN[e],t._onDown,t);for(e in o.UP)n.addListener(r._mapFrame,o.UP[e],t._onUp,t)},afterOff:function(){var e,t=this,r=t._map,n=G.DomUtil,o=G.Event.virtualMouse;for(e in o.DOWN)n.removeListener(r._mapFrame,o.DOWN[e],t._onDown,t);for(e in o.UP)n.removeListener(r._mapFrame,o.UP[e],t._onUp,t)},_onDown:function(e){var t=this,r=t._map,n=G.DomUtil;if(n.hide(r._spark),!(r.isZooming()||r.isPanning()||r.isRotating())&&e&&!(e.touches&&e.touches.length<1)){if(t._touchesCount=e.touches?e.touches.length:0,t._lastDown=e.touches?e.touches[0]:e,e.touches&&e.touches.length>=2){var o=(t._lastDown.pageX+e.touches[1].pageX)/2,i=(t._lastDown.pageY+e.touches[1].pageY)/2;t._lastDown.pageX=o,t._lastDown.pageY=i;var a=(r._mapFrame._pos,n.getMousePosition(t._lastDown,r._container));t._virtualClick(a,t._lastDown)}t._lastTime=+new Date}},_onUp:function(e){for(var t=this,r=t._map,n=G.DomUtil,o=Math.abs,i=r.options.touchTol,a=e||e.touches[0],s=a.target;s;){if("g-popup"==s.className)return;s=s.parentElement}var l,_,c,m,d,u=t._lastDown,p=e.changedTouches?e.changedTouches[0]:e;u&&(l=r._mapFrame._pos,_=n.getMousePosition(u,r._container),c=n.getMousePosition(p,r._container),m=o(_[0]-c[0]-l[0]),d=o(_[1]-c[1]-l[1]),m<i&&d<i&&+new Date-t._lastTime<200&&t._virtualClick(_,e)),t._lastDown=null},_virtualClick:function(e,t){var r=this,n=r._map,o=e,i=n.toMap(o);n.fireEvent("virtualclick",{mapX:i[0],mapY:i[1],screenX:o[0],screenY:o[1]}),n.options.spark&&r._showSpark(i,o);var a=+new Date,s=1e3*n.options.doubleDuration;r._lastClick?a-r._lastClickTime<s?(clearTimeout(r._clickTimeout),r._lastClick=null,r._realDoubleClick(e,t)):(t.touches&&r._touchesCount<2||1===t.which||t.button)&&(r._lastClick=e,r._realClick()):(t.touches&&r._touchesCount<2||1===t.which||t.button)&&(r._lastClick=e,r._clickTimeout=setTimeout(G.Util.bind(r._realClick,r),s)),r._lastClickTime=a},_realDoubleClick:function(e,t){var r,n=this,o=n._map,i=o.toMap(e);o.options.doubleZoom&&(r=t.touches&&n._touchesCount<2||1===t.which||1===t.button,n._doubleZoom(i,!r)),o.fireEvent("doubleclick",{mapX:i[0],mapY:i[1],screenX:e[0],screenY:e[1]})},_doubleZoom:function(e,t){var r=this,n=r._map;if(n.options.doubleZoom){var o=n.getSize(),i=n._res,a=G.MathUtil.limitRange(n._calcNearestRes(t),n.options.minRes,n.options.maxRes);
if(!(Math.abs(a-i)<i/100)){var s=a/i,l=o[0]*a,_=o[1]*a,c=n.getCenter(),m=e[0],d=e[1],u=m+(c[0]-m)*s,p=d+(c[1]-d)*s;n.zoomTo([u,p],l,_)}}},_realClick:function(){var e=this,t=e._map;clearTimeout(e._clickTimeout);var r=e._lastClick,n=t.toMap(r);e._lastClick=null,e._lastClickTime=+new Date,t.fireEvent("click",{mapX:n[0],mapY:n[1],screenX:r[0],screenY:r[1]})},_showSpark:function(e,t){var r=this,n=r._map,o=G.DomUtil;if(!(n.isZooming()||n.isPanning()||n.isRotating())){var i=n.options.sparkOffset||[0,0],a=n.options.sparkDuration||1,s=t[0]+i[0],l=t[1]+i[1],_=n._spark;_.geom=e,o.markPosTransform(_,s,l),o.updateTransform(_);var c=a/4,m=a/4*3;o.show(_,c,function(){o.show(_),o.hide(_,m)})}}}),G.Handler.DoubleClick=G.Handler.extend({afterOn:function(){var e=this,t=e._map;if(G.Util.merge(t.options,{doubleZoom:!0}),t.addListener("dblclick",e._onDoubleClick,e),G.Browser.touch){var r=G.Event.virtualMouse;for(var n in r.DOWN)G.DomUtil.addListener(t._mapFrame,r.DOWN[n],e._onDown,e)}},afterOff:function(){var e=this,t=e._map;if(t.removeListener("dblclick",e._onDoubleClick,e),G.Browser.touch){var r=G.Event.virtualMouse;for(var n in r.DOWN)G.DomUtil.removeListener(t._mapFrame,r.DOWN[n],e._onDown,e)}},_onDown:function(e){var t=this,r=t._map,n=G.DomUtil;if(e.touches){var o,i,a;if(t._lastTouch&&t._lastTime&&(o=+new Date-t._lastTime,o<1e3*r.options.doubleDuration))return i=n.getMousePosition(t._lastTouch,r._container),a=r.toMap(i),t._doubleZoom(a,2==e.touches.length),n.stopPropagation(e),n.preventDefault(e),t._lastTouch=null,t._lastTime=0,void r.fireEvent("doubleclick",{mapX:a[0],mapY:a[1],screenX:i[0],screenY:i[1]});t._lastTouch=e.touches[0],t._lastTime=+new Date}},_onDoubleClick:function(e){var t=this,r=t._map;r.isZooming()||r.isPanning()||r.isRotating()||(r.fireEvent("doubleclick",{mapX:e.mapX,mapY:e.mapY,screenX:e.screenX,screenY:e.screenY}),t._doubleZoom([e.mapX,e.mapY]))},_doubleZoom:function(e,t){var r=this,n=r._map;if(n.options.doubleZoom){var o=n.getSize(),i=n._res,a=G.MathUtil.limitRange(n._calcNearestRes(t),n.options.minRes,n.options.maxRes);if(!(Math.abs(a-i)<i/100)){var s=a/i,l=o[0]*a,_=o[1]*a,c=n.getCenter(),m=e[0],d=e[1],u=m+(c[0]-m)*s,p=d+(c[1]-d)*s;n.zoomTo([u,p],l,_)}}}}),G.Handler.Drag=G.Handler.extend({afterOn:function(){var e=this,t=e._map;e._draggable||(e._draggable=new G.DomDraggable(t,t._mapFrame,t._container,t.options.dragEdge),e._draggable.addListener("dragStart",e._onDragStart,e),e._draggable.addListener("drag",e._onDrag,e),e._draggable.addListener("dragEnd",e._onDragEnd,e),e._draggable.on())},afterOff:function(){var e=this;e._draggable&&(e._draggable.off(),e._draggable.removeListener("dragStart",e._onDragStart,e),e._draggable.removeListener("drag",e._onDrag,e),e._draggable.removeListener("dragEnd",e._onDragEnd,e),delete e._draggable)},_onDragStart:function(e){var t=this,r=t._map,n=G.DomUtil,o=r._mapFrame,i=r.options;if(!(r._panAnim&&r._panAnim._playing||r.isZooming()||r.isPanning()||r.isRotating()||t._dragging)){t._dragging=!0,n.preventDefault(e),n.stopPropagation(e),o.style[n.Transition]="",i.panAnim&&(t._poses=[],t._times=[]),t._mergedFramePos=[0,0];var a,s,l,_,c,m,d,u,p,h,g,f,v,y,b,x=Math.abs,w=Math.sin,D=Math.cos,M=Math.round,E=i.maxExtent;E&&"webgl"!==r._mode&&(a=r.getSize(),s=[0,0,a[0],a[1]],l=r._res,c=(E[2]-E[0])/2/l,m=(E[3]-E[1])/2/l,d=r._rotate,d?(u=d/G.MathUtil.DEGREE_PER_RADIAN,p=x(c*D(u))+x(m*w(u)),h=x(c*w(u))+x(m*D(u))):(p=c,h=m),_=r.toScreen([(E[2]+E[0])/2,(E[3]+E[1])/2]),g=[M(_[0]-p),M(_[1]-h),M(_[0]+p),M(_[1]+h)],f=g[0]>s[0]?s[0]-g[0]:s[2]-g[2],v=g[3]<s[3]?s[3]-g[3]:s[1]-g[1],y=g[2]<s[2]?s[2]-g[2]:s[0]-g[0],b=g[1]>s[1]?s[1]-g[1]:s[3]-g[3],i.wrap&&(f=-Number.MAX_VALUE,y=Number.MAX_VALUE),t._draggable._dLimit=[f,v,y,b]),r.fireEvent("moveStart")}},_onDrag:function(e){var t=this,r=t._map,n=G.DomUtil,o=G.Util;if(t._dragging){if(n.preventDefault(e),n.stopPropagation(e),clearTimeout(t._timeout),t._timeout=setTimeout(G.Util.bind(t._checkStay,t),500),r.options.panAnim){var i=t._lastTime=+new Date,a=t._lastPos=[t._draggable._newX,t._draggable._newY];t._poses.push(a),t._times.push(i),i-t._times[0]>40&&(t._poses.shift(),t._times.shift())}o.cancelAnimFrame(t._animRequest),t._animRequest=o.requestAnimFrame(function(){r.fireEvent("move")},!0,t)}},_onDragEnd:function(e){var t=this,r=t._map,n=r.options,o=+new Date-t._lastTime,i=G.DomUtil;if(t._dragging)if(t._dragging=!1,i.preventDefault(e),i.stopPropagation(e),clearTimeout(t._timeout),!n.panAnim||o>100||!t._poses[0]||G.Browser.ielt9)t._final();else{var a=t._lastPos[0]-t._poses[0][0],s=t._lastPos[1]-t._poses[0][1],l=(t._lastTime+o-t._times[0])/1e3,_=n.panAnimEase,c=a*_/l,m=s*_/l,d=Math.pow(c*c+m*m,.5),u=Math.min(n.panAnimMaxSpeed,d),p=u/d,h=c*p,g=m*p,f=n.panAnimDuration,v=h*f,y=-g*f;if(v||y){var b=t._draggable._dLimit;if(b&&"webgl"!==r._mode){var x=Math.min(b[0],0),w=Math.max(b[1],0),D=Math.max(b[2],0),M=Math.min(b[3],0),E=r._mapFrame._pos,S=v+E[0],U=-y+E[1];S=Math.min(Math.max(S,x),D),U=Math.min(Math.max(U,M),w),v=S-E[0],y=E[1]-U}r.panBy(v,y,{duration:f,ease:_})}else t._final()}},_final:function(){var e=this,t=e._map;"webgl"===t._mode&&(t._center[0]+=t._centerOffset[0],t._center[1]+=t._centerOffset[1],t._centerOffset=[0,0],t._center=t._calcRealCoords(t._center),e._map._tempCamera=e._map._camera.clone(),e._map._tempCamera.position.copy(t._cameraOffset).add(t._cameraTarget),e._map._tempCamera.lookAt(t._cameraTarget),e._map._useTempCamera=!0,e._map._update(),e._map._camera.position.copy(t._cameraOffset).add(t._cameraTarget),e._map._camera.lookAt(t._cameraTarget),e._map._useTempCamera=!1),t._center=t._calcRealCoords(t._center),t._mergeFramePos(),t._updateUrl(),t.fireEvent("moveEnd"),t._checkView(),t._requestUpdate()},_checkStay:function(){var e=this,t=e._map;t.options.panAnim&&(e._poses=[],e._times=[])}}),G.Handler.ScrollWheel=G.Handler.extend({afterOn:function(){var e=this,t=e._map,r=G.DomUtil;G.Util.merge(t.options,{scrollWheelZoom:!0}),e._toDelta=0,e._hasAnimate=!1,t.addListener("mousewheel",e._onMouseWheel,e),r.addListener(t._container,"MozMousePixelScroll",r.preventDefault)},afterOff:function(){var e=this,t=e._map,r=G.DomUtil;t.removeListener("mousewheel",e._onMouseWheel,e),r.removeListener(t._container,"MozMousePixelScroll",r.preventDefault)},_onMouseWheel:function(e){var t=this,r=t._map,n=r.options,o=G.DomUtil;if(r._isLoaded()&&n.scrollWheelZoom&&!r.isPanning()&&!r.isRotating()){o.preventDefault(e),o.stopPropagation(e);var i=o.getWheelDelta(e.originEvent);if(G.Browser.ielt9||!r.options.continuouslyZoom)return t._mouseMap=[e.mapX,e.mapY],t._toDelta*i<0&&(t._toDelta=0),t._toDelta+=i,void(t._toDelta>3?(t._toDelta=0,t._zoomByLod()):t._toDelta<-3&&(t._toDelta=0,t._zoomByLod(1)));var a=r._zoomAnim;if(r._webGLZooming||a&&a._playing){t._toDelta+=i;var s=n.zoomAnimDuration>0?1e3*n.zoomAnimDuration:500;clearTimeout(t._timer),t._timer=setTimeout(G.Util.bind(t._onTimer,t),s)}else t._mouseMap=[e.mapX,e.mapY],t._toDelta=i,t._startRes=r._res,t._startCenter=r.getCenter();t._toDelta=G.MathUtil.limitRange(t._toDelta,-80,80),t._tempZoom()}},_onTimer:function(){this._finalZoom()},_calcScale:function(e){return Math.pow(2,e/-20)},_zoomByLod:function(e){var t=this,r=t._map,n=r.options,o=n.minRes,i=n.maxRes,a=r.getSize(),s=r._res,l=G.MathUtil.limitRange(r._calcNearestRes(e),o,i);if(!(Math.abs(l-s)<s/1e4)){var _=l/s,c=a[0]*l,m=a[1]*l,d=r.getCenter(),u=t._mouseMap[0],p=t._mouseMap[1],h=u+(d[0]-u)*_,g=p+(d[1]-p)*_;t._newCenter=[h,g],t._newWidth=c,t._newHeight=m,r.zoomTo(t._newCenter,t._newWidth,t._newHeight,{fireEnd:!0})}},_tempZoom:function(){var e=this,t=e._map,r=t.options,n=r.minRes,o=r.maxRes,i=t.getSize(),a=e._startRes,s=e._calcScale(e._toDelta),l=G.Browser.getCanvasRatio(),_=G.MathUtil.limitRange(s*a,n,o),s=_/a,c=i[0]*_,m=i[1]*_,d=e._startCenter,u=e._mouseMap[0],p=e._mouseMap[1],h=u+(d[0]-u)*s,g=p+(d[1]-p)*s,f=(h-d[0])/_*l[0],v=(g-d[1])/_*l[1];if(h=d[0]+f*_/l[0],g=d[1]+v*_/l[1],e._newCenter=[h,g],e._newWidth=c,e._newHeight=m,_==e._lastRes)return clearTimeout(e._timer),void(e._timer=setTimeout(G.Util.bind(e._onTimer,e),250));if(e._lastRes=_,t._webGLZooming&&"webgl"===t._mode){var y=t._camera;t._webGLZooming=!0,e._startPos=e._startPos||y.position.clone(),e._startTar=e._startTar||new G.GL.Vector3,y.position.set((e._startPos.x+f)*s,e._startPos.y*s,(e._startPos.z-v)*s),e._startTar.set(f*s,0,-v*s),y.lookAt(e._startTar),t._requestRender()}t.zoomTo(e._newCenter,e._newWidth,e._newHeight,{ignoreAnim:!0,fireEnd:!1})},_finalZoom:function(){var e=this,t=e._map;if(t.zoomTo(e._newCenter,e._newWidth,e._newHeight,{ignoreAnim:!0}),"webgl"===t._mode){if(!e._startPos)return;e._map._tempCamera=e._map._camera.clone(),e._map._tempCamera.position.copy(e._startPos),e._map._tempCamera.lookAt(new G.GL.Vector3(0,0,0)),e._map._useTempCamera=!0,e._map._update(!1),e._map._camera.position.copy(e._startPos),e._map._camera.lookAt(new G.GL.Vector3(0,0,0)),e._map._useTempCamera=!1,e._startTar=null,e._startPos=null,t._webGLZooming=!1,t._requestRender()}}}),G.Handler.ShiftDrag=G.Handler.extend({afterOn:function(){var e=this,t=e._map;G.Util.merge(t.options,{dragZoom:!0}),t.addListener("mousedown",e._onMouseDown,e)},afterOff:function(){var e=this,t=e._map;t.removeListener("mousedown",e._onMouseDown,e)},_onMouseDown:function(e){var t=e.originEvent;if(!t||!t.shiftKey||1!==t.which&&1!==t.button)return!1;var r=this,n=r._map,o=G.DomUtil,i=o.addListener;if("webgl"!==n._mode){o.preventDefault(e),o.stopPropagation(e),o.disableTextSelection(),o.disableImageDrag();var a=r._startScreen=[e.screenX,e.screenY],s=r._box={lt:o.create("div","g-zoom-box",n._mapFrame),rt:o.create("div","g-zoom-box",n._mapFrame),lb:o.create("div","g-zoom-box",n._mapFrame),rb:o.create("div","g-zoom-box",n._mapFrame),l:o.create("div","g-zoom-box g-zoom-box-left",n._mapFrame),r:o.create("div","g-zoom-box g-zoom-box-right",n._mapFrame),t:o.create("div","g-zoom-box g-zoom-box-top",n._mapFrame),b:o.create("div","g-zoom-box g-zoom-box-bottom",n._mapFrame)};for(var l in s)o.setPosition(s[l],a[0],a[1]),o.setZIndex(s[l],n.options.topZIndex);var _=window.getComputedStyle,c=_(s.l),m=_(s.r),d=_(s.t),u=_(s.b);r._boxBorders=_?{l:parseInt(c["border-right-width"]||c.borderRightWidth)||0,r:parseInt(m["border-left-width"]||m.borderLeftWidth)||0,t:parseInt(d["border-bottom-width"]||d.borderBottomWidth)||0,b:parseInt(u["border-top-width"]||u.borderTopWidth)||0}:{l:parseInt(s.l.currentStyle["border-right-width"])||0,r:parseInt(s.r.currentStyle["border-left-width"])||0,t:parseInt(s.t.currentStyle["border-bottom-width"])||0,b:parseInt(s.b.currentStyle["border-top-width"])||0},n._container.style.cursor="crosshair",i(document,"mousemove",r._onMouseMove,r),i(document,"mouseup",r._onMouseUp,r),n.fireEvent("shiftDragStart")}},_onMouseMove:function(e){var t=this,r=t._map,n=(r._rotate,r.getSize()),o=r.getDrawSize(),i=r._isCanvasRelMode(),a=i?n[0]:o[0],s=i?n[1]:o[1],l=G.DomUtil,_=l.setPosition,c=l.setSize,m=Math.min,d=Math.max,u=Math.abs,p=t._box,h=t._boxBorders,g=t._startScreen,f=l.getMousePosition(e,r._container),v=d(0,u(f[0]-g[0])-h.l-h.r),y=d(0,u(f[1]-g[1])-h.t-h.b),b=m(f[0],g[0]),x=m(f[1],g[1]),w=0,D=0;if(!i){var M=r.getCenter(),E=r._res,S=r.toScreen([M[0]-E*o[0]/2,M[1]+E*o[1]/2],0,0,!0);w=S[0],D=S[1],b-=(o[0]-n[0])/2,x+=(o[1]-n[1])/2}w=parseInt(w),D=parseInt(D),v=parseInt(v),y=parseInt(y),b=parseInt(b),x=parseInt(x),l.preventDefault(e),l.stopPropagation(e),b<0&&(v+=b,b=0),x<0&&(y+=x,x=0);var U=a-b-h.l-h.r,C=s-x-h.t-h.b;v=v>U?U:v,y=y>C?C:y,_(p.lt,w,D),c(p.lt,b,x),_(p.rt,w+b+v,D),c(p.rt,a-b-v,x),_(p.lb,w,D+x+y),c(p.lb,b,s-x-y),_(p.rb,w+b+v,D+x+y),c(p.rb,a-b-v,s-x-y),_(p.l,w,D+x),c(p.l,b,y),_(p.r,w+b+v,D+x),c(p.r,a-b-v,y),_(p.t,w+b,D),c(p.t,v,x),_(p.b,w+b,D+x+y),c(p.b,v,s-x-y)},_onMouseUp:function(e){var t=this,r=t._map,n=r._res,o=r._rotate,i=o/G.MathUtil.DEGREE_PER_RADIAN,a=G.DomUtil,s=a.removeListener,l=t._startScreen,_=a.getMousePosition(e,r._container);a.preventDefault(e),a.stopPropagation(e);for(var c in t._box)r._mapFrame.removeChild(t._box[c]);r._container.style.cursor="",a.enableTextSelection(),a.enableImageDrag(),s(document,"mousemove",t._onMouseMove,t),s(document,"mouseup",t._onMouseUp,t);var m=(Math.max,Math.abs),d=t._boxBorders,u=_[0]-l[0]-d.l-d.r,p=_[1]-l[1]-d.t-d.b;if(0!==u||0!==u){r.fireEvent("shiftDragEnd");var h=[l[0]+u/2,l[1]+p/2],g=r.toMap(h),f=m(u)*n,v=m(p)*n;o&&(f*=Math.cos(i),v*=Math.cos(i)),r.zoomTo(g,f,v)}}}),G.Handler.Pinch=G.Handler.extend({afterOn:function(){var e=this,t=e._map;if("webgl"===t._mode){var r=t._container;e._dragStartTarget=r||element,e.domElement=void 0!==r?r:document,e.enabled=!0,e._pitchStart=new G.GL.Vector2,e._pitchEnd=new G.GL.Vector2,e._pitchDelta=new G.GL.Vector2,e._rotateStart=new G.GL.Vector2,e._rotateEnd=new G.GL.Vector2,e._rotateDelta=new G.GL.Vector2,e._tempStart=new G.GL.Vector2,e._tempEnd=new G.GL.Vector2,e._tempDelta=new G.GL.Vector2,e._rotateSpeed=1,e._rightDragging=!1}e._pinchable||(e._pinchable=new G.DomPinchable(t._mapFrame,t._container,t.options.dragEdge),e._pinchable.addListener("pinchStart",e._onPinchStart,e),e._pinchable.addListener("pinch",e._onPinch,e),e._pinchable.addListener("pinchEnd",e._onPinchEnd,e),e._pinchable.on())},afterOff:function(){var e=this;e._pinchable&&(e._pinchable.off(),e._pinchable.removeListener("pinchStart",e._onPinchStart,e),e._pinchable.removeListener("pinch",e._onPinch,e),e._pinchable.removeListener("pinchEnd",e._onPinchEnd,e),delete e._pinchable)},_onPinchStart:function(e){var t=this,r=t._map,n=G.MathUtil;if(r._zoomAnim&&r._zoomAnim.stop(),!t._pinching){t._pinching=!0,G.DomDraggable.forbidden=!0,r.fireEvent("pinchStart");var o=G.DomUtil.getMousePosition(e.originTouch1,r._container),i=G.DomUtil.getMousePosition(e.originTouch2,r._container),a=o[0],s=o[1],l=i[0],_=i[1],c=a-l,m=s-_;t._gesture=null,"webgl"===r._mode&&(t._tempStart.set(a,l),t._pitchStart.set(s,_),t._rotateStart.set(l-a,_-s),t._startLength=r._camera.position.length(),t._lastDeltaDis=0),t._pinchStart=[(a+l)/2,(s+_)/2],t._pinchStartPos=[o,i],t._pinchStartMap=r.toMap(t._pinchStart),t._pinchStartDis=n.calcHypotenuse(c,m),t._pinchStartRotate=n.calcTheta(c,m),t._pinchRotateIdle=0,t._startRes=r._res,t._startRotate=r._rotate,t._startCenter=r._center,t._rotating=!1,t._zooming=!1,r._handlers.Click._lastDown=null;var d=r._mode;"webgl"!=d&&"canvas"!=d&&(r._mapFrame.style[G.DomUtil.Transition]="")}},_onPinch:function(e){var t=this,r=t._map;if(t._pinching){if("webgl"===r._mode&&!t._gesture){var n=[G.DomUtil.getMousePosition(e.originTouch1,r._container),G.DomUtil.getMousePosition(e.originTouch2,r._container)];if(t._tempEnd.set(n[0][0],n[1][0]),t._tempDelta.subVectors(t._tempEnd,t._tempStart),t._tempStart.copy(t._tempEnd),t._pitchEnd.set(n[0][1],n[1][1]),t._pitchDelta.subVectors(t._pitchEnd,t._pitchStart),t._pitchStart.copy(t._pitchEnd),t._rotateEnd.set(n[1][0]-n[0][0],n[1][1]-n[0][1]),t._rotateAngle=t._rotateEnd.angle()-t._rotateStart.angle(),t._rotateStart.copy(t._rotateEnd),t._getGesture(n),!t._gesture)return}t._temp(e),r.fireEvent("pinch")}},_onPinchEnd:function(){var e=this,t=e._map,r=t.options,n=r.minRes,o=r.maxRes;if(e._pinching&&(e._pinching=!1,t.fireEvent("pinchEnd"),e._final(),!t.options.continuouslyZoom)){var i=e._startRes,a=t._res;if(Math.abs(i-a)<a/1e4)return;var s=a>i,l=G.MathUtil.limitRange(t._calcNearestRes(s),n,o);if(Math.abs(l-a)<a/1e4)return;var _=l/a,c=t.getSize(),m=c[0]*l,d=c[1]*l,u=t.getCenter(),p=e._pinchStartMap[0],h=e._pinchStartMap[1],g=p+(u[0]-p)*_,f=h+(u[1]-h)*_;e._newCenter=[g,f],e._newWidth=m,e._newHeight=d,t.zoomTo(e._newCenter,e._newWidth,e._newHeight,{fireEnd:!0})}},_temp:function(e){var t,r=this,n=r._map,o=n.options,i=o.minRes,a=o.maxRes,s=n.getSize(),l=G.MathUtil,_=Math.abs,c=Math.max,m=(Math.min,G.DomUtil.getMousePosition(e.originTouch1,n._container)),d=G.DomUtil.getMousePosition(e.originTouch2,n._container),u=m[0],p=m[1],h=d[0],g=d[1],f=[(u+h)/2,(p+g)/2],v=l.calcHypotenuse(u-h,p-g),y=0;if("webgl"===n._mode){var b=r.domElement===document?r.domElement.body:r.domElement;if(o.pinchZoom&&"pinch"===r._gesture){var x=r._pinchStartDis,w=r._startRes,D=c(c(s[0]/2,s[1]/2),x),M=v-x,E=Math.pow(2,-M/D),S=G.Browser.getCanvasRatio(),U=l.limitRange(E*r._startRes,i,a);E=U/w;var C=s[0]*U,T=s[1]*U,A=r._startCenter,P=r._pinchStartMap[0],R=r._pinchStartMap[1],L=P+(A[0]-P)*E,O=R+(A[1]-R)*E,z=(L-A[0])/U,V=(O-A[1])/U;L=A[0]+z*U/S[0],O=A[1]+V*U/S[1],r._newCenter=[L,O],r._newWidth=C,r._newHeight=T;var k=n._camera,I=n._cameraTarget;r._startPos=r._startPos||k.position.clone(),k.position.set((r._startPos.x+z)*E,r._startPos.y*E,(r._startPos.z-V)*E),I.set(z*E,0,-V*E)}if(o.pinchRotate){if(r._tempEnd.set(u,h),r._tempDelta.subVectors(r._tempEnd,r._tempStart),r._tempStart.copy(r._tempEnd),r._pitchEnd.set(p,g),r._pitchDelta.subVectors(r._pitchEnd,r._pitchStart),r._pitchStart.copy(r._pitchEnd),r._rotateEnd.set(h-u,g-p),r._rotateAngle=r._rotateEnd.angle()-r._rotateStart.angle(),r._rotateStart.copy(r._rotateEnd),"pinch"===r._gesture){var W=l.radToDeg(r._rotateAngle*r._rotateSpeed);n._rawRotateTo(n.getRotate()+W)}if("push"===r._gesture){var N=0;N=_(r._pitchDelta.x)<_(r._pitchDelta.y)?360*r._pitchDelta.x/b.clientHeight*r._rotateSpeed:360*r._pitchDelta.y/b.clientHeight*r._rotateSpeed,n._rawPitchTo(n.getPitch()-N)}}n._requestRender()}else{if(o.pinchRotate){if(t=l.calcTheta(u-h,p-g),y=t-r._pinchStartRotate,!r._rotating&&_(y)>.4){r._pinchRotateIdle=y,r._rotating=1,n.fireEvent("rotateStart");var x=r._pinchStartDis,D=c(c(s[0]/2,s[1]/2),x),M=v-x,E=Math.pow(2,-M/D),U=l.limitRange(E*r._startRes,i,a),F=r._pinchStartMap,Z=u-h,Y=p-g,j=[f[0]-s[0]/2,f[1]-s[1]/2];j=l.rotateVector(j,-n._rotate),n._rawZoomTo([F[0]-j[0]*U,F[1]+j[1]*U],s[0]*U,s[1]*U),r._pinchStart=f,r._pinchStartMap=n.toMap(r._pinchStart),r._pinchStartDis=l.calcHypotenuse(Z,Y),r._startRes=n._res,r._startRotate=n._rotate,r._startCenter=n._center}r._rotating?y-=r._pinchRotateIdle:y=0,r._newRotate=r._startRotate+y*l.DEGREE_PER_RADIAN,n._rawRotateTo(r._newRotate)}var U=r._startRes;if(o.pinchZoom){if(r._zooming||(r._zooming=1,n.fireEvent("zoomStart")),r._zooming){var x=r._pinchStartDis,D=c(c(s[0]/2,s[1]/2),x),M=v-x,E=Math.pow(2,-M/D);U=l.limitRange(E*r._startRes,i,a)}var j=[f[0]-s[0]/2,f[1]-s[1]/2],F=r._pinchStartMap;r._newCenter=[F[0]-j[0]*U,F[1]+j[1]*U],r._newWidth=s[0]*U,r._newHeight=s[1]*U,n._rawZoomTo(r._newCenter,r._newWidth,r._newHeight)}}r._rotating&&n.fireEvent("rotate"),r._zooming&&n.fireEvent("zoom"),n._requestRedraw()},_final:function(){var e=this,t=e._map,r=t.options;e._rotating&&(t.fireEvent("rotateEnd"),e._rotating=0),e._zooming&&(t.fireEvent("zoomEnd"),e._zooming=0),"webgl"===t._mode&&(r.pinchZoom&&"pinch"===e._gesture?(t.zoomTo(e._newCenter,e._newWidth,e._newHeight,{ignoreAnim:!0}),t._update(),t._camera.position.sub(t._cameraTarget).setLength(e._startLength),t._camera.lookAt(new G.GL.Vector3(0,0,0)),t._cameraTarget.set(0,0,0),t._cameraOffset.copy(t._camera.position),e._startPos=null,t._requestRender()):t._update()),t._checkView(),t._requestUpdate(),G.DomDraggable.forbidden=!1},_getGesture:function(e){var t=this,r=(t._map,t._pinchStartPos),n=new G.GL.Vector2(r[1][0]-r[0][0],r[1][1]-r[0][1]),o=new G.GL.Vector2(e[1][0]-e[0][0],e[1][1]-e[0][1]),i=n.length(),a=o.length(),s=n.angle()-o.angle();return t._pitchDelta.x*t._pitchDelta.y>0&&Math.abs(r[0][1]-e[0][1])>8?void(t._gesture="push"):t._pitchDelta.x*t._pitchDelta.y<0||Math.abs(i-a)>10||Math.abs(s)>Math.PI/180*5?void(t._gesture="pinch"):void(t._gesture=null)}}),G.Handler.RightDrag=G.Handler.extend({afterOn:function(){var e=this,t=e._map;if("webgl"===t._mode&&(e.domElement=void 0!==t._container?t._container:document,e.enabled=!0,e._rotateSpeed=1,e._rotateStart=new G.GL.Vector2,e._rotateEnd=new G.GL.Vector2,e._rotateDelta=new G.GL.Vector2,e._rightDragging=!1),!e._rotatable){if("webgl"!==t._mode)return;e._rotatable=new G.DomRightDraggable(t,t._container),e._rotatable.addListener("rightDragStart",e._onRightDragStart,e),e._rotatable.addListener("rightDrag",e._onRightDrag,e),e._rotatable.addListener("rightDragEnd",e._onRightDragEnd,e),e._rotatable.on()}},afterOff:function(){var e=this;e._rotatable&&(e._rotatable.off(),e._rotatable.removeListener("rightDragStart",e._onRightDragStart,e),e._rotatable.removeListener("rightDrag",e._onRightDrag,e),e._rotatable.removeListener("rightDragEnd",e._onRightDragEnd,e),delete e._rotatable)},_onRightDragStart:function(e){var t=this,r=(t._map,e.event);t._rightDragging=!0,t._rotateStart.set(r.clientX,r.clientY),G.Util.cancelAnimFrame(t._animFrame)},_onRightDrag:function(e){var t=this,r=t._map,n=e.event;t._rotateEnd.set(n.clientX,n.clientY),t._rotateDelta.subVectors(t._rotateEnd,t._rotateStart),r._rawRotateTo(r.getRotate()-360*t._rotateDelta.x/t.domElement.clientWidth*t._rotateSpeed),r._rawPitchTo(r.getPitch()-360*t._rotateDelta.y/t.domElement.clientHeight*t._rotateSpeed),t._rotateStart.copy(t._rotateEnd),t._map._requestRender(),r.fireEvent("rotate")},_onRightDragEnd:function(e){var t=this;t._map;G.Util.cancelAnimFrame(t._animFrame),t._animFrame=G.Util.requestAnimFrame(t._onStep,!1,t)},_onStep:function(){var e=this,t=e._map,r=e._rotateDelta;r.x*=.85,r.y*=.85,t._rawRotateTo(t.getRotate()-360*r.x/e.domElement.clientWidth*e._rotateSpeed),t._rawPitchTo(t.getPitch()-360*r.y/e.domElement.clientHeight*e._rotateSpeed),t._requestRender(),Math.abs(r.x)<=1&&Math.abs(r.y)<=1?e._final():e._animFrame=G.Util.requestAnimFrame(e._onStep,!1,e)},_final:function(){var e=this,t=e._map;e._rightDragging=!1,t._update(),t._updateUrl(),t.fireEvent("_rotateEnd"),t._checkView(),t._requestUpdate()}}),G.Map=G.Class.extend({mixins:[G.Event],options:{srid:3857,wrap:!0,minRes:.298582141738892,maxRes:156543.033928,maxExtent:[-20037508.342784,-20037508.342784,20037508.342784,20037508.342784],scrollPage:!1,zoomAnim:!0,zoomAnimDuration:.3,panAnim:!0,panAnimMaxSpeed:1e3,panAnimDuration:.3,panAnimEase:.3,rotateAnim:!0,rotateAnimDuration:.3,pitchAnim:!0,pitchAnimDuration:.3,tolerance:1e-5,topZIndex:100,doubleDuration:.3,hideLogo:!1,doubleZoom:!0,pinchZoom:!0,pinchRotate:!0,dragPan:!0,dragRotate:!0,shiftZoom:!0,scrollZoom:!0,continuouslyZoom:!0,touchTol:8,dragEdge:8,recordStatus:!0,mask:!1,maskColor:"#000",maskOpacity:1,spark:!0,sparkOffset:[-24,-24],sparkDuration:1,canvasAnimRedraw:!1,canvasExpandFactor:.25,glColor:"#fff",initStatus:{center:[0,0],res:156543.033928,rotate:0,pitch:0}},init:function(e,t){var r=this,n=e instanceof HTMLElement?e:G.DomUtil.get(e),o=r._container=n;if(r.options=G.Util.merge({},r.options,t),!o)throw new Error("No map container!");r._center=r.options.initStatus.center||[0,0],r._res=r.options.initStatus.res||156543.033928,r._rotate=r.options.initStatus.rotate||0,r._pitch=r.options.initStatus.pitch||0,r._pitch>50&&(r._pitch=50),r._extent=[],r._layerIdSeq=0,r._layers={},r._layerOrder=[],r._controlIdSeq=0,r._controls={},r._masks=[],o._initBy!==G.name&&(r._initLayout(),r._initListeners(),r._initAddition(),r._initHandlers(),o._initBy=G.name,r._onResize(),r.fireEvent("resize")),r._rotate&&(r._updateCompass(r._rotate),r._updateDrawSize()),r._ensureViewByUrl()},resize:function(){var e=this,t=e._container,r=t.offsetWidth,n=t.offsetHeight;return e._size=[r,n],e.view(e._center,e._width,e._height,e._rotate,e._pitch),e._onResize(),e.fireEvent("resize"),e},redraw:function(){var e=this;return e._requestRedraw(),e},update:function(){var e=this;return e._requestUpdate(),e},getExtent:function(e){var t=this,r=t.getSize(),n=t.getCenter(),o=t._res,i=e||0,a=r[0]*o/2+i,s=r[1]*o/2+i;return[n[0]-a,n[1]-s,n[0]+a,n[1]+s]},getRedrawExtent:function(e){var t=this,r=t.getDrawSize(),n=t.getCenter(),o=t._res,i=t.options,a=t._isCanvasRelMode()?1+2*i.canvasExpandFactor:1,s=e||0,l=(r[0]*o/2+s)*a,_=(r[1]*o/2+s)*a,c=n[0]-l,m=n[1]-_,d=n[0]+l,u=n[1]+_,p=[c,m,d,u];if(i.wrap){var h=i.maxExtent,g=h[0],f=h[2];c<g&&(p[2]=Math.max(d,f+g-c)),d>f&&(p[0]=Math.min(c,g+f-d))}return p},getRotate:function(){return this._rotate},getSize:function(){var e=this;if(!e._size){var t=e._container;t&&(e._size=[t.offsetWidth,t.offsetHeight])}return e._size},getDrawSize:function(){var e=this;return e._drawSize||e._updateDrawSize(),e._drawSize},getLayers:function(){return this._layers},getLayer:function(e){return this._layers[e]},addLayer:function(e){var t=this;if(e instanceof G.Layer)return e.addTo(t),e._id},addControl:function(e){var t=this;return e instanceof G.Control&&e.addTo(t),t},addLegend:function(e){var t=this;return e instanceof G.Legend&&e.addTo(t),t},addMask:function(e){var t=this;return(e instanceof G.Graphic.Polygon||e instanceof G.Graphic.Circle)&&(e._map=t,t._masks.push(e),t._requestRedraw()),t},clearMask:function(){var e=this;return e._masks=[],e._requestRedraw(),e},view:function(e,t,r,n,o){var i=this;return i._rawView(e,t,r,n,o),i._updateUrl(),i._checkView(),i._requestUpdate(),i},centerAt:function(e,t){var r=this,n=r._center,o=r._res,i=(n[0]-e[0])/o,a=(n[1]-e[1])/o;return r.panBy(i,a,t)},zoomTo:function(e,t,r,n){var o=this,i=o.options,a=o._size,s=i.maxRes,l=i.minRes,_=s?a[0]*s:t,c=l?a[0]*l:t,m=s?a[1]*s:r,d=l?a[1]*l:r,u={center:e,width:G.MathUtil.limitRange(t,c,_),height:G.MathUtil.limitRange(r,d,m),duration:n&&void 0!==n.duration?n.duration:i.zoomAnimDuration,fireEnd:!n||void 0===n.fireEnd||n.fireEnd,ignoreAnim:!(!n||void 0===n.ignoreAnim)&&n.ignoreAnim};return i.zoomAnim&&!G.Browser.ielt9?(o._zoomAnim=o._zoomAnim||new G.Anim.Zoom(o),o._zoomAnim._playing?o._zoomAnim.update(u):o._zoomAnim.start(u)):(o.fireEvent("zoomStart"),o._rawZoomTo(e,t,r),o._updateUrl(),o.fireEvent("zoomEnd"),o._checkView(),o._requestUpdate()),o},zoomRes:function(e,t,r){var n=this;if(!t)return n;var o=n.getSize(),i=o[0]*t,a=o[1]*t;return n.zoomTo(e,i,a,r)},zoomExtent:function(e,t){var r=this,n=r.options;if(!e)return r;var o,i=r.getSize(),a=(e[0]+e[2])/2,s=(e[1]+e[3])/2,l=e[2]-e[0],_=e[3]-e[1],c=Math.max(l/i[0],_/i[1]),m=c,d=r._zoomReses;if(!n.continuouslyZoom&&d){for(var u=0,p=d.length;u<p&&(o=d[u],!(o<c));u++)m=o;return r.zoomRes([a,s],m,t)}return l&&_||(m=r._res,l=i[0]*m,_=i[1]*m),r.zoomTo([a,s],l,_,t)},zoomIn:function(e){var t=this,r=t.getSize(),n=t._res,o=G.MathUtil.limitRange(t._calcNearestRes(),t.options.minRes,t.options.maxRes);if(!(Math.abs(o-n)<n/1e4)){var i=r[0]*o,a=r[1]*o,s=t.getCenter();return t.zoomTo(s,i,a,e)}},zoomOut:function(e){var t=this,r=t.getSize(),n=t._res,o=G.MathUtil.limitRange(t._calcNearestRes(1),t.options.minRes,t.options.maxRes);if(!(Math.abs(o-n)<n/1e4)){var i=r[0]*o,a=r[1]*o,s=t.getCenter();return t.zoomTo(s,i,a,e)}},panBy:function(e,t,r){var n=this,o=n.options;if(o.panAnim&&!G.Browser.ielt9){n._panAnim||(n._panAnim=new G.Anim.Pan(n));var i={offsetX:e||0,offsetY:t||0,duration:r&&void 0!==r.duration?r.duration:o.panAnimDuration,ease:r&&void 0!==r.ease?r.ease:o.panAnimEase};n._panAnim.start(i)}else n.fireEvent("moveStart"),n._rawPanBy(e,t),n._updateUrl(),n.fireEvent("moveEnd"),n._checkView(),n._requestUpdate();return n},rotateTo:function(e,t){var r=this,n=r.options;if(n.rotateAnim&&!G.Browser.ielt9){r._rotateAnim||(r._rotateAnim=new G.Anim.Rotate(r));var o={to:e||0,duration:t&&void 0!==t.duration?t.duration:n.rotateAnimDuration};r._rotateAnim.start(o)}else r.fireEvent("rotateStart"),r._rawRotateTo(e||0),r._updateUrl(),r.fireEvent("rotateEnd"),r._checkView(),r._requestUpdate();return r},isZooming:function(){var e=this._zoomAnim;return e&&e._playing},isPanning:function(){var e=this._panAnim;return e&&e._playing},isRotating:function(){var e=this._rotateAnim;return e&&e._playing},isDragging:function(){var e=this._handlers.Drag;return e&&e._dragging},isPinching:function(){var e=this._handlers.Pinch;return e&&e._pinching},isRightDragging:function(){var e=this._handlers.RightDrag;return e&&e._rightDragging},getCenter:function(){return this._center},getResolution:function(){return this._res},toScreen:function(e,t,r,n){var o,i=this,a=i.getSize(),s=i.getCenter(),l=i._res,_=i._rotate,c=a[0]/2,m=a[1]/2,d=G.Browser.getPxRatio(),u=d[0],p=d[1],h=c+(e[0]-s[0])/l/u,g=m-(e[1]-s[1])/l/p;t&&r&&1!==r&&(o=1/r-1,h+=(h-t[0])*o,g+=(g-t[1])*o);var f=h-c,v=g-m;if(_&&f&&v&&!n){var y=G.MathUtil.rotateVector([f,v],_);h=y[0]+c,g=y[1]+m}return[h,g]},toMap:function(e,t){var r,n=this,o=n.getSize(),i=n.getCenter(),a=n._res,s=n._rotate,l=o[0]/2,_=o[1]/2,c=G.Browser.getPxRatio(),m=c[0],d=c[1],u=e[0],p=e[1],h=u-l,g=p-_;s&&h&&g&&!t&&(r=G.MathUtil.rotateVector([h,g],-s),h=r[0],g=r[1]);var f=h*a*m+i[0],v=-g*a*d+i[1];return[f,v]},showPopup:function(e,t,r,n){var o=this,i=G.DomUtil;t&&(o._popupContentWrapper.innerHTML=t);var a=o._popup;return a._mapPoint=e,a._offsetX=r||0,a._offsetY=n||0,o._updatePopupPos(),i.show(a),o.fireEvent("popupShown"),o},hidePopup:function(e){var t=this,r=t._popup;return r._mapPoint=null,G.DomUtil.hide(r),e&&(t._popupContentWrapper.innerHTML=""),t.fireEvent("popupHidden"),t},isPrintable:function(){var e=this;if("canvas"!=e._mode&&"webgl"!=e._mode)return!1;var t,r,n;for(t in e._layers)if(r=e._layers[t],r&&(n=r.options.crossOrigin,void 0!==n&&"*"!==n))return!1;return!0},destroy:function(){var e,t,r=this,n=r._container,o=G.DomUtil,i=G.DomUtil.removeListener;for(e in r._layers)r._layers[e].remove();var a=r._mouseEvents;for(e=0,t=a.length;e<t;e++)i(n,a[e],r._onMouseEvent,r);return i(r._popup,"mouseenter",o.stopPropagation),i(r._popup,"mousemove",o.stopPropagation),i(r._popup,"mouseleave",o.stopPropagation),i(r._popup,"mousedown",o.stopPropagation),i(r._popupClose,"click",r._onPopupCloseDown,r),i(r._popupClose,"mousedown",r._onPopupCloseDown,r),i(r._popupClose,"touchstart",r._onPopupCloseDown,r),i(r._compass,"click",r._onCompassDown,r),i(r._compass,"mousedown",r._onCompassDown,r),i(r._compass,"touchstart",r._onCompassDown,r),i(window,"contextmenu",r._onWinContextMenu,r),i(window,"resize",r._onWinResize,r),i(window,"hashchange",r._onWinHashChange,r),o.removeClass(n,"g-container"),o.remove(r._mapFrame,n),o.remove(r._panelFrame,n),n._initBy=void 0,this},_initLayout:function(){var e=this,t=G.DomUtil,r=G.Browser;t.addClass(e._container,"g-container"),r.retina&&t.addClass(e._container,"retina"),r.ielt9&&t.addClass(e._container,"ielt9"),e._mapFrame=t.create("div","g-map-frame",e._container),e._layersFrame=t.create("div","g-layers-frame",e._mapFrame);var n=e._popup=t.create("div","g-popup",e._mapFrame),o=t.create("div","g-popup-wrapper",n);e._popupClose=t.create("div","g-popup-close",o);var i=t.create("div","g-popup-content",o);if(e._popupContentWrapper=t.create("div","g-popup-content-wrapper",i),e._popupPointer=t.create("div","g-popup-pointer",n),t.hide(n),e._maskFrame=t.create("div","g-mask-frame",e._mapFrame),e._spark=t.create("div",G.DomUtil.testStyle(["pointer-events"])?"g-spark":"",e._mapFrame),e._panelFrame=t.create("div","g-panel-frame",e._container),r.ielt9){var a=t.createVML("group","",e._panelFrame);e._compass=t.createVML("image","g-vml g-compass",a)}else e._compass=t.create("div","g-compass",e._panelFrame);t.hide(e._compass),e.options.hideLogo||e._showLogo(),t.markPosTransform(e._mapFrame,0,0),t.updateTransform(e._mapFrame)},_hideLogo:function(){var e=this;e._logo&&(e._logo.style.display="none")},_showLogo:function(){var e=this,t=G.DomUtil;if(e._logo)e._logo.style.display="block";else{var r=e._brand=t.create("div","g-brand",e._panelFrame);e._logo=r;var n=r.style;n.left="8px",n.bottom="8px",n.position="absolute",n.background="#fff",n.border="1px solid #ddd",n.borderRadius=n["-moz-border-radius"]=n["-webkit-border-radius"]=n["-o-border-radius"]="13px";var o=e._brandImg=t.create("img","",r),i=o.style;i.verticalAlign="middle",i.width="24px",i.height="24px",o.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3NpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4MDk4YTdlNC03ZGFmLTQ1MzctODRhNy0yYmVhYWFhMzgxYjQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZCNEU1MTNENjY1MTFFNUI0N0JCRTI4MDZCREI0RTgiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZCNEU1MTJENjY1MTFFNUI0N0JCRTI4MDZCREI0RTgiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ZTdmYzZiYjctYzk5YS00ZDBkLWI1NWYtNzkyZTY0ODg2ZmMwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjgwOThhN2U0LTdkYWYtNDUzNy04NGE3LTJiZWFhYWEzODFiNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PjwgStUAAApESURBVHja7FlrTJTpFT5zY4AZZrgPVhgUAYsyOKLbjZcsdjXa1CZeahNNNU0bo25a/2xMf3jpj66aNO0Pk6ahVmpa1xRb29Wtl9h1q6XuqlUpWgsIAjLcGRhGZoa5MZee55VPh0EYQLbtZn2TLzPffO/3vufynOec844sHA7T53nI6XM+Xivwvx7K6B8GBgb+74VOTU19DaEvrgKgbblcTlqtltRqNb0qjcv/24KnpaVRcnIy9fb2UigUEvdQBN9nJIg/K8GlwHv06BFVVlbSgwcPKCsrizZs2EBlZWWUnp5OLpeLvF6vmD/ZIYt24UyxkCR4SkqKuG9sbKTr169TfX093bt3jzQaDQUCASH44sWLaeXKlbR06VKKj48nm81GMplsUiw0owpgrcTERCF4XFycEKK2tpZu3rwpLD48PCys3tDQQD6fT8yZPXu2eM/hcFBOTg5t2rSJTCYT2e32cZWYtAL79u2jogVFZOmy8ExIGCK1SkOhcDxZ7f0ciDpK0CbRvz+9TkpZkHSGWRSQqcpaGxt+qNXp/5yZZbgeCIb1LqfrLoVY+IxMGpYrKC0lmfyD/eRwuYUCer1eeKOzs5MyMzPp0KFDpFAoyOPxxFRgWjEQYqUVSiWxkKxTiDTpBpqbn0effnz1SEN97X45KxufoPm6pSneFQoGg/MXLSlJSExsS0zU0LBCyc8SyGsPjfIcLijT3d1Nt2/fpjVr1pDb7Z4QSlNWIDyymUajpQHXoLHh4f3FWp3uQx0r0N1r+5aluWl/UpKOVAwNKBYMBLQBhk1PR+tvEzXaG3arVRtWKHuyDJnV6XrNX8ntHbNHUlISVVVVUWlpqYgTKDF9BUbQpVQpSC6TM9UFSKdPZny6MqquXKhxDthSl65c9WV7f92WtpbGw3Hxap4b94zb2XLwUhxTZF9X9yqXc3CVQqWi3PyCOp6UkZqs6wQpRccQFOjo6KBbt27R+vXraWhoaEIvTKiATP7sRZvNwbqESMnu9/h66JNrNz5w9PenJiWnUHN97X2vx6OMi4PwqjGJyetxM2Ti+94oe/v7anXC3/QZqX2mErPG0WnROJ4+HQtP9hxiAjBasWJFTC9MSLiAgUqp4gBTktPFKsi09KCmdmf7k8crU9IzSM6B5vf74llwJaw9JqvyvY953bxs2cFla9ae5Xf63EMuilMqhlL0eqvEVMJY/Cld8AIC+u7du4JWJ8rWEyoALOv1Olo0v4DyMg00x5BJDOy3FKyUyJwIZvaKJMThw4dp3bp1zzcMC/ipmKl0Ld3tbWS3WcnvG6ZLZ05vOXr0SDXnhF8iK8PisHTkBboF9Q4ODlICB/20INTV1aVoamoOOpmjw3IlBWUhpk7NnXAovANCR1rm5MmTtHr1atqxYwcdOHCATp8+LRRDTrhXVfWzBSWLzaBi15CbWh7VnWFYKCwWS+mlS5f+wKXENdDoKMvye7w/zZs3T+QGZOgpe6Cmpib864oKuvLRR+QPhjnVuynDMOvjBLYQs+OoucCsNJqamp5/V8cn0ICtd5F9oO+d9AyDqH2USuVZ8Dxb1s0QaQaUUA9FXjAO+B7JbaI6aUIPsBVCHg7CrOwcDl4/DXB2ZEg80iUn/8tht5eAYaRx/PhxkYVRJoBBIplDwcmrv7/vKwa3q9zr81J+sXlbprXrT2zVGi41LIBIpAdg/ZaWFtqyZYsoL56+JNgnx0IshJYzbW7uXHZViC/OARxUxty8I3c6qn6PGJGh8GJrYe6xY8eev/ci6YUEFZYa57YUziskx+CIMHn5f6y+VSVKCvbIKI/6/X4RByj0MPBsPCqdUAFYBXBJ5RJAxcEo54AFl38px3g1K9tYa7f1LyQRB1wDcXKLjAlsCMYBjRYsNP1q6ZtvvmfMmU3utJTnc+58cm2MYBL2IXxRUZGw/rTzgHyE1poeNwhLQlguDYgTln152VeLa2v++fOng/a1Kanpt1oa678DvENRzgsE6Bnz8m8bc/N/pE5IvOp1uzifWLmgC4xSMnrA+oDUxo0bY1o/diYeYZpwKCiElyzs8/rI7XBS8aJF7yoS44eD3gB53ENJ1p7uzUMuJ2Ubc2vSMg1Hk5LT/jInb76z4eFD8mcheFUs0IuARMaFl8H7Ugzgt127dpHZbI5p/UnXQnCrVHBJZQJKY7lCPowQaG+zUJG59Jsp7e3fs3Z2mJi53j3x/u/C7a1tNNBnFRldJpO/qE1Gxt69e4XHwELS2k6nk7Zu3SqYB0rFam4mVACJBBZAU1JeXk4nTpygOXPmPNss4CVbT7eYl6BWku+pjUJ+z8ntO75NGRkZ1GtpoQUF+bRz506RVZFRQbVvmE1iDVAlLA+IRMIE38FmKKVjWX/SDQ0WxLw9e/ZQXV3dqHpcGtgYQkmbMxSKOVm9zx2XArjGYOv62OrfyM/P74WlMQ+WjhQUVsdea9euFYZ4WU8w5X4Am2Gxbdu20blz50SaH+NKpkJky9bWVvGdMRw8f/68+fHjx8KD6LCQxNrb2wNo6AFBlBCAUGSikhTAJ9aZkaYe7ocAWBi1DjaNHjqdjh5ysEKw5cuXwxv17I23Tp069XcIwu8MHzx4MJ9LZNvly5eForAy1kYuiBy4h1KS517pWEWq0cHNfX19QvjIgJYuQAiCGgwGAUM0JSzsDRbyB1B+9+7dX+Naqe3ixYvU3NwsrA/h8V70Wghc9MhQAiXHK3kAmGa309mzZwVEsOnLBrj7yZMnhYzZUsb4GTTuhYWFwGsoLKpWRQAFXk9PD82aNQvN/nZOVFfYOP3RHsDAEQtgVFJSMmE/EFMBUByOOSAQlBmPGZD6GdsLGPeVzDLblyxZUl5ZWWlmWB0G9isqKqqys7PfMZlMnRcuXPgJl9JFfD+f++B+lBrRA97GQC2EQB6vJ4jJQhAYsEGCQTCP12Cgroen9u/ff6i6uvrHeA8WLC4urmDlfspUWs6weBvQAGw2b978XYbVb+DV6FIaA0rhvCg3N3eMB6bEQhIOARFUiFAA92NaRxYEm7LL3+Pnv2BomDige5iBGqAY4381W9XMBkriNf+xcOFCP9ZAoEZ7FRaH19hD4/YBkw5iLA6MYkFg1yPqHM9L58GywC57bIAtVwXhwUp4H884cO8bjcYbKHkwD88kI+GCQvgNzyA88kp03zEtGpUW4eAU7gOPA2oQWh3RE0TOhzcguNTnSrQoUWS08hAeguMTVSgUiHUiMWkFJOticZycIalZrVZxCIWeFc8RxFMdknAQHAPrFhQUiAMuKTZm7GBLshICCjwNvsfBLBgKimBDXNGlAe5fVjJgLVgY6wGaqI/wibXxe/T8GTtej1QEwQyPID5wj01RAiNRIalBOQQ/YIZkBtgBRmA0wARGwAWLQ3CsIRV2kxF+Rk6npcyJHIHNmUJFSQG2QkCiKUfsWCwWwWIS/sHvSFIQdCoW/8yO1yW6lf4PmMzAXuGRfnq6/1LO2D80UtMzVQNMVfiYEHr9L+VrBb5gCvxHgAEA/sHRcrWRKMYAAAAASUVORK5CYII=";
var a=e._brandInfo=t.create("div","",r),s=a.style;s.color="#999",s.verticalAlign="middle",s.fontSize="12px",s.margin="0px 12px 0px 4px",s.display="none",a.innerHTML="地图引擎 <a style='color:#009BAE' href='http://geohey.com' target='_blank'>极海 GeoHey</a>"}},_initListeners:function(){for(var e=this,t=G.DomUtil,r=G.DomUtil.addListener,n=e._mouseEvents=["click","dblclick","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel","DOMMouseScroll","touchstart","touchmove","touchend"],o=0,i=n.length;o<i;o++)r(e._container,n[o],e._onMouseEvent,e);r(e._popup,"mouseenter",t.stopPropagation),r(e._popup,"mousemove",t.stopPropagation),r(e._popup,"mouseleave",t.stopPropagation),r(e._popup,"mousedown",t.stopPropagation),r(e._popupClose,"click",e._onPopupCloseDown,e),r(e._popupClose,"mousedown",e._onPopupCloseDown,e),r(e._popupClose,"touchstart",e._onPopupCloseDown,e),r(e._compass,"click",e._onCompassDown,e),r(e._compass,"mousedown",e._onCompassDown,e),r(e._compass,"touchstart",e._onCompassDown,e),e._brand&&r(e._brand,"mousemove",e._onBrandMouseMove,e),e._brandImg&&(r(e._brandImg,"mousedown",e._onBrandImgDown,e),r(e._brandImg,"touchstart",e._onBrandImgDown,e)),r(window,"contextmenu",e._onWinContextMenu,e),r(window,"resize",e._onWinResize,e),r(window,"hashchange",e._onWinHashChange,e),e.addListener("zoomStart",e._onZoomStart,e),e.addListener("zoomUpdate",e._onZoomUpdate,e),e.addListener("zoom",e._onZoom,e),e.addListener("zoomEnd",e._onZoomEnd,e),e.addListener("moveStart",e._onMoveStart,e),e.addListener("move",e._onMove,e),e.addListener("moveEnd",e._onMoveEnd,e),e.addListener("rotateStart",e._onRotateStart,e),e.addListener("rotate",e._onRotate,e),e.addListener("rotateEnd",e._onRotateEnd,e),e.addListener("pinchStart",e._onPinchStart,e),e.addListener("pinch",e._onPinch,e),e.addListener("pinchEnd",e._onPinchEnd,e)},_initHandlers:function(){var e=this,t=e.options;e._handlers={},e._handlers.Click=new G.Handler.Click(e),t.doubleZoom&&G.Browser.ielt9&&(e._handlers.DoubleClick=new G.Handler.DoubleClick(e)),t.pinchZoom&&(e._handlers.Pinch=new G.Handler.Pinch(e)),t.dragPan&&(e._handlers.Drag=new G.Handler.Drag(e)),t.shiftZoom&&(e._handlers.ShiftDrag=new G.Handler.ShiftDrag(e)),t.scrollZoom&&(e._handlers.ScrollWheel=new G.Handler.ScrollWheel(e)),t.dragRotate&&(e._handlers.RightDrag=new G.Handler.RightDrag(e)),e._resetHandlers()},_resetHandlers:function(){var e=this,t=e.options;e._handlers.Click.on(1),t.doubleZoom&&G.Browser.ielt9&&e._handlers.DoubleClick.on(1),t.dragPan&&e._handlers.Drag.on(1),t.pinchZoom&&e._handlers.Pinch.on(1),t.shiftZoom&&e._handlers.ShiftDrag.on(1),t.scrollZoom&&e._handlers.ScrollWheel.on(1),e._handlers.RightDrag.on(1)},_initAddition:function(){},_isCanvasRelMode:function(){var e=this;return"canvas"===e._mode||"webgl"===e._mode},_isLoaded:function(){var e=this;return e._center&&e._res>0},_updateCompass:function(e){var t=G.DomUtil,r=this._compass;if(t.markRotateTransform(r,e),t.updateTransform(r),G.Browser.ielt9){r.style.rotation=e;var n=r.currentStyle.src;r.src=n.substring(1,n.length-1)}e?t.show(r,this.options.rotateAnimDuration):t.hide(r,.5)},_updateDrawSize:function(){var e=this,t=e.getSize();if(t&&2==t.length){var r,n=t[0],o=t[1],i=Math.abs,a=Math.sin,s=Math.cos,l=(Math.tan,e._rotate),_=n,c=o;l&&(r=l/G.MathUtil.DEGREE_PER_RADIAN,_=i(n*s(r))+i(o*a(r)),c=i(n*a(r))+i(o*s(r))),e._drawSize=[_,c]}},_onMouseEvent:function(e){var t=this,r=G.DomUtil;if(t._isLoaded()){var n=e.type,o=G.DomUtil.getMousePosition(e,t._container),i=t.toMap(o);if("click"==n&&!G.Browser.chromelite)return;for(var a=e||e.touches[0],s=a.target;s;){if("g-popup"==s.className)return;s=s.parentElement}"DOMMouseScroll"==n&&(n="mousewheel"),"mousewheel"==n&&t.options.scrollPage||r.preventDefault(e),t.fireEvent(n,{mapX:i[0],mapY:i[1],screenX:o[0],screenY:o[1],originEvent:e})}},_onPopupCloseDown:function(e){var t=G.DomUtil;t.stopPropagation(e),t.preventDefault(e),this.hidePopup(!0)},_onCompassDown:function(e){var t=G.DomUtil;t.stopPropagation(e),t.preventDefault(e),this.rotateTo(0)},_onBrandMouseMove:function(e){var t=G.DomUtil;t.stopPropagation(e),t.preventDefault(e)},_onBrandImgDown:function(e){var t=this,r=G.DomUtil;r.stopPropagation(e),r.preventDefault(e);var n=t._brandInfo;"none"==n.style.display?n.style.display="inline-block":n.style.display="none"},_onWinContextMenu:function(e){G.DomUtil.preventDefault(e)},_onWinResize:function(){this.resize()},_onWinHashChange:function(){var e=this,t=e.options;t.recordStatus&&e._ensureViewByUrl()},_requestRedraw:function(){var e=this,t=G.Util;t.cancelAnimFrame(e._redrawAnimFrame),e._redrawAnimFrame=t.requestAnimFrame(e._redraw,!0,e)},_redraw:function(){var e,t,r,n=this;for(e in n._layerOrder)t=n._layerOrder[e],r=n._layers[t],r&&(r.isVisible()?r._draw():r._erase());n._drawMask(),n.fireEvent("redraw")},_requestUpdate:function(){var e=this,t=G.Util;t.cancelAnimFrame(e._updateAnimFrame),e._updateAnimFrame=t.requestAnimFrame(e._update,!0,e)},_update:function(){var e,t,r=this;for(e in r._layers)t=r._layers[e],t.isVisible()&&t._update();r._drawMask(),r.fireEvent("update")},_onResize:function(){var e=this;e._updateDrawSize(),e._requestUpdate()},_checkView:function(){var e=this,t=e._lastView||{},r=t.res,n=t.center||[],o=t.rotate,i=e._res,a=e._center||[],s=e._rotate;i===r&&a[0]===n[0]&&a[1]===n&&s===o||(e._lastView={res:i,center:a,rotate:s},e.fireEvent("viewChanged",{from:{res:r,center:n,rotate:o},to:e._lastView}))},_rawZoomTo:function(e,t,r){var n=this,o=n._center=n._calcRealCoords(e);t&&r&&(n._res=n._calcResByViewport(o,t,r)),n._updatePopupPos()},_rawPanBy:function(e,t){var r=this,n=G.DomUtil,o=r._mapFrame,i=n.getPosition(o);n.markPosTransform(o,-i[0]+e,i[1]-t),n.updateTransform(o),r._updatePopupPos()},_rawRotateTo:function(e,t){for(var r=this,n=G.DomUtil,o=r.getSize(),i=r._mapFrame;e>180;)e-=360;for(;e<-180;)e+=360;var a=t;!a&&i._rotate&&(a=[i._rotate[1],i._rotate[2]]),a||(a=[o[0]/2,o[1]/2]),r._rotate=e;var s=r._mode;"webgl"!=s&&"canvas"!=s&&(n.markRotateTransform(i,e,a[0],a[1]),n.updateTransform(i)),r._updateCompass(e),r._updateDrawSize(),r._updatePopupPos()},_rawView:function(e,t,r,n,o){var i=this;i._rawRotateTo(n||0),"webgl"===i._mode&&i._rawPitchTo(o||0),i._rawZoomTo(e,t,r)},_updatePopupPos:function(){var e=this,t=G.DomUtil,r=e._popup,n=r._mapPoint;if(n){var o=e.toScreen(n),i=t.getSizeNocache(r),a=t.getSizeNocache(e._popupPointer),s=o[0]-i[0]/2+r._offsetX,l=o[1]-i[1]-a[1]+r._offsetY;t.markPosTransform(r,s,l),t.updateTransform(r)}},_mergeFramePos:function(){var e,t=this,r=t._res,n=t._center,o=t._rotate,i=G.DomUtil,a=t._mapFrame,s=i.getPosition(a),l=s[0]*r,_=s[1]*r,c=n[0]-l,m=n[1]+_;0!==o&&0!==l&&0!==_&&(e=G.MathUtil.rotateVector([l,_],-o),c=n[0]-e[0],m=n[1]+e[1]),t._center=t._calcRealCoords([c,m]),G.Util.requestAnimFrame(function(){t._beforeMergeFramePos(),i.markPosTransform(a,0,0),i.updateTransform(a),t._updatePopupPos()},!0,t)},_beforeMergeFramePos:function(){},_calcWrapPointRange:function(e){var t=this,r=0,n=0,o=e[0],i=t.getExtent(),a=t.options,s=a.maxExtent;if(a.wrap&&s){var l=s[2]-s[0];n=Math.floor((i[0]-o)/l),r=Math.ceil((i[2]-o)/l)}return[n,r]},_calcRealCoords:function(e){if(e){var t=e,r=this,n=r.options,o=n.maxExtent,i=0;if(n.wrap&&o){for(i=o[2]-o[0];t[0]<=o[0];)t[0]+=i;for(;t[0]>=o[2];)t[0]-=i}return t}},_calcResByViewport:function(e,t,r){var n=this,o=n.getSize(),i=o[0],a=o[1],s=t/i,l=r/a;return Math.max(s,l)},_calcNearestRes:function(e){var t,r=this,n=r._res,o=r._zoomReses;if(o)for(var i,a=0,s=0,l=o.length;s<l;s++){if(t=o[s],Math.abs(t-n)<n/100)return i=s+1>=l?l-1:s+1,e?o[a]:o[i];if(t<n)return e?o[a]:t;a=s}return e?2*n:n/2},_ensureViewByUrl:function(){var e=window.location.hash,t=this;if(e){var r=e.indexOf("!g_vs=");if(r<0)return;var n=e.substring(r+6),o=n.split("!");if(o&&o.length>4){var i=Number(o[1]),a=Number(o[2]),s=Number(o[3]),l=Number(o[4]),_=t.getSize();if("webgl"===t._mode&&o[5]){var c=Number(o[5]);return void t.view([i,a],_[0]*s,_[1]*s,l,c)}t.view([i,a],_[0]*s,_[1]*s,l)}}},_updateUrl:function(){var e=this,t=e.options;if(t.recordStatus){var r=e._res,n=e.getCenter(),o=e._rotate;if(isNaN(n[0])||isNaN(n[1])||r<=0)return;var i=window.location.hash||"#",a=i.indexOf("!g_vs="),s=a>0?i.substring(0,a):i,l=s+"!g_vs=!"+n[0]+"!"+n[1]+"!"+r+"!"+o;if("webgl"===e._mode){var _=e._pitch;l+="!"+_}var c,m=window.history;if(m&&m.pushState){if(c=m.state?m.state.uri:null,l!=c)try{m.pushState({uri:l},null,l)}catch(d){}}else c=window.location.href,l!=c&&(window.location.href=l)}},print:function(){},_drawMask:function(){},_onZoomStart:function(e){},_onZoomUpdate:function(e){},_onZoom:function(e){},_onZoomEnd:function(e){},_onMoveStart:function(e){},_onMove:function(e){},_onMoveEnd:function(e){},_onRotateStart:function(e){},_onRotate:function(e){},_onRotateEnd:function(e){},_onPinchStart:function(e){},_onPinch:function(e){},_onPinchEnd:function(e){}}),G.Proj={},G.Proj.WebMercator={a:6378137,max:20037507.842788246,project:function(e,t){var r=G.Proj.WebMercator,n=G.MathUtil.DEGREE_PER_RADIAN,o=r.a,i=e/n*o,a=Math.sin(t/n),s=o/2*Math.log((1+a)/(1-a));if(!r._isCoordinates(e,t))throw new Error("Type of coordinates should be number");return s===1/0?s=r.max:s===-(1/0)&&(s=-r.max),[i,s]},unproject:function(e,t){var r=G.Proj.WebMercator,n=G.MathUtil.DEGREE_PER_RADIAN,o=r.a,i=e/o,a=Math.PI,s=i-Math.floor(i/a/2+.5)*a*2,l=a/2-2*Math.atan(Math.exp(-t/o));if(!r._isCoordinates(e,t))throw new Error("Type of coordinates should be number");return[s*n,l*n]},_isCoordinates:function(e,t){return"number"==typeof e&&"number"==typeof t}},G.Proj.Gcj={a:6378245,ee:.006693421622965823,project:function(e,t){var r=G.Proj.Gcj;if(!r._isInChina(e,t))return[e,t];var n=r._delta(e,t);return[e+n[0],t+n[1]]},unproject:function(e,t){for(var r=G.Proj.Gcj,n=e,o=t,i=r.project(n,o),a=i[0]-e,s=i[1]-t;Math.abs(a)>1e-6||Math.abs(s)>1e-6;)n-=a,o-=s,i=r.project(n,o),a=i[0]-e,s=i[1]-t;return[n,o]},unprojectRough:function(e,t){var r=G.Proj.Gcj;if(!r._isInChina(e,t))return[e,t];var n=r._delta(e,t);return[e-n[0],t-n[1]]},_isInChina:function(e,t){if("number"!=typeof e||"number"!=typeof t)throw new Error("Type of coordinates should be number");return e>=72.004&&e<=137.8347&&t>=.8293&&t<=55.8271},_latToGcj02:function(e,t){var r=Math.PI,n=Math.sin,o=-100+2*e+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return o+=2*(20*n(6*e*r)+20*n(2*e*r))/3,o+=2*(20*n(t*r)+40*n(t/3*r))/3,o+=2*(160*n(t/12*r)+320*n(t*r/30))/3},_lonToGcj02:function(e,t){var r=Math.PI,n=Math.sin,o=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return o+=2*(20*n(6*e*r)+20*n(2*e*r))/3,o+=2*(20*n(e*r)+40*n(e/3*r))/3,o+=2*(150*n(e/12*r)+300*n(e/30*r))/3},_delta:function(e,t){var r=G.Proj.Gcj,n=Math.PI,o=r._lonToGcj02(e-105,t-35),i=r._latToGcj02(e-105,t-35),a=t/180*n,s=Math.sin(a);s=1-r.ee*s*s;var l=Math.sqrt(s);return o=180*o/(r.a/l*Math.cos(a)*n),i=180*i/(r.a*(1-r.ee)/(s*l)*n),[o,i]}},G.ProjUtil={projectPoint:function(e,t){var r=e[0],n=e[1];return t(r,n)},projectPolyline:function(e,t){var r,n,o,i,a,i=e[0],a=e[1],s=[];for(r=0,n=e.length;r<n;r++)o=e[r],i=o[0],a=o[1],s[r]=t(i,a);return s},projectPolygon:function(e,t){var r,n,o,i,a,s,l,_,c,l=e[0],_=e[1],m=[];for(r=0,n=e.length;r<n;r++){for(a=e[r],c=[],o=0,i=a.length;o<i;o++)s=a[o],l=s[0],_=s[1],c[o]=t(l,_);m[r]=c}return m}},function(){var e=window,t=document.getElementsByTagName("head")[0],r=G.Browser;if(!e.G_NOT_SET_VIEWPORT){var n=document.createElement("meta");n.name="viewport",n.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no",t.appendChild(n)}G.ready=function(e){var t=G._readyFunc=e;G._needExecReady&&t&&(G._needExecReady=!1,t())};var o=r.ielt9?"vml":"svg";e.G_OFF_CANVAS||r.avoidCanvas||(o=r.canvas?"canvas":o),e.G_ON_WEBGL&&(o="webgl"),G.loadModule(o,function(){G._needExecReady=!0;var e=G._readyFunc;e&&(G._needExecReady=!1,e())},function(){throw new Error("Core library load error!")})}();